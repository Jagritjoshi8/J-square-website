'use strict';(window.dullscriptWebpackJsonp=window.dullscriptWebpackJsonp||[]).push([[8],{1307:function(G,P,b){b.r(P);b.d(P,"RtcUtils",function(){return u});G=b(0);var k=b(8),f=b(1350),x=b(31);class u{static mPe(w,r=f.RealtimeChannel.yrf){let m;try{m=x.c(w)}catch(l){throw w=String.format("Failed to JSON-serialize payload : {0}",l),k.ULS.sendTraceTag(18637072,500,10,w),Error.argument("payload",w);}if(m.length>r)throw w=String.format("Payload exceeds maximum length: {0} > {1}.",m.length,r),k.ULS.sendTraceTag(18637074,
500,10,w),Error.argument("payload",w);return m}static deserialize(w,r,m){if(!w)return null;if(Object.getType(w)!==String){var l=String.format("Failed to deserialize [{0}] - object is not of type [String] and is instead of type [{1}]. ExtraInfo: [{2}].",r,Object.getType(w).getName(),m);k.ULS.sendTraceTag(18637075,500,10,l);return null}l=null;try{l=x.a(w)}catch(z){w=String.format("Failed to deserialize [{0}]. Exception deserializing the object : [{1}]. ExtraInfo: [{2}].",r,z,m),k.ULS.sendTraceTag(18637077,
500,10,w)}return l}static wCb(w){if(!w)return"";if("string"===typeof w)return w.toString();try{return x.c(w)}catch(r){return w.toString()}}static nFk(w){let r,m,l;r=0;l=m=null;if(!w)return{VKh:r,XKh:m,exception:l};try{const z=w.source;z&&Object.getType(z)===String&&(l=z);const F=w.context;F&&(w=F,r=w.status?w.status:0,m=w.statusText?w.statusText:null)}catch(z){}return{VKh:r,XKh:m,exception:l}}}Object(G.a)(u,"RtcUtils",null,[])},1339:function(G,P,b){b.r(P);G=b(0);var k=b(8),f=b(41),x=b(74),u;(function(l){l[l.SendNotification=
0]="SendNotification";l[l.SendPersistentState=1]="SendPersistentState";l[l.FindSession=2]="FindSession";l[l.Last=3]="Last"})(u||(u={}));Object(G.b)("ApiType",u);var w;(function(l){l[l.AttemptCount=0]="AttemptCount";l[l.SuccessCount=1]="SuccessCount";l[l.DropCount=2]="DropCount";l[l.FailedCount=3]="FailedCount";l[l.LatencyOverThresholdCount=4]="LatencyOverThresholdCount";l[l.LatencyUnderThresholdCount=5]="LatencyUnderThresholdCount";l[l.ThrottledCount=6]="ThrottledCount";l[l.Last=7]="Last"})(w||(w=
{}));Object(G.b)("EventCountType",w);var r=b(1448);b.d(P,"FrequentLoggingMetrics",function(){return m});class m{constructor(l){this.A5g=this.Zlh=null;this.x4h=this.Ioh=0;this.Zv=null;this.bug=this.Ure=0;this.Qe=l;this.ZAl();this.mie=this.Nig=this.Bse=!1;this.Emc=0}get DEk(){return this.mie}xwn(l){this.bug=l;window.setInterval(Object(f.a)(this,this.Vpf,"logMetricsBatchAndReset"),l);this.Ure=(new Date).getTime()}yM(l,z){this.lmn(l)&&!this.Nig||this.DEk||!window.navigator.onLine||this.Qe.lKa||(this.Zv[l][z]++,
this.Bse=!0)}ZAl(){this.Zv=Array(3);for(let l=0;3>l;l++){this.Zv[l]=Array(7);for(let z=0;7>z;z++)this.Zv[l][z]=0}}pXj(){const l={};for(let z=0;3>z;z++)for(let F=0;7>F;F++)this.OUl(z,F)&&(l[u[z]+w[F]]=this.Zv[z][F]);l.FSDomain=this.Zlh;l.ConnectionDomain=this.A5g;l.FSRetryInterval=this.Ioh;l.MaxPayloadSize=this.x4h;l.LogNumber=this.Emc;1===this.Emc&&(l.FSLatencies=r.a.instance.n0k(),l.ConLatencies=r.a.instance.WVk());return l}OUl(l,z){return 2===l&&3!==z&&0!==z?!1:!0}lmn(l){return 2===l?!1:!0}Vpf(){if(this.Bse){this.Emc++;
if((new Date).getTime()-this.Ure<5E3+this.bug){var l=x.a.toJSON(this.pXj());k.ULS.sendTraceTag(50644352,500,15,l)}this.Ure=(new Date).getTime();for(l=0;3>l;l++)for(let z=0;7>z;z++)this.Zv[l][z]=0;this.Bse=!1}}gam(){this.Nig=!0}static get instance(){return m._instance}static create(l){m.instance||(m._instance=new m(l));return m.instance}}m._instance=null;Object(G.a)(m,"FrequentLoggingMetrics",null,[863])},1350:function(G,P,b){b.r(P);G=b(0);var k=b(8),f=b(41),x=b(405),u=b(1538),w=b(78),r=b(2);class m{constructor(nb,
La){this.status=nb;this.v4b=La}}Object(G.a)(m,"UserStatusInfo",null,[]);var l=b(47),z=b(1448);class F{constructor(nb,La){this.data=nb;this.timeStamp=La}}Object(G.a)(F,"PresenceData",null,[]);class L{constructor(nb){this.Pva=!1;this.Tqb=0;this.mee=!1;this.setTimeout=L.EWe;this.clearTimeout=L.wWe;this.z8l=Object(f.a)(this,this.p7l,"logRtcConnectingUsageStatement");this.Ku=nb}jmm(){this.Pva||(this.Tqb=this.setTimeout(()=>{this.Pva=!1;this.J1h()},8E3),this.Pva=!0,this.mee=!1)}Zmm(){this.bX()}otm(){this.J1h()}J1h(){this.bX();
this.mee||(this.mee=!0,this.z8l())}p7l(){k.ULS.sendTraceTag(4539720,500,50,"Usage statement for the Rtc_ConnectedEver KPI for [{0}]",this.Ku)}bX(){this.Pva&&this.clearTimeout(this.Tqb);this.Tqb=0;this.Pva=!1}static EWe(nb,La){return window.setTimeout(nb,La)}static wWe(nb){window.clearTimeout(nb)}}Object(G.a)(L,"ConnectedUsageKpiLogger",null,[879]);class E{constructor(){this.pni=this.kIf;this.sni=this.nIf;this.rni=this.mIf;this.wni=this.qIf;this.vni=this.pIf;this.AIf=this.BIf;this.xIf=this.yIf;this.CEb=
this.vIf;this.YRc=this.wIf;this.qni=this.lIf;this.mLa=this.zvf;this.ueb=this.Avf}kIf(){}nIf(){}mIf(){}qIf(){}pIf(){}yIf(){}wIf(){}vIf(){}BIf(){}lIf(){}zvf(){}Avf(){}}Object(G.a)(E,"NoopRealtimeChannelMetrics",null,[871,207]);class A{}A.KZc="presenceUpdated";A.updateNotification="updateNotification";A.Chi="persistentStateCleared";A.updatePersistentState="persistentStateUpdated";Object(G.a)(A,"RtcClientMethodNames",null,[]);class M{}M.mwl="realtimeChannelHub";M.KZc="UpdatePresence";M.MM="SendUpdateNotification";
M.b6e="GetCompletePersistentStateWithMetadata";M.updatePersistentState="UpdatePersistentState";M.GIb="UpdateClientInfo";Object(G.a)(M,"RtcHubMethodNames",null,[]);class Q{constructor(nb){this.qu=nb}ATm(nb){this.qu.on(A.KZc,nb)}sUm(nb){this.qu.on(A.updateNotification,nb)}zTm(nb){this.qu.on(A.updatePersistentState,nb)}yTm(nb){this.qu.on(A.Chi,nb)}OKn(nb){this.qu.off(A.KZc,nb)}YKn(nb){this.qu.off(A.updateNotification,nb)}NKn(nb){this.qu.off(A.updatePersistentState,nb)}MKn(nb){this.qu.off(A.Chi,nb)}KZc(nb){return this.qu.invoke(M.KZc,
nb)}GIb(nb){return this.qu.invoke(M.GIb,nb)}MM(nb,La){return this.qu.invoke(M.MM,nb,La)}b6e(nb){return this.qu.invoke(M.b6e,nb)}updatePersistentState(nb,La){return this.qu.invoke(M.updatePersistentState,nb,La)}}Object(G.a)(Q,"RealtimeChannelProxy",null,[876,877,878]);class R{constructor(){this.Ibe=this.H$f=!1;this.Gbe=0;this.Ade=this.FAe=this.EAe=this.Lae=!1;this.Mie=0;this.JDg=!1;this.IDg=this.HDg=0;this.Zye=!1;this.eze=this.dze=this.gze=this.$ye=0}get qSj(){return this.Ibe}get pSj(){return this.Gbe}get BLj(){return this.Lae}get Fnn(){return this.EAe}get Gnn(){return this.FAe}get C7j(){return this.Ade}get Swd(){return this.Mie}get T5m(){return this.JDg}get iwi(){return this.HDg}get S5m(){return this.IDg}get O5m(){return this.Zye}get P5m(){return this.$ye}get nwi(){return this.gze}get jwi(){return this.dze}get kwi(){return this.eze}static createInstance(nb){const {RealtimeChannel:La}=
b(1350);return nb?Object.assign(new R,{H$f:nb.$("AwayStatusManagerIsEnabled"),Ibe:nb.$("AwayStatusOneMinuteTimeoutIsEnabled"),Gbe:nb.vb("AwayCoauthorThresholdMs",9E5),Lae:nb.$("RtcAllowCrossDomainAccessEnabled"),EAe:nb.$("ShouldLogOnContentNotification"),FAe:nb.$("ShouldLogOnHostSubscriptionNotification"),Ade:nb.$("RtcClientMetricsEnabled"),Mie:nb.vb("RtcFindSessionRequestTimeoutInMS",6E4),JDg:nb.$("RtcJsClientFrequentlyLogsMetrics"),HDg:nb.vb("RtcJsClientFrequentMetricsLatencyThresholdInMS",1E3),
IDg:nb.vb("RtcJsClientFrequentMetricsLogIntervalInMS",3E5),Zye:nb.$("RtcClientMessageTelemetryEnabled"),$ye:nb.vb("RtcClientMessageTelemetrySampleSize",5),gze:nb.vb("RtcSendTelemetryMessageIntervalInMS",3E5),dze:nb.vb("RtcLogClientMessageMetricsTimeOutInMs",2E4),eze:nb.vb("RtcMaxPayloadSizeInCharactersOverride",La.yrf)}):Object.assign(new R,{H$f:!1,Ibe:!1,Gbe:9E5,Lae:!1,EAe:!1,FAe:!0,Ade:!1,Mie:9E4,Zye:!1,$ye:5,gze:3E5,dze:2E4,eze:La.yrf})}}Object(G.a)(R,"RealtimeChannelSettings",null,[875]);class K extends Sys.EventArgs{constructor(nb,
La){super();this.newState=nb;this.oldState=La}}Object(G.a)(K,"ChangedConnectionStateEventArgs",Sys.EventArgs,[]);class J extends Sys.EventArgs{constructor(nb,La){super();this.B7j=nb;this.M0a=La}}Object(G.a)(J,"ClientInfoEventArgs",Sys.EventArgs,[]);class O extends Sys.EventArgs{constructor(nb){super();this.presence=nb}}Object(G.a)(O,"MyPresenceUpdatedEventArgs",Sys.EventArgs,[]);var N=b(1689),V=b(1688),W=b(1686);class ca extends Sys.EventArgs{constructor(nb,La=null){super();this.vk=nb;this.Ryj=La}get type(){return this.vk}get Q5(){return this.Ryj}}
Object(G.a)(ca,"UpdateNotificationEventArgs",Sys.EventArgs,[]);class H extends Sys.EventArgs{constructor(){super()}}Object(G.a)(H,"GotCompletePersistentStateWithMetadataEventArgs",Sys.EventArgs,[]);class Z extends Sys.EventArgs{constructor(nb,La,Ha,Aa,Ma,cb){super();this.zdc=nb;this.LRe=La;this.Dbk=Ha;this.Fjh=Ma;this.QPe=Aa;this.Qv=cb}}Object(G.a)(Z,"RefreshAllPersistentStateEventArgs",Sys.EventArgs,[]);class aa extends Sys.EventArgs{constructor(nb){super();this.hubConnection=nb}}Object(G.a)(aa,
"RefreshProxyEventArgs",Sys.EventArgs,[]);class ja extends Sys.EventArgs{constructor(nb,La){super();this.gca=nb;this.errorMessage=La}}Object(G.a)(ja,"RtcConnectFailedEventArgs",Sys.EventArgs,[]);class Ba extends Sys.EventArgs{constructor(nb,La,Ha){super();this.type=nb;this.presence=La;this.M0a=Ha}}Object(G.a)(Ba,"SendPersistentStateEventArgs",Sys.EventArgs,[]);class la extends Sys.EventArgs{constructor(nb,La,Ha,Aa){super();this.type=nb;this.Q5=La;this.bsk=Ha;this.M0a=Aa}}Object(G.a)(la,"SendUpdateNotificationEventArgs",
Sys.EventArgs,[]);class ia extends Sys.EventArgs{constructor(){super()}}Object(G.a)(ia,"SessionPropertiesChangedEventArgs",Sys.EventArgs,[]);class oa extends Sys.EventArgs{constructor(nb){super();this.Apd=nb}}Object(G.a)(oa,"UpdatePersistentStateClearedRequestEventArgs",Sys.EventArgs,[]);class ha extends Sys.EventArgs{constructor(nb,La){super();this.type=nb;this.sSn=La}}Object(G.a)(ha,"UpdatePersistentStateRequestEventArgs",Sys.EventArgs,[]);var pa=b(63);class Ea{constructor(){this.ma=new pa.a}PKm(nb,
La){this.ma.raiseEvent("CSC",new K(nb,La))}ILm(nb){this.ma.raiseEvent("RP",new aa(nb))}bXd(nb){this.ma.raiseEvent("RC",nb)}LLm(){this.ma.raiseEvent("RMID")}HLm(nb,La,Ha,Aa,Ma,cb){this.ma.raiseEvent("RPS",new Z(nb,La,Ha,Aa,Ma,cb))}Ami(nb,La){this.ma.raiseEvent("UPSR",new ha(nb,La))}nmi(nb,La){this.ma.raiseEvent("PU",new W.a(nb,La))}nLm(nb){this.ma.raiseEvent("MPU",new O(nb))}LHf(nb,La,Ha,Aa){this.ma.raiseEvent("SUN",new la(nb,La,Ha,Aa))}$Lm(nb,La){this.ma.raiseEvent("UNR",new ca(nb,La))}umi(nb,La,
Ha){this.ma.raiseEvent("SP",new Ba(nb,La,Ha))}DLm(nb,La){this.ma.raiseEvent("PSU",new V.a(nb,La))}CLm(nb){this.ma.raiseEvent("PSC",new N.a(nb))}hLm(nb){this.ma.raiseEvent("IPSC",new N.a(nb))}aMm(nb){this.ma.raiseEvent("UPSC",new oa(nb))}MLm(nb,La){this.ma.raiseEvent("SPC",new ia(nb,La))}rmi(nb,La){this.ma.raiseEvent("RCF",new ja(nb,La))}bLm(nb){this.ma.raiseEvent("CPSWM",new H(nb))}ZLm(nb,La){this.ma.raiseEvent("UCI",new J(nb,La))}qwa(nb){this.ma.addHandler("CSC",nb)}WSc(nb){this.ma.removeHandler("CSC",
nb)}tJj(nb){this.ma.addHandler("RP",nb)}sJj(nb){this.ma.addHandler("RC",nb)}wJj(nb){this.ma.addHandler("RMID",nb)}rJj(nb){this.ma.addHandler("RPS",nb)}SJj(nb){this.ma.addHandler("UPSR",nb)}SSa(nb){this.ma.addHandler("PU",nb)}UEb(nb){this.ma.removeHandler("PU",nb)}zHj(nb){this.ma.addHandler("IPU",nb)}PJj(nb){this.ma.addHandler("UCI",nb)}AJj(nb){this.ma.addHandler("SUN",nb)}AHj(nb){this.ma.addHandler("IUNR",nb)}j3(nb){this.ma.addHandler("UNR",nb)}Y8b(nb){this.ma.removeHandler("UNR",nb)}wld(nb){this.ma.addHandler("PSU",
nb)}mYd(nb){this.ma.removeHandler("PSU",nb)}yHj(nb){this.ma.addHandler("IPSU",nb)}vld(nb){this.ma.addHandler("PSC",nb)}lYd(nb){this.ma.removeHandler("PSC",nb)}xHj(nb){this.ma.addHandler("IPSC",nb)}RJj(nb){this.ma.addHandler("UPSC",nb)}zJj(nb){this.ma.addHandler("SP",nb)}CJj(nb){this.ma.addHandler("SPC",nb)}static getInstance(){return Ea._instance||(Ea._instance=new Ea)}}Ea._instance=null;Object(G.a)(Ea,"RtcEventHub",null,[874]);var Fa=b(69),Ga=b(144);class $a{constructor(nb){this.nsc=null;this.MMa=
0;this.Qvb=!1;this.il=nb;this.il.qwa(Object(f.a)(this,this.Dda,"onConnectionStateChanged"))}Dda(nb,La){this.MMa=La.newState}Ttm(){k.ULS.sendTraceTag(18637070,500,15,"Too many undelivered messages. Restarting RTC connection.");this.il.bXd()}zzl(nb){this.nsc.init(nb)}}Object(G.a)($a,"ARtcMessageHandler",null,[]);var fa=b(79);class sa{constructor(){this.Presence=null;this.TimeStamp=0}}Object(G.a)(sa,"PresenceDataEntryForClients",null,[]);var qa=b(74);class va{constructor(nb,La=""){this.Ntj=nb;this.FQa=
La}send(){return this.Ntj()}get messageId(){return this.FQa}}Object(G.a)(va,"MessageHandler",null,[887]);var Ca=b(1474);class ta extends Sys.EventArgs{constructor(nb,La,Ha,Aa){super();this.rLf=nb;this.reconnectDelay=La;this.reason=Ha;this.vOf=Aa}}Object(G.a)(ta,"RefreshConnectionReconnectArgs",Sys.EventArgs,[]);class Wa{constructor(){this.UBe=this.lh=null}get Yg(){return this.lh?this.UBe?this.UBe.getTime()-this.lh.getTime():(new Date).getTime()-this.lh.getTime():0}start(){this.lh=new Date}stop(){this.UBe=
new Date}}Object(G.a)(Wa,"SimpleStopwatch",null,[]);var Za=b(1542),Ya;(function(nb){nb[nb.contentUpdate=0]="contentUpdate";nb[nb.editorsTableUpdate=1]="editorsTableUpdate";nb[nb.fileNameUpdate=2]="fileNameUpdate";nb[nb.wetContentUpdate=3]="wetContentUpdate";nb[nb.persistedContentUpdate=4]="persistedContentUpdate";nb[nb.clientRtcReconnectRequest=5]="clientRtcReconnectRequest";nb[nb.replicationTelemetry=6]="replicationTelemetry";nb[nb.lockUpdate=7]="lockUpdate";nb[nb.collabServiceContentUpdate=8]="collabServiceContentUpdate";
nb[nb.trackChangeSettingUpdate=9]="trackChangeSettingUpdate";nb[nb.saveTargetUpdate=10]="saveTargetUpdate";nb[nb.uploadToOcsUpdate=11]="uploadToOcsUpdate";nb[nb.labelUpdate=12]="labelUpdate";nb[nb.hostNotificationSubscriptionStatus=13]="hostNotificationSubscriptionStatus";nb[nb.subscribeOrExtend=14]="subscribeOrExtend";nb[nb.elapsedBootTelemetry=15]="elapsedBootTelemetry";nb[nb.clientToClientTelemetryMessage=16]="clientToClientTelemetryMessage";nb[nb.clientToClientResponseMessage=17]="clientToClientResponseMessage";
nb[nb.verifyNotificationPipeline=18]="verifyNotificationPipeline";nb[nb.hostNotificationHeartbeat=19]="hostNotificationHeartbeat";nb[nb.secondaryMetadataUpdate=20]="secondaryMetadataUpdate";nb[nb.last=21]="last"})(Ya||(Ya={}));Object(G.b)("UpdateNotificationType",Ya);class Ka extends $a{constructor(nb,La,Ha,Aa,Ma,cb,ib,Rb,Oa,lb){super(ib);this.qu=null;this.Ttg=!1;this.FQa=0;this.Zve=new Ga.a;this.Kc=nb;this.Ewg=this.Dwg=0;this.nsc=La;this.nsc.xld(Object(f.a)(this,this.Ttm,"onTooManyUndeliveredMessages"));
this._clientId=Ha;this.vrj=Ma;this.il.tJj(Object(f.a)(this,this.zrm,"onRefreshProxyRequired"));this.il.rJj(Object(f.a)(this,this.xrm,"onRefreshAllPersistentStateRequest"));this.il.AJj(Object(f.a)(this,this.MM,"sendUpdateNotification"));this.il.zHj(Object(f.a)(this,this.epm,"onInternalPresenceUpdated"));this.il.AHj(Object(f.a)(this,this.fpm,"onInternalUpdateNotificationReceived"));this.il.yHj(Object(f.a)(this,this.dpm,"onInternalPersistentStateUpdated"));this.il.xHj(Object(f.a)(this,this.cpm,"onInternalPersistentStateCleared"));
this.il.zJj(Object(f.a)(this,this.MUc,"sendPersistentState"));this.il.PJj(Object(f.a)(this,this.GIb,"updateClientInfo"));this.Zc=cb;this.Ku=Aa;this.Zv=Rb;this.rT=Oa;this.anc=lb;this.pma=Object(Fa.a)(String,r.AFrameworkApplication.sessionStartInfoSettings.Application)||""}zrm(nb,La){this.qu=this.vrj(La.hubConnection);this.nsc.reset();this.qu.ATm(Object(f.a)(this,this.$0,"onPresenceUpdated"));this.qu.zTm(Object(f.a)(this,this.ZCb,"onPersistentStateUpdated"));this.qu.yTm(Object(f.a)(this,this.H6b,"onPersistentStateCleared"));
this.qu.sUm(Object(f.a)(this,this.A9,"onUpdateNotificationReceived"))}Dda(nb,La){this.MMa=La.newState;2===La.newState&&this.S$m()}S$m(){for(let nb of this.Zve)this.MM(null,new la(nb.key,nb.value,!1,new x.a));this.Zve=new Ga.a}xrm(nb,La){La.QPe();for(nb=0;3>nb;++nb)this.z$m(nb,La)}z$m(nb,La){try{this.qu.b6e(nb).done(Ha=>{La.zdc(La.LRe,"GetCompletePresenceSuccess")&&(La.Dbk.otm(),k.ULS.sendTraceTag(3249540,500,50,"Successfully retrieved complete session state for [{0}]",this.Ku),this.il.LLm(),this.Uqm(nb,
Ha),this.il.bLm(Ha),La.Fjh.Ja(nb)&&this.il.umi(nb,La.Fjh.J(nb),new x.a))}).fail(Ha=>{const {RtcUtils:Aa}=b(1307);La.zdc(La.LRe,"GetCompletePresenceFail")&&(k.ULS.sendTraceTag(3249541,500,15,"Failed to retrieve complete session state : {0} for [{1}]",Aa.wCb(Ha),this.Ku),this.il.bXd())}).always(()=>{La.Qv&&La.Qv.stop()})}catch(Ha){k.ULS.sendTraceTag(595132428,500,10,"Exception thrown while calling hub method GetCompletePersistentStateWithMetadata. Promise not even created. Current event token: {0}, Exception message: {1}",
La.LRe,Ha.message)}}MUc(nb,La){var {RtcUtils:Ha}=b(1307);nb=La.presence;let Aa;const Ma=La.M0a;this.rT.yM(1,0);try{Aa=Ha.mPe(nb,this.anc)}catch(ib){this.rT.yM(1,3);k.ULS.sendTraceTag(574407636,500,10,"Exception thrown while trying to serialize presence. Exception message: {0}",ib.message);Ma.setException(ib);return}Ha=new w.a;Ha.Z(this._clientId,Object.assign(new sa,{Presence:nb,TimeStamp:(new Date).getTime()}));this.il.Ami(La.type,Ha);if(2!==this.MMa)this.Zv.CEb(),this.rT.yM(1,2),Ma.Jf(null);else{var cb=
this.FQa.toString();++this.FQa;nb=new va(()=>this.U$m(La.type,Aa,cb),cb);nb=this.mOi(0,La.type).add(nb);nb.vRd(ib=>{2===ib&&this.rT.yM(1,6);Ma.Jf(null)});nb.uRd(()=>{})}}U$m(nb,La,Ha){let Aa=null;const Ma=new Wa,cb=new Ca.a;k.ULS.sendTraceTag(3249501,500,50,"Sending presence update for [{0}]",this.Ku);if(2!==this.MMa)return this.Zv.CEb(),this.rT.yM(1,2),k.ULS.sendTraceTag(7934171,500,15,"Connection is lost - unable to send the message for [{0}]",this.Ku),cb.jrf(),cb;this.Zc&&20>this.Dwg&&(Aa=this.Zc.Pe("WebServiceCall",
"Send Presence Message"),this.Dwg++);Ma.start();cb.FMc(1);try{this.qu.updatePersistentState(nb,La).done(()=>{this.Zv.xIf();this.rT.yM(1,1);k.ULS.sendTraceTag(3249502,500,50,"Successfully delivered presence update message [{0}] for [{1}]",Ha,this.Ku);cb.aeb(1);Ma&&(Ma.stop(),Ma.Yg>this.Kc.iwi?this.rT.yM(1,4):this.rT.yM(1,5))}).fail(ib=>{const {RtcUtils:Rb}=b(1307);this.Qvb||(this.Zv.CEb(),this.rT.yM(1,3),k.ULS.sendTraceTag(3249503,500,15,"Server failed to process the presence update message [{0}]: [{1}] for [{2}]",
Ha,Rb.wCb(ib),this.Ku));cb.aeb(2)}).always(()=>{Aa&&Aa.stop()})}catch(ib){k.ULS.sendTraceTag(593072906,500,15,"Exception when invoking hub method UpdatePersistentState, error: {1}",ib.message),this.rT.yM(1,3),cb.aeb(2)}return cb}GIb(nb,La){({RtcUtils:nb}=b(1307));const Ha=La.B7j,Aa=La.M0a;let Ma;try{Ma=nb.mPe(Ha,this.anc)}catch(cb){k.ULS.sendTraceTag(544318999,500,10,"Exception thrown while trying to serialize clientInfo. Exception message: {0}",cb.message);Aa.setException(cb);return}try{this.qu.GIb(Ma).done(()=>
{k.ULS.sendTraceTag(544319E3,500,50,"Successfully delivered clientInfo.")}).fail(cb=>{const {RtcUtils:ib}=b(1307);this.Qvb||k.ULS.sendTraceTag(544319001,500,15,"Server failed to process udpate clientInfo: {0}.",ib.wCb(cb));Aa.Jf(null)})}catch(cb){k.ULS.sendTraceTag(544319002,500,15,"Exception when invoking hub method UpdateClientInfo: error: {0}",cb.message),Aa.Jf(null)}}MM(nb,La){({RtcUtils:nb}=b(1307));const Ha=La.type,Aa=La.Q5,Ma=La.bsk,cb=La.M0a;let ib;this.rT.yM(0,0);try{ib=nb.mPe(Aa,this.anc)}catch(Oa){this.rT.yM(0,
3);k.ULS.sendTraceTag(574407637,500,10,"Exception thrown while trying to serialize updateHint. Exception message: {0}",Oa.message);cb.setException(Oa);return}if(2!==this.MMa)Ma?this.Zve.Z(Ha,Aa):(this.Zv.CEb(),this.rT.yM(0,2)),cb.Jf(null);else{var Rb=this.FQa.toString();++this.FQa;La=new va(()=>this.Fan(Ha,ib,Rb),Rb);La=this.mOi(1,Ha).add(La);La.vRd(Oa=>{2===Oa&&this.rT.yM(0,6);cb.Jf(null)});La.uRd(()=>{})}}Fan(nb,La,Ha){let Aa=null;const Ma=new Wa,cb=new Ca.a;k.ULS.sendTraceTag(3249505,500,50,"Sending update notification for [{0}]",
this.Ku);if(2!==this.MMa)return this.Zv.CEb(),this.rT.yM(0,2),k.ULS.sendTraceTag(7934172,500,15,"Connection is lost - unable to send the message for [{0}]",this.Ku),cb.jrf(),cb;this.Zc&&3===nb&&20>this.Ewg&&(Aa=this.Zc.Pe("WebServiceCall","Send WetContent Update"),this.Ewg++);Ma.start();cb.FMc(1);this.qu.MM(nb,La).done(()=>{this.Zv.xIf();this.rT.yM(0,1);k.ULS.sendTraceTag(3249506,500,50,"Successfully delivered update notification message [{0}] for [{1}]",Ha,this.Ku);cb.aeb(1);Ma&&(Ma.stop(),Ma.Yg>
this.Kc.iwi?this.rT.yM(0,4):this.rT.yM(0,5))}).fail(ib=>{const {RtcUtils:Rb}=b(1307);this.Qvb||(this.Zv.CEb(),this.rT.yM(0,3),k.ULS.sendTraceTag(3249507,500,15,"Server failed to process the update notification message [{0}] : [{1}] for [{2}]",Ha,Rb.wCb(ib),this.Ku));cb.aeb(2)}).always(()=>{Aa&&Aa.stop()});return cb}Yea(){this.qu.OKn(Object(f.a)(this,this.$0,"onPresenceUpdated"));this.qu.NKn(Object(f.a)(this,this.ZCb,"onPersistentStateUpdated"));this.qu.MKn(Object(f.a)(this,this.H6b,"onPersistentStateCleared"));
this.qu.YKn(Object(f.a)(this,this.A9,"onUpdateNotificationReceived"))}epm(nb,La){this.$0(La.XCa,La.Ktd)}$0(nb){this.Zv.YRc();this.ZCb(0,nb)}dpm(nb,La){this.ZCb(La.type,La.XCa)}Uqm(nb,La){const Ha={};for(let Aa in La)Ha[Aa]=La[Aa].Presence;this.Xbi(nb,Ha,La)}ZCb(nb,La){this.Zv.YRc();this.Xbi(nb,La)}Xbi(nb,La,Ha=null){var {RtcUtils:Aa}=b(1307);if(k.ULS.y5(500,100))for(var Ma in La);delete La[this._clientId];if(!qa.a.isEmpty(La)){for(var cb in La)Ma=cb,La[Ma]=Aa.deserialize(La[cb],"Presence",Ma,!1,this.anc);
Aa=new w.a;cb=(new Date).getTime();for(let ib in La){Ma=La[ib];let Rb=ib,Oa;Ha?(Oa=Ha[Rb],Oa.Presence=Ma):Oa=Object.assign(new sa,{Presence:Ma,TimeStamp:cb});Aa.Z(Rb,Oa)}this.il.Ami(nb,Aa);switch(nb){case 0:this.Ttg||(k.ULS.sendTraceTag(4539734,500,50,"Raising first presence update notification for [{0}]",this.Ku),this.Ttg=!0,r.AFrameworkApplication.ug&&r.AFrameworkApplication.ug.Z$l());this.il.nmi(La,[]);break;default:this.il.DLm(nb,La)}}}cpm(nb,La){this.H6b(La.Apd)}H6b(nb){this.Zv.YRc();if(k.ULS.y5(500,
100))for(let La=0;La<nb.length;++La);nb.length&&(this.il.aMm(nb),this.il.CLm(nb),this.il.nmi({},nb))}fpm(nb,La){this.A9(La.type,La.Q5)}A9(nb,La=null){this.Kc.Fnn&&0===nb&&k.ULS.sendTraceTag(40128990,500,50,"Received ContentUpdate notification from the server");if(0===nb){const Ha=r.AFrameworkApplication.K.Ga("OwningFeatureCrewForRtcNotificationKpis");if(Ha&&0<Ha.length){const Aa=new Map;Aa.set("AreaName","RealTimeCoauth");Aa.set("FeatureName","RtcNotification");Aa.set("SkipAria","True");fa.Health.instance.recordKpiUsage("ContentUpdateNotificationReceived",
0,Ha,Aa)}}this.Kc.Gnn&&13===nb&&k.ULS.sendTraceTag(575221780,500,50,String.format("Received HostSubscription notification from the server : {0}",La||"<none>"));this.Zv.YRc();5===nb?(La=(nb=this.ozm(La))?String.format("Received client reconnection request from the server. Reason: {0}, Backoff time: {1} ",nb.reason,nb.reconnectDelay):"Received client reconnection request from the server without params.",k.ULS.sendTraceTag(18637071,500,50,La),this.il.bXd(nb)):(La=b(1307).RtcUtils.deserialize(La,String.format("UpdateNotification-{0}",
Ya[nb]),null,!1,this.anc),this.il.$Lm(nb,La))}ozm(nb){try{if(!nb||""===nb)return null;const La=JSON.parse(nb);return new ta(La[Za.a.oNf],La[Za.a.N5m],La[Za.a.R5m],La[Za.a.vOf])}catch(La){return k.ULS.sendTraceTag(593844380,500,15,"Error when parsing reconnect hint: {0}",La.message),null}}mOi(nb,La){return this.nsc.ajl(this.bjl(nb,La))}bjl(nb,La){return nb+","+La}}Object(G.a)(Ka,"RtcMessageHandler",$a,[]);class xa{z9g(nb,La=""){const {MaxOutstandingThrottler:Ha}=b(1539);return Ha.createInstance(nb,
La)}xjk(nb,La=""){const {MaxRateThrottler:Ha}=b(1541);return Ha.createInstance(nb,La)}}Object(G.a)(xa,"ThrottlerFactory",null,[873]);var Sa=b(1543);class pb{constructor(nb){this.Kc=null;this.rg=!1;this.ma=new pa.a;this.ose=new w.a;this.mse=new w.a;this.vDe=nb;this.gNb=this.vDe.z9g(La=>La.send(),"GlobalMaxOustandingThrottler");this.gNb.xld(()=>{this.ma.raiseEvent("TMUDM")})}init(nb){this.rg||(this.Kc=nb,this.gNb.init(this.Kc.Aib,this.Kc.Zml),this.rg=!0)}ajl(nb){var {MaxRateThrottler:La}=b(1541),{MaxOutstandingThrottler:Ha}=
b(1539);this.rg||this.init(new Sa.a(La.sbh,Ha.Pbh,Ha.Ebh,pb.Abm));({value:La}=this.ose.Ab(nb)).returnValue||(({value:La}=this.mse.Ab(nb)).returnValue||(La="MaxOutstandingThrottler-"+nb,La=this.vDe.z9g(Object(f.a)(this.gNb,this.gNb.add,"add"),La),La.init(this.Kc.Aib,this.Kc.zbm),La.xld(()=>{this.ma.raiseEvent("TMUDM")}),this.mse.add(nb,La)),Ha="MaxRateThrottler-"+nb,La=this.vDe.xjk(Object(f.a)(La,La.add,"add"),Ha),La.init(this.Kc.Adm),this.ose.add(nb,La));return La}reset(){for(let nb of this.ose)nb.value.zIf();
for(let nb of this.mse)nb.value.zIf(),nb.value.reset();this.gNb.zIf();this.gNb.reset()}xld(nb){this.ma.addHandler("TMUDM",nb)}}pb.Abm=1E3;Object(G.a)(pb,"ThrottlerManager",null,[872]);var Db;(function(nb){nb[nb.unspecified=0]="unspecified";nb[nb.word=1]="word";nb[nb.excel=2]="excel";nb[nb.powerPoint=3]="powerPoint";nb[nb.test=4]="test";nb[nb.wacFrontEnd=5]="wacFrontEnd";nb[nb.oneNote=6]="oneNote";nb[nb.visio=7]="visio";nb[nb.officeMobile=8]="officeMobile";nb[nb.cosmosDBChangefeed=9]="cosmosDBChangefeed";
nb[nb.last=10]="last"})(Db||(Db={}));Object(G.b)("RtcClientAppName",Db);const Ua=(nb,La,Ha,Aa,Ma,cb,ib,Rb,Oa=null,lb=null,gb=null,Nb=null)=>{const qc=R.createInstance(r.AFrameworkApplication.K),Eb=r.AFrameworkApplication.buildVersion?r.AFrameworkApplication.buildVersion:"1.0",ec=Lb(nb,La,ib,Eb),Jb=qc.C7j?b(1687).RealtimeChannelMetrics.createInstance(ec):new E;var vb=b(1339).FrequentLoggingMetrics.create(Ma);qc.T5m&&vb.xwn(qc.S5m);var xb="";xb=Oa&&""!==Oa?Oa:"/rtc2/";vb.Zlh=l.a.p0(xb);const lc=xb+
"signalr";Oa=xb+"findsession";const Lc=M.mwl;xb=new xa;gb=gb||Ea.getInstance();k.ULS.shipAssertTag(556867617,500,qc.kwi<=b(1350).RealtimeChannel.y4h,"Client attempting to override max payload size beyond absolute limit");const uc=Math.min(qc.kwi,b(1350).RealtimeChannel.y4h);vb.x4h=uc;vb=new Ka(qc,new pb(xb),nb,ec,od=>new Q(od.createHubProxy(Lc)),Rb,gb,Jb,vb,uc);lb||(lb=b(1582).FindSessionStrategy.createInstance(La,Ma,Oa,Rb,Eb,ib,nb,ec,gb,cb,Aa,Nb));lb.Swd=qc.Swd;La=new L(ec);Ha=Ha?Ha.split(","):null;
nb=new (b(1350).RealtimeChannel)(nb,Ha,ec,Rb,()=>$.hubConnection(lc),lb,vb,La,gb,Jb,qc,Ma);nb.init();return nb},Lb=(nb,La,Ha)=>String.format("ClientID={0}, App={1}, ClientType={2}, SessionId={3}",nb,Va(Db[Ha]),Va("browser"),La),Va=nb=>nb?nb.charAt(0).toLocaleUpperCase()+nb.substring(1,nb.length):nb;b.d(P,"RealtimeChannel",function(){return Sb});class Sb{constructor(nb,La,Ha,Aa,Ma,cb,ib,Rb,Oa,lb,gb,Nb){this.SBe=!1;this.g6=null;this.XZ=new w.a;this.Igc=1;this.aaa=null;this.uk=!1;this.iqe=(new Date(0)).getTime();
this.oGg=0;this._clientId=nb;this.Kid=La;this.h6=0;this.Zc=Aa;this.lee=Rb;this.ptj=ib;this.v6i=Oa;this.laj=Ma;this.y2a=cb;this.Ku=Ha;this.Zv=lb;this.Kc=gb;this.Qe=Nb;this.svj=1>100*Math.random()}get Xdb(){return this.y2a.Xdb}set Xdb(nb){this.y2a.Xdb=nb}get Agb(){return this.ptj}get il(){return this.v6i}init(){this.il.sJj(Object(f.a)(this,this.Itd,"disconnectAndCreateNewConnection"));this.il.SJj(Object(f.a)(this,this.mum,"onUpdatePersistentStateRequestReceivedInternal"));this.il.RJj(Object(f.a)(this,
this.kum,"onUpdatePersistentStateClearedRequestReceived"));this.Qe.kTb(this.Zv);r.AFrameworkApplication.UK(()=>{const {FrequentLoggingMetrics:nb}=b(1339);this.Zv.AIf();nb.instance&&nb.instance.Vpf()});this.Q9g();this.Tuk();this.il.CJj(Object(f.a)(this,this.QMn,"updateConnectionQueryString"))}Tuk(){try{const Ha=$.signalR;if(!Ha)throw Error.invalidOperation("Failed to retrieve Signalr object");const Aa=Ha.version;if(!Aa)throw Error.invalidOperation("Signalr object is missing version information");if("2.1.1"===
Aa){var nb=Ha.transports;if(!nb)throw Error.invalidOperation("Failed to retrieve transports object");var La=nb.longPolling;if(!La)throw Error.invalidOperation("Failed to retrieve longPolling object");if(!La.supportsKeepAlive)throw Error.invalidOperation("LongPolling object does not have a field called supportsKeepAlive");La.supportsKeepAlive=this.Tlk()}}catch(Ha){k.ULS.sendTraceTag(6432339,500,15,"Failed to disable longPolling KeepAlives: {0}",Ha.message)}}Tlk(){return()=>!1}Q9g(){const nb=++this.Igc;
this.iqe=(new Date(0)).getTime();this.aaa=this.laj();this.il.ILm(this.aaa);this.aaa.stateChanged(La=>{this.nmm(La,nb)});this.aaa.connectionSlow(Object(f.a)(this,this.htm,"onSlowConnection"));this.aaa.error(Object(f.a)(this,this.$sm,"onSignalRError"));this.aaa.log=Object(f.a)(this,this.atm,"onSignalRLog")}zdc(nb,La){return nb!==this.Igc?(k.ULS.sendTraceTag(4309017,500,50,"ConnectionToken verification failed for {0}",La),!1):!0}connect(){2!==this.h6&&1!==this.h6&&(k.ULS.sendTraceTag(4539721,500,50,
"Starting a new RTC connection for client [{0}]",this.Ku),this.lee.jmm(),z.a.instance.ywn(),this.Dda(1,this.h6),this.CKi())}CKi(){const nb=this.Igc;this.SBe=!1;this.Zv.pni();this.y2a.ael(Object(f.a)(this,this.Abk,"connectSignalrConnection"),Object(f.a)(this,this.kai,"onFailureToConnect"),Object(f.a)(this.Agb,this.Agb.zzl,"initThrottlerManager"),Object(f.a)(this,this.zdc,"verifyConnectionToken"),nb)}kai(nb=null){this.Zv.rni();let La=null;!nb||"documentsessiondeleted"!==(La=nb.toLowerCase())&&"documentsessionexpired"!==
La?this.Itd():(k.ULS.sendTraceTag(41788292,500,15,"In RealtimeChannel method OnFailureToConnect: Disconnect was called for [{0}], due to non-retriable RtcErrorCode:{1}",this.Ku,nb),this.disconnect())}Itd(nb,La=null){k.ULS.sendTraceTag(4309018,500,50,"Disconnecting the connection [{0}]",this.g6);nb=(nb=2===this.h6||1===this.h6)&&!this.Agb.Qvb;let Ha=!0,Aa=0;La&&Object.getType(La)!==Object.getType(Sys.EventArgs.Empty)&&La.rLf&&""!==La.rLf&&(nb=!0,this.y2a.qin(La.rLf),Ha=La.vOf,Aa=La.reconnectDelay);
nb&&this.Dda(1,this.h6);++this.Igc;this.Agb.Yea();this.Lxn(Ha);this.y2a.owk();this.Q9g();nb&&window.setTimeout(Object(f.a)(this,this.CKi,"startConnecting"),Math.min(Aa,3E4))}QMn(){let nb=null;const La=({correlationId:nb}=this.y2a.Guh()).returnValue;this.aaa.qs=La;k.ULS.sendTraceTag(40768457,500,50,"Connection parameters refresh finished for client [{0}], CorrelationId:{1}",this.Ku,nb)}Abk(nb){const {FrequentLoggingMetrics:La}=b(1339);this.iqe=(new Date).getTime();let Ha=null;this.aaa.qs=({correlationId:Ha}=
this.y2a.Guh()).returnValue;this.Kc.BLj&&(this.aaa.url=nb,La.instance&&(La.instance.A5g=l.a.p0(nb)));let Aa=null;this.Zc&&(Aa=this.Zc.Pe("WebServiceCall","ConnectToServer"));k.ULS.sendTraceTag(3290048,500,50,"Connecting to server for client [{0}]",this.Ku);nb={};this.Kid&&(nb.transport=1===this.Kid.length?this.Kid[0]:this.Kid);nb.pingInterval=null;z.a.instance.XRc(1,0);nb.waitForPageLoad=!1;this.aaa.start(nb,null).done(Ma=>{this.Zv.sni();z.a.instance.XRc(1,1,!0);k.ULS.sendTraceTag(3457857,500,50,
"Successfully connected to server using connection [{0}], CorrelationId:{1}",Ma.id,Ha)}).fail(Ma=>{const {RtcUtils:cb}=b(1307);k.ULS.sendTraceTag(3457858,500,15,"Failed to connect to server : connection string: {0}, CorrelationId:{1}, callback parameter:{2} for [{3}]",this.y2a.uU,Ha,cb.wCb(Ma),this.Ku);this.kai();this.Zv.qni(Ma);z.a.instance.XRc(1,1,!1);this.il.rmi(0,{["CorrelationId"]:Ha,["ErrorDetails"]:Ma,["ConnectionState"]:u.a[this.h6]})}).always(()=>{const {FrequentLoggingMetrics:Ma}=b(1339);
Aa&&Aa.stop();Ma.instance&&(Ma.instance.mie=!1)})}disconnect(){const {FrequentLoggingMetrics:nb}=b(1339);0===this.h6?k.ULS.sendTraceTag(36545632,500,50,"Disconnect for [{0}] was called but the channel is already Disconnected",this.Ku):(this.Zv.vni(),nb.instance&&(nb.instance.mie=!0),k.ULS.sendTraceTag(36545633,500,50,"Starting explicit disconnect for [{0}]",this.Ku),this.Agb.Qvb=!0,this.lee.Zmm(),this.Dda(0,this.h6),this.Itd(),this.Agb.Qvb=!1)}Lxn(nb){const La=this.l0j(),Ha=this.aaa,Aa=this.g6,Ma=
()=>{if(this.SBe)k.ULS.sendTraceTag(591692192,500,15,"Stop connection was called twice, possibly on the same connection.");else try{this.SBe=!0,Ha.stop(!0,nb)}catch(cb){k.ULS.sendTraceTag(591692191,500,15,"Stopping connection failed: {0}",cb.message)}};0<La?(k.ULS.sendTraceTag(4309020,500,50,"Waiting to stop connection [{0}]: [{1}] ms.",Aa,La),window.setTimeout(Ma,La)):(k.ULS.sendTraceTag(36804372,500,50,"Stopping connection [{0}].",Aa),Ma())}l0j(){let nb=0;0===this.aaa.state&&(nb=this.iqe+Sb.IVn-
(new Date).getTime(),0>nb&&(nb=0));return nb}get connectionState(){return this.h6}qwa(nb){this.il.qwa(nb)}WSc(nb){this.il.WSc(nb)}rzi(nb){this.MUc(0,nb)}MUc(nb,La){const Ha=new x.a;this.il.umi(nb,La,Ha);return Ha.task}SSa(nb){this.il.SSa(nb)}UEb(nb){this.il.UEb(nb)}wld(nb){this.il.wld(nb)}mYd(nb){this.il.mYd(nb)}vld(nb){this.il.vld(nb)}lYd(nb){this.il.lYd(nb)}hFc(nb){return this.Qkl(nb)}vwb(){return this.U4e(0)}U4e(nb){const La={};for(let Ha of this.XZ)Ha.value.Ja(nb)&&(La[Ha.key]=Ha.value.J(nb).data);
return La}Qkl(nb){return this.XZ.Ja(nb)&&this.XZ.J(nb).Ja(0)?this.XZ.J(nb).J(0).data:null}mum(nb,La){for(let Ha of La.sSn)this.XZ.Ja(Ha.key)||this.XZ.Z(Ha.key,new Ga.a),nb=Ha.value,this.XZ.J(Ha.key).Z(La.type,new F(nb.Presence,new Date(nb.TimeStamp))),Ha.key===this._clientId&&0===La.type&&this.il.nLm(nb.Presence)}kum(nb,La){for(const Ha of La.Apd)this.XZ.remove(Ha)}gRk(){const nb=new Ga.a;if(!this.XZ.Ja(this._clientId))return nb;for(let La of this.XZ.J(this._clientId))nb.Z(La.key,La.value.data);return nb}MM(nb,
La=null,Ha=!1){const Aa=new x.a;this.il.LHf(nb,La,Ha,Aa);return Aa.task}j3(nb){this.il.j3(nb)}Y8b(nb){this.il.Y8b(nb)}jbb(nb){let La,Ha;return({value:La}=this.XZ.Ab(nb)).returnValue&&({value:Ha}=La.Ab(0)).returnValue?new m(this.Vkl(Ha),Ha.timeStamp):null}DCc(){const nb={};for(let La of this.XZ)La.value.Ab(0).returnValue&&(nb[La.key]=this.jbb(La.key));return nb}GIb(nb){const La=new x.a;this.il.ZLm(nb,La);return La.task}get clientId(){return this._clientId}get itn(){return this.svj}dispose(){const {FrequentLoggingMetrics:nb}=
b(1339);this.uk||(this.Agb.Yea(),this.Qe.bYd(this.Zv),this.Zv.AIf(),nb.instance&&nb.instance.Vpf(),this.uk=!0)}nmm(nb,La){this.zdc(La,"StateChangedSignalR")&&this.Dda(this.d7g(nb.newState),this.d7g(nb.oldState))}Dda(nb,La){var {FrequentLoggingMetrics:Ha}=b(1339),{ClientToClientMessageTelemetry:Aa}=b(1599);if((1!==this.h6||0!==La||1!==nb)&&this.h6!==La){const Ma=String.format.apply(null,["Unexpected connection state change : Current state is '{0}' while the event indicates ('{1}'->'{2}') transition"].concat([this.h6,
La,nb]));k.ULS.sendTraceTag(3290053,500,10,Ma)}if(this.h6!==nb){switch(nb){case 2:Ha.instance&&Ha.instance.gam();this.g6=this.aaa.id;k.ULS.sendTraceTag(3249539,500,50,"Established connection [{0}] for client [{1}]",this.g6,this.Ku);this.e8l(this.aaa);k.ULS.sendTraceTag(4298369,500,50,"Retrieving complete session state");Ha=null;this.Zc&&(Ha=this.Zc.Pe("WebServiceCall","Receive First Presence"));Aa=this.Igc;this.il.HLm(Object(f.a)(this,this.zdc,"verifyConnectionToken"),Aa,this.lee,Object(f.a)(this,
this.QPe,"clearExistingPersistentState"),this.gRk(),Ha);this.Kc.O5m&&(Ha=100*Math.random()<=this.Kc.P5m,b(1599).ClientToClientMessageTelemetry.l_b(this.il,this.Kc,Ha).start());break;case 1:2===La&&k.ULS.sendTraceTag(4298644,500,50,"Lost connection [{0}] to the server ...trying to re-establish it",this.g6);break;case 0:if(Aa.instance&&Aa.instance.stop(),this.Agb.Qvb)k.ULS.sendTraceTag(3249543,500,50,"Connection [{0}] has been explicitly closed",this.g6);else{1===La&&(k.ULS.sendTraceTag(7672737,500,
50,"Signalr detected an unexpected disconnect event while attempting to re-establish connection [{0}]. Kicking off global reconnect logic ...",this.g6),this.Zv.wni());2===La&&k.ULS.sendTraceTag(36574532,500,50,"Signalr detected a disconnect event triggered by a period of client inactivity for connection [{0}]. Kicking off global reconnect logic ...",this.g6);this.Itd();return}}this.h6=nb;this.il.PKm(nb,La)}}e8l(nb){if(nb&&nb.transport&&nb.transport.name){nb=nb.transport.name;var La=nb.toLowerCase();
"websockets"===La?k.ULS.sendTraceTag(4290723,500,50,"Transport name - {0} for [{1}]",nb,this.Ku):"serversentevents"===La?k.ULS.sendTraceTag(4290752,500,50,"Transport name - {0} for [{1}]",nb,this.Ku):"foreverframe"===La?k.ULS.sendTraceTag(4290753,500,50,"Transport name - {0} for [{1}]",nb,this.Ku):"longpolling"===La?k.ULS.sendTraceTag(4290754,500,50,"Transport name - {0} for [{1}]",nb,this.Ku):"mocktransport"!==La&&k.ULS.sendTraceTag(4290755,500,15,"Unknown transport protocol encountered - '{0}'",
nb)}else k.ULS.sendTraceTag(4290722,500,10,"Transport protocol name is missing")}htm(){k.ULS.sendTraceTag(3249544,500,50,"Detected that the connection [{0}] is slow",this.g6)}$sm(){k.ULS.sendTraceTag(3249545,600,10,"SignalR ERROR for connection [{0}];",this.g6)}atm(nb){nb=b(1307).RtcUtils.wCb(nb);this.itn&&2E3>this.oGg&&!nb.startsWith("Invok")&&!nb.startsWith("Trigger")&&(k.ULS.sendTraceTag(578950464,500,50,"SignalR lib: {0}",nb),this.oGg++)}QPe(){let nb;const La=[];({value:nb}=this.XZ.Ab(this._clientId)).returnValue&&
this.XZ.remove(this._clientId);for(let Ha of this.XZ.keys)Array.add(La,Ha);for(const Ha of La)this.XZ.remove(Ha);nb&&this.XZ.Z(this._clientId,nb);this.il.hLm(La)}d7g(nb){switch(nb){case 0:return 1;case 2:return 1;case 1:return 2;case 4:return 0;default:throw Error.argumentOutOfRange("state",nb,"Unknown SignalR state");}}Vkl(nb){return nb&&nb.timeStamp?(new Date).getTime()-nb.timeStamp.getTime()>(this.Kc.qSj?6E4:this.Kc.pSj)?2:1:1}static createInstance(nb,La,Ha,Aa,Ma,cb,ib,Rb=null,Oa=null,lb=null,
gb=null,Nb=null,qc=null){return Ua(nb,La,Ha,qc,Aa,Ma,cb,ib,Rb,Oa,lb,Nb,gb)}}Sb.y4h=31E3;Sb.yrf=8E3;Sb.IVn=15E3;Object(G.a)(Sb,"RealtimeChannel",null,[845,846])},1448:function(G,P,b){b.d(P,"a",function(){return k});G=b(0);class k{constructor(){this.rHg=!1;this.ppb=null;this.Udg=0;this.Kie=this.Y$g();this.c3c=this.Y$g();this.Mkb=this.$Mb=0;this.wt=()=>new Date}get Hyn(){return this.rHg}Y$g(){const f=Array(6);for(let x=0;x<f.length;x++)f[x]=0;return f}n0k(){return this.Kie.toString()}WVk(){return this.c3c.toString()}ywn(){this.ppb=
this.wt()}XRc(f,x,u=!1){this.Hyn||(u&&(this.rHg=!0),u=this.wt(),0===f&&5<this.$Mb||1===f&&5<this.Mkb||(this.Udg<f?(1===this.$Mb%2&&(this.Kie[this.$Mb]=-1,this.$Mb++),this.Udg=f,1===x&&(this.c3c[this.Mkb]=-1,this.Mkb++),this.c3c[this.Mkb]=this.xVf(u),this.Mkb++):0===f?(this.Kie[this.$Mb]=this.xVf(u),this.$Mb++):(this.c3c[this.Mkb]=this.xVf(u),this.Mkb++)))}xVf(f){const x=f.getTime()-this.ppb.getTime();this.ppb=f;return x}static get instance(){k._instance||(k._instance=new k);return k._instance}static set instance(f){k._instance=
f}}k._instance=null;Object(G.a)(k,"LatencyMetrics",null,[])},1474:function(G,P,b){G=b(0);class k{constructor(){this.Sag=this.fee=!1;this.callback=null}rOc(x){this.callback=x;this.dQi()}R3h(x){this.fee||(this.fee=!0,this.eaj=x,this.dQi())}dQi(){this.fee&&this.callback&&!this.Sag&&(this.Sag=!0,this.callback(this.eaj))}}Object(G.a)(k,"CompletionTask",null,[]);b.d(P,"a",function(){return f});class f{constructor(){this.dvg=new k;this.bvg=new k}vRd(x){this.dvg.rOc(x)}uRd(x){this.bvg.rOc(x)}FMc(x){this.dvg.R3h(x)}aeb(x){this.bvg.R3h(x)}jrf(){this.FMc(2);
this.aeb(2)}}Object(G.a)(f,"MessageStatus",null,[886])},1538:function(G,P,b){b.d(P,"a",function(){return k});G=b(0);var k;(function(f){f[f.disconnected=0]="disconnected";f[f.connecting=1]="connecting";f[f.connected=2]="connected"})(k||(k={}));Object(G.b)("ChannelConnectionState",k)},1539:function(G,P,b){b.r(P);b.d(P,"MaxOutstandingThrottler",function(){return u});G=b(0);var k=b(41),f=b(63);P=b(1540);var x=b(1474);class u extends P.a{constructor(w,r=""){super(w,r);this.p5b=this.Aib=0;this.ma=new f.a;
this.nOb=!1;this.wbd=this.H3c=this.d3c=this.uDe=0;this.j_=[];this.clearTimeout=u.wWe}add(w){this.oOb||this.init(u.Pbh,u.Ebh);this.Yqb++;const r=new x.a;this.S2b?this.Z0d(w,r):this.wbd<this.p5b?this.LUc(w,r):(this.Z0d(w,r),this.nOb=!1);return r}LUc(w,r){w=this.KEg(w);const m=this.setTimeout(Object(k.a)(this,this.Tpm,"onMessageWaitTimeExpired"),this.Aib);++this.wbd;Array.add(this.j_,m);const l=this.d3c;w.vRd(z=>{r.FMc(z)});w.uRd(z=>{this.d3c===l&&(this.Spm(l,m),r.aeb(z))})}Spm(w,r){this.d3c===w&&(--this.wbd,
this.clearTimeout(r),Array.remove(this.j_,r),this.S2b&&this.uan())}uan(){this.S2b&&!this.nOb&&(this.uDe=this.setTimeout(Object(k.a)(this,this.van,"sendThrottledMessageFromTimer"),0),this.nOb=!0)}van(){this.nOb=!1;if(this.S2b){const w=this.aid,r=this.WRb;this.Dwc(!1);this.LUc(w,r)}}Tpm(){++this.H3c;this.H3c>Math.floor(this.p5b/2)&&(this.H3c=-1E9,this.ma.raiseEvent("TMUDM"))}xld(w){this.ma.addHandler("TMUDM",w)}reset(){this.Yqb=this.msc=this.lic=this.H3c=0;++this.d3c;for(const w of this.j_)this.clearTimeout(w);
this.wbd=0;this.j_=[];this.Dwc(!0);this.nOb&&(this.clearTimeout(this.uDe),this.uDe=0,this.nOb=!1)}init(w,r){this.oOb||(this.Aib=w,this.p5b=r,this.oOb=!0)}static createInstance(w,r=""){return new u(w,r)}static wWe(w){window.clearTimeout(w)}}u.Pbh=15E3;u.Ebh=5;Object(G.a)(u,"MaxOutstandingThrottler",P.a,[883,884])},1540:function(G,P,b){b.d(P,"a",function(){return f});G=b(0);var k=b(8);class f{constructor(x,u=""){this.lic=this.msc=0;this.boe=!1;this.WRb=this.aid=null;this.oOb=!1;this.KEg=x;this.nOi=
u;this.setTimeout=f.EWe;this.Yqb=this.msc=this.lic=0}zIf(){0<this.Yqb&&0<this.lic&&k.ULS.sendTraceTag(36545635,500,50,"Throttler [{0}] dropped [{1}] messages out of [{2}]",this.nOi,this.lic,this.Yqb);0<this.Yqb&&0<this.msc&&k.ULS.sendTraceTag(36545634,500,50,"Throttler [{0}] throttled [{1}] messages out of [{2}]",this.nOi,this.msc,this.Yqb)}get S2b(){return this.boe}Z0d(x,u){this.msc++;this.Dwc(!0);this.boe=!0;this.aid=x;this.WRb=u}Dwc(x){this.boe=!1;this.WRb&&x&&(this.lic++,this.WRb.jrf());this.WRb=
this.aid=null}static EWe(x,u){return window.setTimeout(x,u)}}Object(G.a)(f,"ThrottlerBase",null,[])},1541:function(G,P,b){b.r(P);b.d(P,"MaxRateThrottler",function(){return x});G=b(0);var k=b(41);P=b(1540);var f=b(1474);class x extends P.a{constructor(u,w=""){super(u,w);this.x5b=0;this.amc=(new Date(0)).getTime();this.currentTime=()=>(new Date).getTime()}init(u){this.oOb||(this.x5b=u,this.oOb=!0)}add(u){this.oOb||this.init(x.sbh);this.Yqb++;const w=this.currentTime(),r=new f.a;this.amc>w&&(this.amc=
w);this.S2b?(this.Dwc(!0),this.Z0d(u,r)):this.amc+this.x5b<=w?this.LUc(u,r):(this.Z0d(u,r),this.setTimeout(Object(k.a)(this,this.san,"sendThrottledMessage"),this.amc+this.x5b-w));return r}san(){if(this.S2b){const u=this.aid,w=this.WRb;this.Dwc(!1);this.LUc(u,w)}}LUc(u,w){this.amc=this.currentTime();u=this.KEg(u);u.vRd(r=>{w.FMc(r)});u.uRd(r=>{w.aeb(r)})}static createInstance(u,w=""){return new x(u,w)}}x.sbh=200;Object(G.a)(x,"MaxRateThrottler",P.a,[885,884])},1542:function(G,P,b){b.d(P,"a",function(){return k});
G=b(0);class k{}k.oNf="rr";k.R5m="rd";k.N5m="rbp";k.vOf="sa";Object(G.a)(k,"RtcReconnectParams",null,[])},1543:function(G,P,b){b.d(P,"a",function(){return k});G=b(0);class k{constructor(f,x,u,w){this.Adm=f;this.Aib=x;this.zbm=u;this.Zml=w}}Object(G.a)(k,"ThrottlerManagerSettings",null,[])},1582:function(G,P,b){b.r(P);G=b(0);var k=b(8),f=b(41),x=b(76),u=b(1538);class w{}w.x5b="throttling_messageDelay";w.ZJc="enabled";w.Aib="throttling_timeToWaitForResponse";w.p5b="throttling_maxNumberOfOutstandingMessages";
w.sGh="throttling_globalMaxNumberOfOutstandingMessages";w.errorMessage="errorMessage";w.RIi="url";w.oBa="queryString";w.uU="connectionString";Object(G.a)(w,"RtcFindSessionOutputFieldNameConstants",null,[]);var r=b(2),m=b(47),l=b(36),z=b(269),F=b(1391),L=b(74),E=b(16),A=b(133);class M{constructor(){this.tGh=this.v4h=this.w4h=this.B4h=0;this.UJd=!1;this.correlationId=this.uU=this.oBa=this.MRe=this.errorMessage=null}get zak(){return this.MRe+"?"+this.oBa}}Object(G.a)(M,"FindSessionResponse",null,[]);
var Q=b(549);class R{constructor(aa,ja,Ba,la,ia,oa){this.pRa=null;const {FindSessionStrategy:ha}=b(1582);this.Drj=aa;aa=String.format("{0}={1}",Q.a.clientId,E.a.ui(la));aa=String.format("{0}&{1}={2}",aa,Q.a.userSessionId,E.a.ui(ia));aa=String.format("{0}&{1}={2}",aa,Q.a.dXi,E.a.ui(Ba.toString()));aa=String.format("{0}&{1}={2}",aa,Q.a.userType,E.a.ui("1"));aa=String.format("{0}&{1}={2}",aa,Q.a.qXi,E.a.ui(ja));aa=String.format("{0}&{1}={2}",aa,Q.a.P2g,E.a.ui(ha.D7j));(ja=R.j5e(Ba,oa))&&(aa=String.format("{0}&{1}",
aa,ja));this.maj=aa}woi(){this.pRa=this.Drj()}COk(){this.pRa&&""!==this.pRa||(this.woi(),k.ULS.sendTraceTag(575784194,500,this.pRa&&""!==this.pRa?50:15,"Query signature delegate called for refresh returned: {0} ",this.pRa));const aa=String.format("{0}={1}",Q.a.qEb,E.a.ui(this.pRa));return String.format("{0}&{1}",aa,this.maj)}static j5e(aa,ja){return 4===aa?String.format("{0}={1}",Q.a.N7h,"1"):ja?ja.tFh():null}}Object(G.a)(R,"FindSessionQueryStringGenerator",null,[]);var K=b(1339),J=b(1448),O=b(1307),
N=b(1543);class V{}V.nJk="FSType";Object(G.a)(V,"RtcFindSessionRequestHeaders",null,[]);class W{}W.XMm="polling";Object(G.a)(W,"RtcFindSessionTypes",null,[]);var ca=b(1542);class H{}H.FUn="RTC-TokenProofkey";H.iVl="RTC-IsWacJsBootFsRequest";Object(G.a)(H,"RtcRequestHeaders",null,[]);b.d(P,"FindSessionStrategy",function(){return Z});class Z{constructor(aa,ja,Ba,la,ia,oa,ha,pa,Ea,Fa,Ga,$a,fa=null){this.Xrg=(new Date(0)).getTime();this.hug=0;this.vad=!1;this.WEg=null;this.QIf=36E5;this.tLb=Z.BMh;this.Oic=
0;this.eFb=null;this.MMa=0;this.K9b=this.C5g=null;this.Fsj=[w.ZJc,w.errorMessage,w.RIi,w.uU,w.oBa,w.sGh,w.p5b,w.Aib,w.x5b];this.Esj=[w.ZJc,w.errorMessage];this.uU=this.Xdb=null;this.Fig=new R(Ga?Ga:()=>r.AFrameworkApplication.kl,ia,oa,ha,aa,ja);this.Zfc=$a;this.Zc=la;this.Qe=ja;this.Oie=Ba;this.Ku=pa;this.il=Ea;this.gjc=fa;this.Gig=!1;this.Swd=9E4;Fa&&Fa.execute(sa=>{sa.S7a(()=>{k.ULS.sendTraceTag(40768456,500,50,"Connection parameters refresh requested for client [{0}]",this.Ku);this.Fig.woi()})});
2>=100*Math.random()&&(this.QIf=3E5);K.FrequentLoggingMetrics.instance&&(K.FrequentLoggingMetrics.instance.Ioh=this.QIf)}qin(aa){this.K9b=aa}init(){this.il.wJj(Object(f.a)(this,this.R1m,"resetGetMachineIdDelay"));this.il.qwa(Object(f.a)(this,this.Dda,"onConnectionStateChanged"))}Dda(aa,ja){this.MMa=ja.newState;2===ja.newState&&(this.Oic=0)}Guh(){let aa;aa=this.eFb.correlationId;return{returnValue:String.format("{0}&{1}={2}",this.eFb.oBa,Z.K7g,E.a.ui(aa)),correlationId:aa}}ael(aa,ja,Ba,la,ia){this.x$m(()=>
{la(ia,"GetMachineIdSuccess")&&(k.ULS.sendTraceTag(17956951,500,50,"Successfully retrieved Rtc MachineId [{0}] for [{1}]",this.uU,this.Ku),aa(this.WEg),Ba(this.cjl()))},oa=>{la(ia,"GetMachineIdFailure")&&(k.ULS.sendTraceTag(4060129,500,15,"Failed to retrieve Rtc MachineId for [{0}]",this.Ku),ja(oa))},la,ia)}owk(){this.v2g();this.hyl()}x$m(aa,ja,Ba,la){k.ULS.sendTraceTag(17956952,500,50,"Retrieving Rtc MachineId from server. Getting from last findsession, connectionString is [{0}]",this.uU);if(this.uU)aa();
else{var ia=this.u_j();window.setTimeout(()=>{this.sendFindSessionRequestToServerInternal(aa,ja,Ba,la)},ia)}}sendFindSessionRequestToServerInternal(aa,ja,Ba,la){Ba(la,"RequestMachineId")&&(this.Xrg=(new Date).getTime(),Ba=l.a.ie(),this.Ezd(ia=>{const oa=l.a.ie();this.ygi(ia);this.nQf();aa();ia=l.a.ie()-oa;k.ULS.sendTraceTag(577356039,345,50,"SFSRTS Success - TimeElapsed: {0}",ia)},ia=>{const oa=l.a.ie();this.v2g();K.FrequentLoggingMetrics.instance&&K.FrequentLoggingMetrics.instance.yM(2,3);ja(ia);
ia=l.a.ie()-oa;k.ULS.sendTraceTag(577356040,345,50,"SFSRTS Failure - TimeElapsed: {0}",ia)},!1),Ba=l.a.ie()-Ba,k.ULS.sendTraceTag(577599296,345,50,"SFSRTS - TimeElapsed: {0}",Ba))}hyl(){this.tLb+=Z.A6k;this.tLb=Math.min(this.tLb,Z.ibm)}u_j(){var aa=(new Date).getTime();aa=this.Xrg+this.tLb-aa;0>aa&&(aa=0);return aa}ygi(aa){try{this.eFb=aa,this.Xdb=aa.zak,this.uU=aa.uU,this.C5g=aa.oBa,this.WEg=aa.MRe}catch(ja){k.ULS.sendTraceTag(17956953,500,10,"FindSession response contains invalid fields. Exception {0}, is thrown",
ja.toString())}}v2g(){this.uU=null;this.w2g()}nQf(){this.w2g();this.vad=!0;this.hug=window.setTimeout(Object(f.a)(this,this.xQm,"refreshMachineId"),this.QIf)}w2g(){this.vad&&(window.clearTimeout(this.hug),this.vad=!1)}xQm(){this.vad=!1;this.Ezd(aa=>{const ja=this.C5g!==aa.oBa,Ba=this.uU!==aa.uU,la=this.uU;this.ygi(aa);0!==this.MMa&&(Ba?(k.ULS.sendTraceTag(17956955,500,15,"Recycling RTC connection due to RTC machine id change. old={0}, new={1}",la||"null",aa.uU),this.il.bXd()):(this.il.MLm(ja,Ba),
this.nQf()))},()=>{K.FrequentLoggingMetrics.instance&&K.FrequentLoggingMetrics.instance.yM(2,3);this.nQf()},!0)}R1m(){this.tLb=Z.BMh}cjl(){return new N.a(this.eFb.B4h,this.eFb.w4h,this.eFb.v4h,this.eFb.tGh)}nGn(aa){if(Object.getType(aa)!==Object)return null;for(let ja in aa);return this.Shk(aa)}Shk(aa){if(!(w.ZJc in aa))return null;const ja=aa[w.ZJc];var Ba=ja?this.Fsj:this.Esj;for(const la of Ba)if(!(la in aa))return null;Ba=Object.assign(new M,{UJd:aa[w.ZJc],errorMessage:aa[w.errorMessage],correlationId:A.a.create().toString()});
ja&&(Ba.MRe=aa[w.RIi],Ba.oBa=aa[w.oBa],Ba.uU=aa[w.uU],Ba.tGh=aa[w.sGh],Ba.v4h=aa[w.p5b],Ba.w4h=aa[w.Aib],Ba.B4h=aa[w.x5b]);return Ba}o0k(aa,ja){k.ULS.sendTraceTag(50448152,500,50,"Using FindSessionUtils find session response");this.gjc.$lh.continueWith(()=>{this.gjc.$lh.result?(k.ULS.sendTraceTag(50448153,500,50,"FindSessionUtils find Session resulted in success"),aa(this.gjc.amh)):(k.ULS.sendTraceTag(50448154,500,15,"FindSessionUtils find Session resulted in error"),ja(this.gjc.amh))})}Wti(aa,ja,
Ba,la,ia=!1){return oa=>{J.a.instance.XRc(0,1);aa&&aa.stop();this.Zfc=this.K9b=null;this.H1h(oa.data,!0,ja);var ha=O.RtcUtils.deserialize(oa.data.qd,"FindSession",null);if(ha)if(ha=this.nGn(ha)){if(ha.UJd&&ha.oBa&&ha.uU){k.ULS.sendTraceTag(4317446,500,50,"Successfully retrieved MachineId from server for [{0}]",this.Ku);this.d3l(oa.data);Ba(ha);return}ja.FindSessionFailureReason="FindSessionInvalidResponse";ja.IsRtcEnabled=ha.UJd;ja.IsQueryStringEmpty=!ha.oBa;ja.IsConnectionStringEmpty=!ha.uU;k.ULS.sendTraceTag(4290720,
500,15,"Response did not contain valid MachineId [ConnectionUrl and/or QueryString] for [{0}]; IsRtcEnabled:{1}; IsQueryStringEmpty:{2}; IsConnectionStringEmpty:{3}",this.Ku,ha.UJd,!ha.oBa,!ha.uU)}else ja.FindSessionFailureReason="FindSessionTranslateServerResponseFailed",k.ULS.sendTraceTag(8745097,500,15,"Could not translate server response to findSession response for [{0}]",this.Ku);else ja.FindSessionFailureReason="FindSessionDeserializeServerResponseFailed",k.ULS.sendTraceTag(7372827,500,10,"Could not deserialize response data for [{0}]",
this.Ku);this.smi(ja,ia);la(null)}}Qti(aa,ja,Ba,la=!1){return ia=>{J.a.instance.XRc(0,1);aa&&aa.stop();this.Zfc=this.K9b=null;this.H1h(ia.data,!1,ja);let oa=null;var ha="unknown";let pa="unknown";ia.data&&((ha=ia.data.oj)&&Z.iUc in ha&&(oa=ha[Z.iUc].toString()),ha=F.a[ia.data.status],pa=ia.data.we.toString());ja.FindSessionFailureReason="FindSessionRequestFailed";ja.HttpErrorCode=pa;ja.HttpErrorStatus=ha;ja[Z.iUc]=oa;k.ULS.sendTraceTag(4290721,500,15,"Request for MachineId failed with Status='{0}'; HttpStatus='{1}' for [{2}]; RtcErrorCode='{3}'. Polling: '{4}' '",
ha,pa,this.Ku,oa,la);this.smi(ja,la);Ba(pa)}}Ezd(aa,ja,Ba=!1){let la=null;k.ULS.sendTraceTag(4317445,500,50,"Getting MachineId from server for [{0}]",this.Ku);const ia={};var oa=this.Fig.COk();ia[z.a.L3]=A.a.create().toString();this.K9b&&""!==this.K9b?oa=String.format("{0}&{1}={2}",oa,ca.a.oNf,this.K9b):this.Zfc&&""!==this.Zfc&&(oa=String.format("{0}&{1}={2}",oa,ca.a.oNf,this.Zfc),ia[H.FUn]="True",ia[H.iVl]="True");oa=this.Oie+"?"+oa;Ba&&(ia[V.nJk]=W.XMm);const ha={};ha.IsNetworkOfflineBeforeSendRequest=
this.Qe.lKa;ha.HasAvailableConnectionsBeforeSendRequest=this.Qe.HEd;ha.MaxConnectionsAllowed=this.Qe.m5b;ha.IsRefreshMachineId=Ba;this.gjc&&!this.Gig?(this.o0k(this.Wti(null,ha,aa,ja,Ba),this.Qti(null,ha,ja,Ba)),this.Gig=!0):(this.Zc&&(la=this.Zc.Pe("WebServiceCall","GetMachineIdFromTheServer")),K.FrequentLoggingMetrics.instance&&K.FrequentLoggingMetrics.instance.yM(2,0),0>this.Qe.oTb(oa,1,null,ia,[Z.jrd,Z.iUc,Z.YNc,Z.nNf,Z.K6h,Z.k9h,Z.j9h],1,this.Wti(la,ha,aa,ja,Ba),this.Qti(la,ha,ja,Ba),null,!1,
null,this.Swd,"3",null,!0)&&(5<this.Oic&&200>this.Oic&&k.ULS.sendTraceTag(578166985,500,15,"FindSession request not scheduled due to expired token. Manually triggered failure callback {0} times.",this.Oic),window.setTimeout(()=>{this.Oic++;ja("-1")},1E3)))}H1h(aa,ja,Ba){Ba||(Ba={});Ba.IsNetworkOfflineAfterRequestComplete=this.Qe.lKa;Ba.IsRequestSucceeded=ja;aa&&(Ba.EnqueueTime=aa.hIa,Ba.InvokedTime=aa.yF,Ba.CompletedTime=aa.VQ,aa.oj&&(Z.jrd in aa.oj&&(Ba.CorrelationId=aa.oj[Z.jrd]),Z.YNc in aa.oj&&
(Ba[Z.YNc]=aa.oj[Z.YNc])));k.ULS.sendTraceTag(38633565,500,ja?50:15,O.RtcUtils.wCb(Ba))}smi(aa,ja){aa||(aa={});aa.ConnectionState=u.a[this.MMa];ja||this.il.rmi(1,aa)}d3l(aa){try{var ja=!1,Ba=!1,la=aa.oj,ia=m.a.p0(aa.request.get_url());if(la&&Z.nNf in la){const Fa=la[Z.nNf].toString().toLocaleLowerCase();Ba="true"===Fa;ja="false"===Fa}la=!1;const Ea=0<=ia.toLocaleLowerCase().indexOf("collab");Ba&&!Ea?la=!0:ja&&Ea&&(la=!0);if(la){ja={};ja.HostName=ia;ja.Status=F.a[aa.status];ja.HttpStatus=aa.we.toString();
var oa=aa.request.get_headers();for(let Fa in oa){var ha=oa[Fa];(ia=Fa)&&0<ia.length&&(Ba=0,ha&&(Ba=ha.toString().length),ja["r_"+ia]=Ba)}if(aa.oj){const Fa=new x.a;Fa.add(Z.jrd);Fa.add(Z.YNc);Fa.add(Z.iUc);Fa.add(Z.k9h);Fa.add(Z.j9h);Fa.add(Z.K6h);Z.rFj(ja,aa.oj,Fa)}Z.cFj(aa.request.get_url(),ja);var pa=L.a.toJSON(ja);k.ULS.sendTraceTag(559437006,500,15,pa)}}catch(Ea){k.ULS.sendTraceTag(559437007,500,10,"DomainLandingIncorretDC exception[{0}]",Ea.toString())}}static createInstance(aa,ja,Ba,la,ia,
oa,ha,pa,Ea,Fa,Ga,$a=null){return Z.Sik(aa,ja,Ba,la,ia,oa,ha,pa,Ea,Fa,Ga,$a)}static Sik(aa,ja,Ba,la,ia,oa,ha,pa,Ea,Fa,Ga,$a=null){aa=aa||A.a.create().toString();aa=new Z(aa,ja,Ba,la,ia,oa,ha,pa,Ea,Fa,null,Ga,$a);aa.init();return aa}static rFj(aa,ja,Ba){for(let la of Ba)la in ja&&(aa[la]=ja[la])}static cFj(aa,ja){if(aa){var Ba=aa.indexOf("?");if(-1!==Ba)for(aa=aa.substr(Ba+1).split("&"),Ba=0;Ba<aa.length;++Ba){var la=aa[Ba].split("=");if(2===la.length){const ia=la[0];if(ia&&0<ia.length){let oa=0;if(la=
la[1])oa=la.length;ja["q_"+ia]=oa}}}}}}Z.A6k=3E3;Z.ibm=3E5;Z.D7j="1.0";Z.BMh=1E3;Z.jrd="X-CorrelationId";Z.K7g="corrid";Z.iUc="RtcErrorCode";Z.YNc="X-OfficeCluster";Z.nNf="X-NewEnv";Z.K6h="X-MSEdge-Ref";Z.j9h="X-OFFICEFD";Z.k9h="X-OfficeFE";Object(G.a)(Z,"FindSessionStrategy",null,[870])},1599:function(G,P,b){b.r(P);G=b(0);var k=b(8),f=b(41),x=b(405),u=b(51),w=b(76);class r{constructor(l){this.messageId=l;this.xan=(new Date).getTime();this.Wnf=new w.a}}Object(G.a)(r,"MessageLatencyDetails",null,[]);
b.d(P,"ClientToClientMessageTelemetry",function(){return m});class m{constructor(l,z,F){this.iFa=null;this.Vre=this.Zze=0;this.Kc=z;this.evg=F;this.Zqc=!1;this.il=l;this.il.j3(Object(f.a)(this,this.wNm,"receiveMessage"))}start(){if(this.evg&&!this.Zqc){const l=this.Kc.nwi;this.Vre=this.Kc.jwi;l<=this.Vre?(k.ULS.sendTraceTag(570975114,500,15,"LogMetrics cannot be started because configuration values are incorrect. RtcSendTelemetryMessageIntervalInMS({0}) should be greater than RtcLogClientMessageMetricsTimeOutInMs({1})",
this.Kc.nwi,this.Kc.jwi),this.evg=!1):(this.Zqc=!0,this.Zze=window.setInterval(Object(f.a)(this,this.Qg,"sendMessage"),l))}}Qg(){if(this.Zqc){const l=u.a.create().toString();this.iFa=new r(l);this.il.LHf(16,l,!1,new x.a);window.setTimeout(()=>{this.p5l(l)},this.Vre)}}p5l(l){this.iFa&&this.iFa.messageId===l&&(0<this.iFa.Wnf.count?(l=this.iFa.Wnf.toArray().join(","),k.ULS.sendTraceTag(571339719,500,15,"ClientMessageLatencies:[{0}]",l)):k.ULS.sendTraceTag(562312150,500,50,"No client message latencies recorded"),
this.iFa=null)}stop(){this.Zze&&(window.clearInterval(this.Zze),this.Zqc=!1)}wNm(l,z){16===z.type?this.il.LHf(17,z.Q5,!1,new x.a):17===z.type&&this.Zqc&&z.Q5&&this.lGm(z.Q5)}lGm(l){l&&this.iFa&&l.toString()===this.iFa.messageId&&(l=(new Date).getTime()-this.iFa.xan,this.iFa.Wnf.add(l))}static get instance(){return m._instance}static l_b(l,z,F){return m.instance||(m._instance=new m(l,z,F))}}m._instance=null;Object(G.a)(m,"ClientToClientMessageTelemetry",null,[])},1686:function(G,P,b){b.d(P,"a",function(){return k});
G=b(0);class k extends Sys.EventArgs{constructor(f,x){super();this.XCa=f;this.Ktd=x}}Object(G.a)(k,"PresenceUpdatedEventArgs",Sys.EventArgs,[])},1687:function(G,P,b){b.r(P);b.d(P,"RealtimeChannelMetrics",function(){return w});G=b(0);var k=b(8),f=b(176),x=b(74),u=b(1307);class w{constructor(){this.Nwg=this.Owg=this.Pwg=this.Kwg=this.Jwg=this.Lwg=this.Nnc=this.Gte=0;this.i6c=this.Jqe=this.cmc=this.tqe=this.uqe=this.hqe=this.e5a=this.Plc=this.xOb=this.gqe=this.g6c=this.MMb=null;this.gse=this.$mc=this.UEg=
this.Ubg=0;this.fvg=!1;this.pni=this.kIf;this.sni=this.nIf;this.rni=this.mIf;this.wni=this.qIf;this.vni=this.pIf;this.AIf=this.BIf;this.xIf=this.yIf;this.CEb=this.vIf;this.YRc=this.wIf;this.qni=this.lIf;this.mLa=this.zvf;this.ueb=this.Avf}kIf(){this.Gte++;this.gqe=new Date;this.MMb||(this.MMb=new Date)}nIf(){this.Nnc++;this.e5a=new Date;this.g6c||(this.g6c=this.e5a);this.cmc=this.e5a;this.Tak()}mIf(){this.Lwg++;this.hqe=new Date}qIf(){this.Jwg++;this.xOb=new Date}pIf(){this.Kwg++;this.Plc=new Date}yIf(){this.uqe=
new Date;this.Pwg++}wIf(){this.i6c||(this.i6c=new Date);this.Owg++}vIf(){this.tqe=new Date;this.Nwg++}BIf(){!this.fvg&&this.Gte&&(k.ULS.sendTraceTag(39321871,500,15,x.a.toJSON(this.i9j())),this.fvg=!0)}lIf(r){let m,l;({VKh:r,XKh:m,exception:l}=u.RtcUtils.nFk(r));r&&r!==f.a.wA&&(k.ULS.sendTraceTag(40157596,500,15,x.a.toJSON({["HttpErrorCode"]:r,["HttpErrorStatus"]:m,["Exception"]:l})),f.a.Ohf(r)&&this.Ubg++,f.a.Plf(r)&&this.UEg++)}zvf(){this.Jqe=new Date}Avf(){this.xOb=this.cmc=new Date}i9j(){return{["numberOfConnectionAttempts"]:this.Gte,
["numberOfSuccessfulConnections"]:this.Nnc,["numberOfFailedConnections"]:this.Lwg,["numberOfDisconnectedConnections"]:this.Jwg,["numberOfExplicitDisconnectedConnections"]:this.Kwg,["numberOfSentMessages"]:this.Pwg,["numberOfReceivedMessages"]:this.Owg,["numberOfLostMessages"]:this.Nwg,["firstConnectionAttempt"]:this.MMb?this.MMb:null,["firstMessageReceived"]:this.i6c?this.i6c:null,["firstConnectionSuccess"]:this.g6c?this.g6c:null,["lastConnectionAttempt"]:this.gqe?this.gqe:null,["lastConnectionSuccess"]:this.e5a?
this.e5a:null,["lastConnectionFailure"]:this.hqe?this.hqe:null,["lastMessageSent"]:this.uqe?this.uqe:null,["lastMessageLost"]:this.tqe?this.tqe:null,["lastDisconnect"]:this.xOb?this.xOb:null,["lastExplicitDisconnect"]:this.Plc?this.Plc:null,["lastTimeOnline"]:this.cmc?this.cmc:null,["lastTimeOffline"]:this.Jqe?this.Jqe:null,["maxDisconnectedTimeMs"]:this.$mc,["maxExplicitDisconnectedTimeMs"]:this.gse,["clientConnectionErrors"]:this.Ubg,["serverConnectionErrors"]:this.UEg}}Tak(){this.MMb&&1===this.Nnc&&
(this.$mc=Math.max(this.$mc,this.e5a.getTime()-this.MMb.getTime()));this.xOb&&1<this.Nnc&&(this.$mc=Math.max(this.$mc,this.e5a.getTime()-this.xOb.getTime()));this.Plc&&1<this.Nnc&&(this.gse=Math.max(this.gse,this.e5a.getTime()-this.Plc.getTime()))}static createInstance(r){w._instance||(w._instance=new w,k.ULS.sendTraceTag(39321870,500,50,"RealtimeChannelMetrics initialized for client {0}",r));return w._instance}}w._instance=null;Object(G.a)(w,"RealtimeChannelMetrics",null,[871,207])},1688:function(G,
P,b){b.d(P,"a",function(){return k});G=b(0);class k extends Sys.EventArgs{constructor(f,x){super();this.type=f;this.XCa=x}}Object(G.a)(k,"PersistentStateUpdateEventArgs",Sys.EventArgs,[])},1689:function(G,P,b){b.d(P,"a",function(){return k});G=b(0);class k extends Sys.EventArgs{constructor(f){super();this.Apd=f}}Object(G.a)(k,"PersistentStateClearedEventArgs",Sys.EventArgs,[])},1812:function(G,P,b){b.r(P);var k=b(0),f=b(41);class x{constructor(wa,kb){this.YZ=null;this.bpc=wa;this.Cqj=kb}init(){this.bpc.continueWith(()=>
{this.YZ=this.bpc.result;this.YZ.ATb(Object(f.a)(this,this.jY,"onUsersUpdated"))})}jY(){x.XKe(this.YZ.vVa())&&(this.YZ.oYd(Object(f.a)(this,this.jY,"onUsersUpdated")),this.Cqj.IsRealCoauthSession=!0)}get SQl(){return this.YZ?x.XKe(this.YZ.vVa()):!1}static XKe(wa){let kb=null;for(const Pb of wa)if(Pb)if(wa=Pb.isAnonymous||!Pb.email?Pb.clientId:Pb.email.toUpperCase(),!kb)kb=wa;else if(kb!==wa)return!0;return!1}}Object(k.a)(x,"CoauthTelemetry",null,[283]);var u=b(8),w=b(405),r=b(69),m=b(2),l;(function(wa){wa[wa.badStatePreventedTelemetry=
0]="badStatePreventedTelemetry";wa[wa.notImplemented=1]="notImplemented";wa[wa.renderHandled=2]="renderHandled";wa[wa.renderHandledWithVeto=3]="renderHandledWithVeto"})(l||(l={}));Object(k.b)("CoauthorGalleryTelemetryEndResult",l);var z=b(79),F=b(74),L=b(114);class E{constructor(wa,kb,Pb,Hb,bd,nc,Qe,ye,lf){this.dAg=this.ocg=this.KA=null;this.U1=wa;this.Qgd=new w.a;this.qa=Pb;this.Rde=kb;this.X1=Hb;this.sg=bd;this.dwe=nc;this.$5a=Qe;this.S7i=ye;this.zlg=this.rlg=!1;this.gid=0;this.lcg=1;this.ukb=lf;
this.Ysc=this.qa.$("PeoplesWellExtraButtonInfoIsEnabled");this.pma=Object(r.a)(String,m.AFrameworkApplication.sessionStartInfoSettings.Application)||""}get bLi(){return this.Qgd.task}init(){L.Task.WAA.call(null,this.$5a,this.Rde,this.dwe).continueWith(()=>{this.KA=this.$5a.result;this.ocg=this.Rde.result;this.dAg=this.dwe.result;L.Task.WAA.call(null,this.Rde.result.CVb,this.dwe.result.sOi).continueWith(()=>{this.lcg=this.ocg.CVb.result;this.gid=this.dAg.sOi.result;this.KA.ATb(Object(f.a)(this,this.ySd,
"onUsersUpdatedEventListener"));this.KA.vVa().length&&this.jY()})})}ySd(){this.jY()}jY(){this.S7i(this.KA.vVa())?(this.KA.oYd(Object(f.a)(this,this.ySd,"onUsersUpdatedEventListener")),this.Mnm(this.rlg)):this.Qgd.HS(1);this.rlg=!0}Mnm(wa){this.zlg?this.bLi.continueWith(()=>{u.ULS.sendTraceTag(42062996,325,15,"We already attempted to log a render of coauthor gallery: {0}",l[this.bLi.result])}):(this.zlg=!0,this.ZGm(0===this.lcg&&!wa))}ZGm(wa){wa?this.X1.Vk(4,Object(f.a)(this,this.czf,"onInteractiveReady")):
this.Qgd.HS(1)}czf(){const wa=this.sg.cK("AppInitStatus_interactivityReady");u.ULS.shipAssertTag(42259235,325,!!this.gid);const kb=this.gid-wa,Pb={};Pb.InteractiveTime=wa;Pb.ReactRenderComplete=this.gid;Pb.HadTabSwitch=this.ukb();Pb.IsModernGallery=this.Ysc;u.ULS.sendTraceTag(594883104,325,50,F.a.toJSON(Pb));this.Ysc?(u.ULS.sendTraceTag(42062997,325,15,kb.toString()),this.Qgd.HS(this.XUn(kb)?3:2)):u.ULS.sendTraceTag(594883103,325,15,kb.toString())}XUn(wa){const kb=wa>this.qa.vb("CoauthorGalleryTimeToRenderDurationMs",
1E4),Pb="Word"===this.pma;if(this.ukb())return u.ULS.sendTraceTag(50455714,325,50,kb.toString()),!1;Pb&&z.Health.instance.recordKpiUsage("CoauthGalleryExperienceDegraded",0,"wordcollabrel",null);kb&&(Pb&&z.Health.instance.recordKpiFailure("CoauthGalleryExperienceDegraded","CoauthorGalleryTimeToRenderDurationIsTooLong",!1,!0,null),u.ULS.sendTraceTag(42062998,325,15,wa.toString()));return kb}}Object(k.a)(E,"CoauthorGalleryTelemetry",null,[285]);class A{constructor(wa){this.KA=null;this.O2c={};this.Ycd=
{};this.Fkc=null;this.$5a=wa}xBd(wa){const kb=new w.a;this.init().continueWith(()=>{wa in this.O2c?kb.HS(this.O2c[wa]):this.Ycd[wa]=kb});return kb.task}init(){if(this.Fkc)return this.Fkc.task;this.Fkc=new w.a;this.$5a.continueWith(()=>{this.KA=this.$5a.result;this.KA.ATb(Object(f.a)(this,this.jY,"onUsersUpdated"));this.EVi();this.Fkc.Jf(null)});return this.Fkc.task}EVi(){const wa=this.KA.vVa();wa.sort(Object(f.a)(this,this.qak,"comparePresenceUsers"));this.O2c={};for(let kb=0;kb<wa.length&&wa[kb]&&
wa[kb].GKa;kb++)this.UEj(this.O2c,wa[kb].clientId,kb)}UEj(wa,kb,Pb){wa[kb]=Pb;kb in this.Ycd&&(this.Ycd[kb].HS(Pb),delete this.Ycd[kb])}jY(){this.EVi()}qak(wa,kb){return wa.GKa>kb.GKa?1:wa.GKa<kb.GKa?-1:0}}Object(k.a)(A,"CoauthorPositionFinder",null,[284]);var M=b(76);class Q{constructor(wa,kb,Pb,Hb){this.YZ=null;this.lhe=this.Zse=!1;this.bpc=wa;this.CCe=kb;this.qa=Pb;this.cPb=Hb}get Fah(){return this.qa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.IsCustomAnonymousNameEnabled",!1)}get eol(){return this.qa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.GuestCoauthFloodgateEnabled",
!1)}init(){this.bpc.continueWith(()=>{this.YZ=this.bpc.result;this.YZ.ATb(Object(f.a)(this,this.jY,"onUsersUpdated"))})}jY(){this.g9j(this.YZ.vVa());!this.Zse||this.Fah&&!this.lhe||this.YZ.oYd(Object(f.a)(this,this.jY,"onUsersUpdated"))}g9j(wa){const kb=new M.a;let Pb=0;for(const Hb of wa)Hb&&Hb.isAnonymous&&(m.AFrameworkApplication.Mg("70eb6120;2gfeb930"),this.Fah&&!this.lhe&&(kb.contains(Hb.userName)?(u.ULS.sendTraceTag(526394833,302,50,"Duplicate guest friendly name detected"),this.lhe=!0):kb.add(Hb.userName)),
Hb.clientId===this.cPb||this.Zse||(Pb++,2<=Pb&&this.y5l()))}y5l(){u.ULS.sendTraceTag(525112603,302,50,"Multiple guests simultaneously coauthoring");this.Zse=!0;this.eol&&this.CCe&&this.CCe.continueWith(()=>{window.setTimeout(()=>{this.CCe.result.logActivity("MultipleGuestsCoauthoring",null)},5E3)})}}Object(k.a)(Q,"GuestCoauthTelemetry",null,[]);var R=b(231);class K{constructor(){this.id=null;this.d=this.tp=this.mp=this.st=this.et=0;this.ct=null;this.vc=!1}}Object(k.a)(K,"PL",null,[]);var J=b(31);
class O{constructor(){this.ct=this.vt=this.d=0}static Dzi(wa,kb,Pb){const Hb=new O;Hb.d=wa;Hb.vt=kb;Hb.ct=Pb;return J.c(Hb)}}Object(k.a)(O,"VD",null,[]);var N=b(295);class V{constructor(wa,kb,Pb,Hb,bd,nc,Qe,ye,lf){this.cFg=!1;this._id=wa;this.lh=kb;this.wq=Pb;this.$se=Hb;this.rDe=bd;this.prb=nc;this.glb=Qe;this.Ede=ye;this.ukb=lf;this.pma=Object(r.a)(String,m.AFrameworkApplication.sessionStartInfoSettings.Application)||""}b8d(wa){L.Task.WAA(this.$se,this.rDe).continueWith(()=>{if(this.$se.result<=
this.rDe.result)wa.HS(!1);else{var kb=this.wq-this.lh,Pb=new K;Pb.id=this._id;Pb.et=this.wq;Pb.st=this.lh;Pb.d=this.wq-this.lh;Pb.mp=this.$se.result;Pb.tp=this.rDe.result;Pb.ct=this.ZUk(this.Ede);Pb.vc=this.ukb();var Hb=J.c(Pb),bd="Word"===this.pma;u.ULS.sendTraceTag(42078597,302,15,Hb);if(bd){const nc=new Map;nc.set("data",Hb);z.Health.instance.recordKpiUsage("PresenceExperienceDegraded",0,"wordcollabrel",nc)}kb>this.prb.value&&!this.cFg&&!Pb.vc&&(this.cFg=!0,wa.HS(!0),Pb=Object.assign(new N.a,{inStaging:!0,
extendedProperties:new Map}),Pb.extendedProperties.set("data",Hb),bd&&z.Health.instance.recordKpiFailure("PresenceExperienceDegraded","PresenceRenderDurationIsTooLong",!1,!0,Pb),kb<this.glb.value&&u.ULS.sendTraceTag(42078598,302,15,O.Dzi(kb,this.prb.value,this.glb.value)));wa.task.isCompleted||wa.HS(!1)}})}ZUk(wa){switch(wa){case 2:return"NonWac";case 0:return"Unknown";case 1:return"Wac";default:return"Unknown"}}}Object(k.a)(V,"PresenceLatencyActivityLogger",null,[]);class W{constructor(wa,kb,Pb){this.gbg=
this.jcg=this.u2c=this.N2c=this.bKb=0;this._id=wa;this.prb=kb;this.glb=Pb;this.pma=Object(r.a)(String,m.AFrameworkApplication.sessionStartInfoSettings.Application)||""}get eRg(){return this.bKb}set eRg(wa){this.bKb=wa;this.lPe()}get q3g(){return this.N2c}set q3g(wa){this.N2c=wa;this.lPe()}get Q_g(){return this.u2c}set Q_g(wa){this.u2c=wa;this.lPe()}get r3g(){return 0!==this.jcg}get R_g(){return 0!==this.gbg}lPe(){!this.r3g&&this.bKb&&this.N2c&&(this.jcg=this.b8d(this.N2c,"CoauthGalleryLightupDurationTooLong"));
!this.R_g&&this.bKb&&this.u2c&&(this.gbg=this.b8d(this.u2c,"CanvasPresenceLightupDurationTooLong"))}b8d(wa,kb){const Pb=wa-this.bKb;var Hb=new K;Hb.id=this._id;Hb.et=wa;Hb.st=this.bKb;Hb.d=Pb;var bd=J.c(Hb);wa="Word"===this.pma;Hb="CanvasPresenceLightupDurationTooLong"===kb?"PresenceExperienceDegraded":"CoauthGalleryExperienceDegraded";"CanvasPresenceLightupDurationTooLong"===kb?u.ULS.sendTraceTag(572289499,302,15,bd):u.ULS.sendTraceTag(571524118,302,15,bd);if(wa){var nc=new Map;nc.set("data",bd);
z.Health.instance.recordKpiUsage(Hb,0,"wordcollabrel",nc)}return Pb>this.prb.value?(nc=Object.assign(new N.a,{inStaging:!0,extendedProperties:new Map}),nc.extendedProperties.set("data",bd),bd=Pb<this.glb.value,nc.extendedProperties.set("cash",bd?"true":"false"),wa&&z.Health.instance.recordKpiFailure(Hb,kb,!1,!0,nc),u.ULS.sendTraceTag(572289500,302,15,O.Dzi(Pb,this.prb.value,this.glb.value)),bd?2:1):3}}Object(k.a)(W,"PresenceLightupLatencyLogger",null,[]);var ca=b(37),H=b(149);class Z{constructor(wa,
kb,Pb,Hb,bd,nc,Qe=null,ye=null,lf=null){this.fBg={};this.Qde={};this.prg=new M.a;this.Gkc=this.KA=this.$h=null;this.RGg=this.QGg=0;this.prb=new R.a(()=>Qe.MU("PresenceBootLatencyThreshold",1E4));this.glb=new R.a(()=>Qe.MU("PresenceBootLatencyCutoffThreshold",6E4));this.Jzj=new R.a(()=>Qe.MU("PresenceLightupLatencyThreshold",2E3));this.mbj=new R.a(()=>Qe.MU("PresenceLightupLatencyCutoffThreshold",1E4));this.Jqj=Hb;this.ncg=wa;this.MDg=kb;this.$5a=Pb;this.sg=bd;this.cPb=ye;this.ukb=nc;this.qg=lf;this.eag=
!1;this.init()}IAc(wa,kb,Pb=null,Hb=0){Pb&&(u.ULS.shipAssertTag(42274970,302,!this.cPb||this.cPb===Pb,"_myClientId is already set and you are trying to update it to something different"),this.cPb=Pb);const bd=new w.a;this.init().continueWith(()=>{this.drm(wa);this.YAk(bd,wa,kb,Hb)})}get S6h(){return this.cPb||"{"+m.AFrameworkApplication.userSessionId+"}"}init(){if(this.Gkc)return this.Gkc.task;this.Gkc=new w.a;this.ukb()&&u.ULS.sendTraceTag(50951700,302,15,"TabSwitched Session");this.ncg.continueWith(()=>
{const wa=this.ncg.result,kb=wa.CVb,Pb=wa.Mem;Pb.continueWith(()=>{kb.continueWith(()=>{this.qg&&this.qg.addQosPillar("RealTimeCoauth");this.iVf(kb.result,Pb.result);this.Gkc.Jf(null)})})});this.MDg.continueWith(()=>{this.$h=this.MDg.result;this.$h.qwa(Object(f.a)(this,this.hsm,"onRtcConnection"));this.$h.j3(Object(f.a)(this,this.Llm,"onCoauthorBootReceived"))});this.$5a.continueWith(()=>{this.KA=this.$5a.result;this.KA.ATb(Object(f.a)(this,this.ySd,"onUsersUpdatedEventListener"));0<this.KA.vVa().length&&
this.jY()});return this.Gkc.task}Trh(){return this.sg.GHa(ca.a.w1a)?this.sg.cK(ca.a.w1a):H.a.A8a?window.performance.timing.fetchStart:-1}hsm(wa,kb){this.eag||2!==kb.newState||(wa=Date.now()-this.Trh(),kb={},kb.clientId=this.S6h,kb.bootTime=wa,this.eag=!0,this.$h.MM(15,kb))}Llm(wa,kb){if(15===kb.type){wa=Date.now();kb=kb.Q5;var Pb=kb.bootTime;this.G8e(kb.clientId).eRg=wa-Pb}}ySd(){this.jY()}jY(){const wa=Date.now();var kb=this.KA.vVa();const Pb=new M.a;for(const Hb of kb)this.prg.contains(Hb.clientId)||
(this.prg.add(Hb.clientId),Pb.add(Hb.clientId));if(0<Pb.count)for(let Hb of Pb)kb=this.G8e(Hb),kb.r3g||(kb.q3g=wa)}drm(wa){wa=this.G8e(wa);wa.R_g||(wa.Q_g=Date.now())}G8e(wa){return wa in this.Qde?this.Qde[wa]:this.Qde[wa]=new W(wa,this.Jzj,this.mbj)}iVf(wa,kb=0){this.QGg=wa;this.RGg=kb?kb:(new Date).getTime()}YAk(wa,kb,Pb,Hb){Pb=Pb?Pb.getTime():(new Date).getTime();kb in this.fBg?wa.Qla():(Hb=new V(kb,this.Dgl(),Pb,this.xBd(this.S6h),this.xBd(kb),this.prb,this.glb,Hb,this.ukb),this.fBg[kb]=Hb,Hb.b8d(wa))}Dgl(){return 1===
this.QGg?this.RGg:this.Trh()}xBd(wa){return this.Jqj.xBd(wa)}}Object(k.a)(Z,"PresenceBootTelemetry",null,[282]);var aa=b(118),ja=b(168),Ba=b(184),la=b(23),ia=b(677);class oa{get name(){return"Common.App.CoauthTelemetry"}yb(wa){wa.register(x,"Common.App.CoauthTelemetry.CoauthTelemetry").as("Common.App.CoauthTelemetry.ICoauthTelemetry").singleInstance().Pc(()=>new x(ia.a.Vp(wa.za("Common.IPeopleInfoProvider")),m.AFrameworkApplication.ug));wa.register(E,"Common.App.CoauthTelemetry.CoauthorGalleryTelemetry").as("Common.ICoauthorGalleryTelemetry").singleInstance().Pc(()=>
new E(m.AFrameworkApplication.pa,ia.a.Vp(wa.za("Common.ICoauthoringTelemeryInfoProvider")),m.AFrameworkApplication.K,aa.a.get_instance(),Ba.a.instance,ia.a.Vp(wa.za("Common.IPeoplesWell")),ia.a.Vp(wa.za("Common.IPeopleInfoProvider")),x.XKe,()=>this.EXg()));wa.register(Z,"Common.App.CoauthTelemetry.PresenceBootTelemetry").as("Common.App.CoauthTelemetry.IPresenceBootTelemetry").singleInstance().Pc(()=>new Z(ia.a.Vp(wa.za("Common.ICoauthoringTelemeryInfoProvider")),ia.a.Vp(wa.za("Common.IRealtimeChannelBasic")),
ia.a.Vp(wa.za("Common.IPeopleInfoProvider")),wa.resolve("Common.App.CoauthTelemetry.ICoauthorPositionFinder"),Ba.a.instance,()=>this.EXg(),m.AFrameworkApplication.K,null,z.Health.instance));wa.register(A,"Common.App.CoauthTelemetry.CoauthorPositionFinder").as("Common.App.CoauthTelemetry.ICoauthorPositionFinder").singleInstance().Pc(()=>new A(ia.a.Vp(wa.za("Common.IPeopleInfoProvider"))));wa.register(Q,"Common.App.CoauthTelemetry.GuestCoauthTelemetry").singleInstance().Pc(()=>new Q(ia.a.Vp(wa.za("Common.IPeopleInfoProvider")),
ia.a.Vp(wa.za("Common.ISystemInitiatedFeedback")),m.AFrameworkApplication.K,"{"+m.AFrameworkApplication.userSessionId+"}"))}init(){m.AFrameworkApplication.K.Io(()=>{la.a.instance.resolve("Common.App.CoauthTelemetry.CoauthTelemetry").init();la.a.instance.resolve("Common.App.CoauthTelemetry.GuestCoauthTelemetry").init();m.AFrameworkApplication.K.$("CoauthorGalleryTelemetryIsEnabled")&&la.a.instance.resolve("Common.ICoauthorGalleryTelemetry").init();m.AFrameworkApplication.K.$("CashTelemetryIsEnabled")&&
(la.a.instance.resolve("Common.App.CoauthTelemetry.IPresenceBootTelemetry"),la.a.instance.resolve("Common.App.CoauthTelemetry.ICoauthorPositionFinder"))})}dispose(){}EXg(){return H.a.A8a&&Ba.a.instance.GHa(ca.a.l_c)?0<Ba.a.instance.cK(ca.a.l_c)[ca.a.tYi]:!1}static main(){ja.a.instance.Lb(new oa)}}Object(k.a)(oa,"CoauthTelemetryPackage",null,[1,2]);class ha extends Sys.EventArgs{constructor(){super()}}Object(k.a)(ha,"RtcHostNotificationEventArgs",Sys.EventArgs,[]);var pa;(function(wa){wa[wa.notYetStarted=
0]="notYetStarted";wa[wa.polling=1]="polling";wa[wa.subscribed=2]="subscribed";wa[wa.blocked=3]="blocked";wa[wa.permanentlyStopped=4]="permanentlyStopped"})(pa||(pa={}));Object(k.b)("RtcHostNotificationSubscriptionState",pa);var Ea=b(80),Fa=b(1227),Ga=b(63);class $a{constructor(wa,kb,Pb,Hb,bd,nc,Qe,ye,lf){this.Yf=!1;this.a7=this.oQb=this.$aa=this.ARa=null;this.Mrc=$a.L$d;this.ma=new Ga.a;this.b7a=new Fa.a(0);this.b7a.NIe(Object(f.a)(this,this.ltm,"onStateMachineChanged"));this.otj=wa;this.nfd=kb;
this.ntj=Pb;this.bze=Hb;this.Ta=bd;this.Ve=nc;Qe.execute(rh=>{this.Yf||(this.oQb=rh,this.oQb.j3(Object(f.a)(this,this.A9,"onUpdateNotificationReceived")),this.start())});ye.execute(rh=>{this.Yf||(this.a7=rh,rh.S7a(Object(f.a)(this,this.QAa,"onTokenRefreshed")))});this.eid=lf}get lbc(){return this.b7a.currentState}get xWh(){return!this.Ve||this.Ve.wra}get PWh(){return 2===this.lbc&&this.eid()<this.Mrc}start(){0!==this.lbc?u.ULS.sendTraceTag(573100178,502,15,"HostNotifications: Tried starting poll when in state {0}",
pa[this.lbc]):(this.b7a.event(1),this.KOf(null))}KOf(){this.ARa=null;if(this.xWh){u.ULS.sendTraceTag(573100181,502,50,"HostNotifications: Send event when connected.  Current state: {0}",pa[this.lbc]);let wa=null;this.bze&&this.bze.length&&(wa={},wa.etts=this.bze);this.oQb.MM(14,wa,!0);this.Hxi(this.otj)}else this.b7a.event(3)}Hxi(wa){this.ARa=Ea.a.S7(1E3*wa,Object(f.a)(this,this.KOf,"sendSubscribeEvent"),this.nfd,192,"RtcHostNotificationSubscribe");this.Ta.ub(this.ARa)}j8m(wa){wa=1E3*(wa+this.ntj);
const kb=this.eid().getTime()+wa;this.Mrc=new Date(kb);wa-=this.nfd;this.$aa?this.Ta.d5(this.$aa,wa):(this.$aa=Ea.a.S7(wa,Object(f.a)(this,this.fGn,"transitionToPollingEvent"),this.nfd/2,194,"RtcHostNotificationTransitionToPolling"),this.Ta.ub(this.$aa))}fGn(){this.$aa=null;2===this.lbc&&(this.b7a.event(1),u.ULS.shipAssertTag(573100185,502,!!this.ARa,"Missing task to ensure that we re-subscribe."))}QAa(){this.Bol()}Bol(){3===this.lbc&&this.xWh&&(this.b7a.event(this.PWh?2:1),this.KOf(null))}A9(wa,
kb){if(13===kb.type&&(wa=kb.Q5,u.ULS.sendTraceTag(573100183,502,50,"HostNotifications: Subscription status: {0}",{["SerializableHostNotificationSubscription"]:wa,["DurationBeforeExpirationToResubscribeInSec"]:this.nfd}),kb=wa.cts,!this.tIn(kb))){if(wa.sb){var Pb=2;this.j8m(wa.cts)}else Pb=1,this.Mrc=$a.L$d,this.$aa&&(this.Ta.me(this.$aa),this.$aa=null);this.b7a.event(Pb);this.ARa?this.Ta.d5(this.ARa,1E3*kb):this.Hxi(kb)}}tIn(wa){if(!isNaN(wa)&&isFinite(wa)&&0<wa)return!1;this.oLi(!1);return!0}oLi(wa){this.ARa&&
(this.Ta.me(this.ARa),this.ARa=null);this.$aa&&(this.Ta.me(this.$aa),this.$aa=null);this.oQb&&(this.oQb.Y8b(Object(f.a)(this,this.A9,"onUpdateNotificationReceived")),this.oQb=null);this.a7&&(this.a7.X8b(Object(f.a)(this,this.QAa,"onTokenRefreshed")),this.a7=null);wa||this.b7a.event(4)}ltm(wa,kb){wa=kb.newState;const Pb=kb.XEf,Hb={};Hb.NewState=pa[wa];Hb.PreviousState=pa[Pb];Hb.PreviousStateHits=kb.YEf;Hb.PreviousStateTransitionTime=kb.ZEf.toISOString();Hb.IsSubscribed=this.PWh;this.Mrc!==$a.L$d&&
(Hb.SubscriptionExpiringTime=this.Mrc.toISOString());u.ULS.sendTraceTag(572346515,502,4===wa?15:50,"HostNotificationChanged: {0}",Hb);this.ma.raiseEvent("HN",new ha(Pb,wa))}dispose(){this.Yf||(this.Yf=!0,this.oLi(!0),this.$aa&&(this.Ta.me(this.$aa),this.$aa=null))}}$a.L$d=new Date(0);Object(k.a)($a,"RtcHostNotificationSubscriptionManager",null,[281,14]);var fa=b(354);class sa{constructor(){this.rg=this.Yf=!1}get name(){return"RtcHostNotificationSubscription"}yb(wa){wa.register($a,"Common.App.RtcHostNotificationSubscription.RtcHostNotificationSubscriptionManager").as("Common.App.RtcHostNotificationSubscription.IRtcHostNotificationSubscriptionManager").singleInstance().Pc(()=>
{const kb=m.AFrameworkApplication.K;return new $a(kb.vb("RtcHostNotificationRetryIntervalIdeallyInSeconds",1800),kb.vb("RtcHostNotificationRetryIntervalBufferInSeconds",120),kb.vb("RtcHostNotificationSubscriptionLostBufferInSeconds",60),this.uel(kb),m.AFrameworkApplication.Cb,fa.SessionStatusManager.instance,wa.za("Common.IRealtimeChannelBasic"),wa.za("Common.ISessionExpirationManager"),()=>new Date)})}init(){m.AFrameworkApplication.K.Io(()=>{!this.Yf&&m.AFrameworkApplication.K.$("RtcHostNotificationEnabled")&&
(this.rg=!0,la.a.instance.resolve("Common.App.RtcHostNotificationSubscription.IRtcHostNotificationSubscriptionManager"))})}dispose(){this.Yf||(this.Yf=!0,this.rg&&la.a.instance.resolve("Common.App.RtcHostNotificationSubscription.RtcHostNotificationSubscriptionManager").dispose())}uel(wa){return wa.hF("RtcEventTypesToSubscribe")?wa.bB("RtcEventTypesToSubscribe"):null}static main(){ja.a.instance.Lb(new sa)}}Object(k.a)(sa,"RtcHostNotificationSubscriptionPackage",null,[1,2]);class qa{constructor(wa=
0){this.capabilities=wa}Vya(wa){return!!(this.capabilities&wa)}L_a(wa){this.capabilities|=wa}equals(wa){return!(this.capabilities-wa.capabilities)}clone(){return new qa(this.capabilities)}toString(){return Object.prototype.toString.call(this)}}Object(k.a)(qa,"UserCapabilities",null,[]);class va{constructor(wa,kb,Pb,Hb,bd=null,nc=null,Qe=null,ye=null,lf=!1,rh=!1,Eg=!1,Qf=0,jg=null,Ng=0){this.clientId=wa;this.userName=kb;this.color=Pb;this.capabilities=Hb||new qa;this.dwc=bd;this.chatThreadDiscoveryUri=
ye;this.inChat=rh;this.email=nc;this.client=Qe;this.isAnonymous=lf;this.isReadOnly=Eg;this.GKa=Qf;this.presenceStatus=jg;this.utb=Ng}equals(wa){return!!wa&&wa.color===this.color&&wa.userName===this.userName&&wa.clientId===this.clientId&&wa.isAnonymous===this.isAnonymous&&wa.email===this.email&&wa.inChat===this.inChat&&this.capabilities.equals(wa.capabilities)&&wa.presenceStatus===this.presenceStatus&&wa.utb===this.utb}clone(){return new va(this.clientId,this.userName,this.color,this.capabilities.clone(),
this.dwc,this.email,this.client,this.chatThreadDiscoveryUri,this.isAnonymous,this.inChat,this.isReadOnly,this.GKa,this.presenceStatus,this.utb)}HR(){return this.Nc()&&!!this.userName&&!(this.userName===CommonUIStrings.l_AnonymousUserName&&!this.isAnonymous)}Nc(){return!!this.clientId}toString(){return Object.prototype.toString.call(this)}static dik(wa){return new va(wa,null,null,new qa,null,null,null,null,!1,!1,!1,0,null)}}Object(k.a)(va,"PresenceUser",null,[110]);class Ca{constructor(wa,kb,Pb,Hb,
bd,nc,Qe,ye,lf,rh,Eg){this.clientId=wa;this.SkypeChatThreadId=Pb;this.chatThreadDiscoveryUri=Hb;this.inChat=bd;this.localColbaltSessionId=kb;this.capabilities=nc;this.email=Qe;this.isReadOnly=ye;this.userName=lf;this.isAnonymous=rh;this.presenceStatus=Eg}}Object(k.a)(Ca,"SerializablePresenceUserData",null,[]);class ta extends va{constructor(wa,kb,Pb,Hb,bd=null,nc=null,Qe=null,ye=null,lf=null,rh=!1,Eg=!1,Qf=!1,jg=null){super(wa,kb,Pb,Hb,nc,Qe,ye,lf,rh,Eg,Qf);this.QO=bd;this.presenceStatus=jg}getData(){return new Ca(this.clientId,
this.QO,this.dwc,this.chatThreadDiscoveryUri,this.inChat,this.capabilities.capabilities,this.email,this.isReadOnly,this.userName,this.isAnonymous,this.presenceStatus)}yBd(wa){return(wa=wa.value)?wa.user:null}clone(){return new ta(this.clientId,this.userName,this.color,this.capabilities.clone(),this.QO,this.dwc,this.email,this.client,this.chatThreadDiscoveryUri,this.isAnonymous,this.inChat,this.isReadOnly,this.presenceStatus)}static $tb(wa){return wa.clientId?new ta(wa.clientId,wa.userName,null,new qa(void 0===
wa.capabilities?0:wa.capabilities),wa.localColbaltSessionId,wa.SkypeChatThreadId,wa.email,null,wa.chatThreadDiscoveryUri,wa.isAnonymous,wa.inChat,wa.isReadOnly,wa.presenceStatus):null}static Z8g(wa,kb,Pb,Hb=null,bd=null,nc=null,Qe=null,ye=null,lf=!1,rh=!1,Eg=!1,Qf=null){return wa?new ta(wa,kb,null,new qa(void 0===Pb?0:Pb),Hb,bd,nc,Qe,ye,Eg,lf,rh,Qf):null}}Object(k.a)(ta,"PresenceUser",va,[1113,1114,110]);class Wa extends ta{constructor(){super();this.T7b=this.mpf=null}O7k(){const wa=m.AFrameworkApplication.userName,
kb=m.AFrameworkApplication.K.Ga("UserPrincipalName"),Pb=this.mpf?this.mpf.QO:null,Hb=m.AFrameworkApplication.m_c||m.AFrameworkApplication.yra,bd=this.T7b?this.T7b.getStatus():null;return new ta(this.clientId,wa,this.color,this.capabilities,Pb,this.dwc,kb,this.client,this.chatThreadDiscoveryUri,Hb,this.inChat,this.isReadOnly,bd)}}Object(k.a)(Wa,"MyPresenceUser",ta,[1165,110]);var Za=b(902);class Ya{constructor(wa,kb,Pb,Hb,bd){this.Kc=wa;this._clientId=kb;this.lcj=bd;this.dgj=Pb||(()=>null);this.egj=
Hb||(()=>null)}get id(){return this.Kc.id}get ikd(){return this.Kc.ikd}get mkd(){return this.Kc.mkd}get lkd(){return this.Kc.lkd}get kkd(){return this.Kc.kkd}get jkd(){return this.Kc.jkd}get okd(){return this.Kc.okd}get IGe(){return this.Kc.IGe}get Nac(){return this.Kc.Nac}get M2d(){return this.Kc.M2d}get jPd(){return this.Kc.jPd}get clientId(){return this._clientId}get hFc(){return this.dgj}get jbb(){return this.egj}get Zvk(){return this.lcj}static createInstance(wa,kb,Pb,Hb,bd=!1){return new Ya(wa,
kb,Pb,Hb,bd)}}Object(k.a)(Ya,"PeoplesWellSettings",null,[]);var Ka=b(12),xa=b(54),Sa=b(153),pb=b(81),Db=b(198),Ua=b(232),Lb=b(410),Va=b(335);class Sb extends Db.a{constructor(){super();this.JoinTimeInMS=0;this.IsAnonymous=!1;this.ImageUrl=null;this.CanJump=this.ActiveStatus=!1;this.Upn=null}get ControlType(){return 5}}Object(k.a)(Sb,"PeopleButtonProps",Db.a,[]);var nb=b(373),La=b(787),Ha=b(16),Aa=b(133),Ma=b(350),cb=b(78);class ib{constructor(wa){this.n_c=new cb.a;this.OVe=null;this.clientId=wa}gkn(wa){this.lVm();
this.Xcn(wa);for(const kb of wa)kb.clientId!==this.clientId&&this.fPg(kb)}get t1f(){const wa=[];for(let kb of this.n_c.values){const Pb=this.Dyi(kb);Array.add(wa,Pb)}return wa}get Feb(){return this.n_c.count}kIe(wa,kb){wa=wa.toUpperCase();let Pb;({value:Pb}=this.n_c.Ab(wa)).returnValue||(Pb=[],this.n_c.Z(wa,Pb));Array.add(Pb,kb)}lVm(){this.n_c=new cb.a}Xcn(wa){for(const kb of wa)if(kb.clientId===this.clientId){this.OVe=kb;break}}}Object(k.a)(ib,"UserTracker",null,[978]);class Rb extends ib{constructor(wa,
kb){super(wa);this.fgj=kb}fPg(wa){wa.isAnonymous||!wa.email?this.kIe(wa.clientId,wa):this.OVe&&Ma.a.yi().equals(this.OVe.email,wa.email)||this.kIe(wa.email,wa)}Dyi(wa){let kb=new Date(0),Pb=0<wa.length?wa[0]:null;for(const Hb of wa)(wa=this.fgj(Hb.clientId))&&kb.getTime()<wa.v4b.getTime()&&(kb=wa.v4b,Pb=Hb);return Pb}}Object(k.a)(Rb,"UniqueUserTracker",ib,[]);class Oa extends ib{constructor(wa){super(wa)}fPg(wa){this.kIe(wa.clientId,wa)}Dyi(wa){return wa[0]}}Object(k.a)(Oa,"UserInstanceTracker",ib,
[]);const lb=(wa,kb,Pb)=>Pb?new Rb(wa,kb):new Oa(wa);var gb=b(64),Nb=b(1190),qc=b(13);class Eb{constructor(wa,kb=null,Pb=null,Hb=null){this.KA=null;this.zDe=new w.a;this.$fc=null;this.Kc=wa;this.cUd=kb;Pb&&Pb.continueWith(()=>{this.KA=Pb.result;this.KA.ATb(Object(f.a)(this,this.jY,"onUsersUpdated"));this.gSc()});Hb&&Hb.continueWith(()=>{this.$fc=Hb.result;this.$fc.U3n(Object(f.a)(this,this.jY,"onUsersUpdated"));this.gSc()});new va(this.settings.clientId,"Anonymous user","#cccccc",new qa(7));this.CId=
this.gpe=!0;this.Pke=this.cwe=!1;this.Cta=lb(this.settings.clientId,this.settings.jbb,wa.Zvk)}get settings(){return this.Kc}get YHl(){return m.AFrameworkApplication.K?m.AFrameworkApplication.K.$("ColorPresenceHashIsEnabled"):!1}get xQh(){return m.AFrameworkApplication.K?m.AFrameworkApplication.K.$("PeoplesWellExtraButtonInfoIsEnabled"):!1}PWk(){let wa;let kb,Pb,Hb,bd;var nc=this.QWk();this.Cta.Feb?1===this.Cta.Feb?(kb=!0,Pb=this.settings.Nac.cluster,Hb=this.settings.Nac.isd,bd=this.Cta.t1f[0].color):
(kb=!0,Pb=this.settings.jPd.cluster,Hb=this.settings.jPd.isd,bd=""):(kb=!1,bd=Hb=Pb="");wa=nc[0];nc=nc.slice(1);return{cwm:wa,dwm:nc,Zvm:kb,sao:Pb,awm:Hb,$vm:bd}}QWk(){if(2<=this.Cta.Feb)return[String.format(CommonUIStrings.l_PeoplesWellStateNumberOfOtherPeopleEditingHere,this.Cta.Feb)];if(1===this.Cta.Feb){const wa=this.Cta.t1f[0],kb=this.settings.jbb(wa.clientId);return kb&&2===kb.status?[CommonUIStrings.l_PeoplesWellStateUserIsInactive,wa.userName]:[wa.isReadOnly?CommonUIStrings.l_PeoplesWellStateUserIsAlsoViewing:
CommonUIStrings.l_PeoplesWellStateUserIsAlsoEditing,wa.userName]}return[CommonUIStrings.l_PeoplesWellStateYouAreAllByYourself]}Wkl(wa){return this.Xkl(wa)}m_g(wa,kb,Pb){return kb?this.l1j(kb)?(wa=this.settings.jbb(wa))&&2===wa.status?!1:!0:(Pb&&u.ULS.sendTraceTag(4482394,325,50,"User has presence data but app can't use it"),!1):(Pb&&u.ULS.sendTraceTag(4482393,325,50,"User does not have any presence data"),!1)}Jgl(wa){return wa.isReadOnly?CommonUIStrings.l_PeoplesWellUserStatusIsViewingOffline:CommonUIStrings.l_PeoplesWellUserStatusLocationUnknown}Xkl(wa){if(!wa.capabilities.Vya(1))return this.Jgl(wa);
const kb=wa.isReadOnly,Pb=this.settings.jbb(wa.clientId);wa=this.settings.hFc(wa.clientId);if(!Pb)return CommonUIStrings.l_PeoplesWellUserStatusLocationUnknown;switch(Pb.status){case 1:return wa?kb?CommonUIStrings.l_PeoplesWellUserStatusIsViewingOnline:this.vek(wa)||CommonUIStrings.l_PeoplesWellUserStatusLocationUnknown:CommonUIStrings.l_PeoplesWellUserStatusLocationUnknown;case 2:return CommonUIStrings.l_PeoplesWellUserStatusIsInactive;default:return CommonUIStrings.l_PeoplesWellUserStatusLocationUnknown}}C3k(wa){if(this.cUd.JKd)return this.cUd.HWb(wa.email,
"O365",m.AFrameworkApplication.kl,0)}Jkl(wa){wa=this.settings.jbb(wa.clientId);return!wa||wa&&1===wa.status?!0:!1}Lkl(wa){var kb=String.format("buttonPeoplesWellUser-{0}",wa.clientId),Pb=wa.clientId,Hb=this.Wkl(wa);const bd=wa.userName,nc=wa.color;var Qe=Object,ye=Qe.assign,lf=new Sb,rh=this.settings.okd.toString(),Eg=this.settings.M2d.cluster,Qf=this.settings.M2d.isd,jg=this.Mth(),Ng=wa.isAnonymous,ci;if(ci=[bd],ci.length){var bj=new Sys.StringBuilder("STRARRY@");for(const Xk of ci)bj.append(Xk?
Xk.length:0),bj.append(","),bj.append(Xk),bj.append(",");ci=bj.toString().slice(0,-1)}else ci=null;kb=ye.call(Qe,lf,{Id:kb,Command:rh,LabelText:"{0}",Image32by32:Eg,Image32by32Class:Qf,MenuItemId:Pb,CommandValueId:Pb,Alt:bd,DisplayMode:jg,LabelCss:"display:block; max-width:160px; padding:0px; white-space:normal; word-wrap:break-word",Description:Hb,ImageBackColor:nc,IsAnonymous:Ng,LabelTextUserGeneratedPlaceholderReplacements:ci,Upn:wa.email});m.AFrameworkApplication.K.$("PeoplesWellExtraButtonInfoIsEnabled")&&
this.cUd&&(Pb=this.C3k(wa),Hb=this.Jkl(wa),kb.ImageUrl=Pb,kb.ActiveStatus=Hb,kb.JoinTimeInMS=wa.GKa,wa=this.m_g(wa.clientId,this.settings.hFc(wa.clientId),!1),kb.CanJump=wa,""===Pb&&u.ULS.sendTraceTag(40969413,302,50,"ImageURL collection failed"));return kb}R1k(){return Object.assign(new Db.a,{Id:"BasicChat",Command:"2288458806",LabelText:CommonUIStrings.l_StartGroupChat,LabelCss:"display:block; max-width:160px; padding:0px; white-space:normal; word-wrap:break-word"})}Mth(){return this.YHl?"Initials":
"Menu32"}Mkl(wa){const kb=[];for(const Pb of wa)wa=this.Lkl(Pb),Array.add(kb,wa);return kb}bId(){return 0<this.Cta.Feb}fKm(wa){if(!this.gpe)return!0;this.CId||(wa[Nb.a.Visible]=!0);let kb,Pb,Hb,bd,nc;({cwm:kb,dwm:Pb,Zvm:Hb,awm:bd,$vm:nc}=this.PWk());wa[Nb.a.LabelText]=kb;Pb&&Pb.length&&(wa[Nb.a.LabelTextUserGeneratedPlaceholderReplacements]=Pb);wa[Nb.a.ImageIsVisible]=Hb;wa[Nb.a.Image16by16Class]=bd;wa[Nb.a.ImageBackColor]=nc;this.gpe=!1;return!0}cCm(wa){if(0>=this.Cta.Feb)return!1;var kb=this.wun(this.Cta.t1f),
Pb=this.Mkl(kb);kb=Object.assign(new Lb.a,{Id:"menuCoauthors",MaxWidth:"220px",MenuSectionList:[]});Pb=Object.assign(new Va.a,{Id:"msCoauthors",ControlsId:"msCoauthorsControls",DisplayMode:this.Mth(),ControlList:Pb});m.AFrameworkApplication.K.$("WordEditorDisplayPeoplesWellLabelIsEnabled")&&this.cUd&&(Pb.Title=CommonUIStrings.l_PeoplesWellFlyoutLabel,Pb.TitleId="menuCoauthorsTitle",Pb.Theme="Light");Array.add(kb.MenuSectionList,Pb);m.AFrameworkApplication.K.$("DocChatIsEnabled")&&m.AFrameworkApplication.K.$("PeoplesWellExtraButtonInfoIsEnabled")&&
m.AFrameworkApplication.na&&m.AFrameworkApplication.na.Ya.Jo&&(Pb=[],Array.add(Pb,this.R1k()),Pb=Object.assign(new Va.a,{Id:"msGroupChat",ControlsId:"msGroupChatControl",ControlList:Pb}),Array.add(kb.MenuSectionList,Pb));m.AFrameworkApplication.na&&m.AFrameworkApplication.na.Ya.Jo?wa.MenuItems=kb:wa.PopulationXML=Ua.t(kb);return!0}r1f(wa){u.ULS.sendTraceTag(4482395,325,50,"PeoplesWell: Received user button click");wa=wa.MenuItemId;if(!wa)return!1;const kb=this.settings.hFc(wa);if(!this.m_g(wa,kb,
!0))return!1;this.iWl(kb);return!0}pQm(){const wa=this.ARk();this.Cta.gkn(wa);this.CId&&1<=this.Cta.Feb&&(u.ULS.sendTraceTag(6092429,325,50,"PeoplesWell: User is no longer forever alone."),this.CId=!1);this.gpe=!0}jY(){this.Pke||(window.setTimeout(()=>{this.gSc();this.Pke=!1},3E3),this.Pke=!0)}ARk(){let wa;wa=this.zRk()||[];for(const kb of wa)this.L6m(kb);return wa}L6m(wa){wa.clientId||(wa.clientId=Aa.a.create().toString());wa.userName||(wa.userName="Anonymous user");wa.capabilities||(wa.capabilities=
new qa);wa.color||(wa.color="#cccccc");wa.GKa||(wa.GKa=0)}wun(wa){const kb=[];Array.addRange(kb,wa);kb.sort(Eb.Mvm);return kb}vTm(){m.AFrameworkApplication.K.$("CoauthorGalleryTelemetryIsEnabled")&&!this.cwe&&(m.AFrameworkApplication.pa.j8(qc.a.C3g)&&nb.a.isSharedUxGateEnabled("Microsoft.Office.SharedOnline.ChangeGate.DoNotRegisterCoauthorsRenderedMultiplTimes")||m.AFrameworkApplication.pa.Aa(qc.a.C3g,gb.a.frame,Object(f.a)(this,this.Mlm,"onCoauthorGalleryFirstRender"),96));this.wTm();this.cwe=!0;
this.gSc()}Mlm(wa,kb,Pb,Hb,bd){this.zDe.HS(bd.RenderTime);return 32}get sOi(){return this.zDe.task}gSc(){if(!this.cwe&&(this.zDe.HS((new Date).getTime()),u.ULS.sendTraceTag(42567504,325,50,"We are trying to render the coauthor gallery before we are ready to record the render time"),this.xQh))return;this.pQm();this.xQh&&this.CId?m.AFrameworkApplication.K&&m.AFrameworkApplication.K.getBooleanFeatureGate("Microsoft.Office.SharedOnline.GeneralizedRibbonTTVRReporting",!1)||La.a.Y5b("ribbon","coauthorGallery"):
(m.AFrameworkApplication.K&&m.AFrameworkApplication.K.getBooleanFeatureGate("Microsoft.Office.SharedOnline.GeneralizedRibbonTTVRReporting",!1)||(La.a.Pra("ribbon","coauthorGallery"),La.a.YYa("ribbon","coauthorGallery")),this.qQm())}dispose(){this.KA&&(this.KA.oYd(Object(f.a)(this,this.jY,"onUsersUpdated")),this.KA=null);this.$fc&&(this.$fc.gbo(Object(f.a)(this,this.jY,"onUsersUpdated")),this.$fc=null)}static Mvm(wa,kb){return wa.capabilities.Vya(1)&&kb.capabilities.Vya(1)||!wa.capabilities.Vya(1)&&
!kb.capabilities.Vya(1)?Ha.a.localeCompare(wa.userName,kb.userName):wa.capabilities.Vya(1)?-1:1}}Object(k.a)(Eb,"APeoplesWell",null,[906,14]);var ec=b(14);class Jb extends Eb{constructor(wa,kb,Pb=null,Hb=null){super(wa,Pb,Hb);this.zPa=()=>!0;this.ga=kb}hKm(wa){return this.fKm(wa)}eCm(wa){return this.cCm(wa)}dTn(wa){return this.r1f(wa)}vWa(wa,kb,Pb,Hb,bd,nc){wa=!1;switch(Pb){case 1:wa=bd(Hb);break;case 2:wa=nc(Hb)}return Jb.rUj(wa)}JIl(wa,kb,Pb,Hb,bd){return this.vWa(wa,kb,Pb,bd,()=>this.bId(),this.zPa)}gKm(wa,
kb,Pb,Hb,bd){return this.vWa(wa,kb,Pb,bd,Object(f.a)(this,this.hKm,"queryUsersProxy"),this.zPa)}dCm(wa,kb,Pb,Hb,bd){return this.vWa(wa,kb,Pb,bd,this.zPa,Object(f.a)(this,this.eCm,"populateFlyoutContentsProxy"))}V9j(wa,kb,Pb,Hb,bd){return this.vWa(wa,kb,Pb,bd,this.zPa,this.zPa)}U9j(wa,kb,Pb,Hb,bd){return this.vWa(wa,kb,Pb,bd,this.zPa,this.zPa)}bTn(wa,kb,Pb,Hb,bd){return this.vWa(wa,kb,Pb,bd,this.zPa,Object(f.a)(this,this.dTn,"userButtonClickProxy"))}kAm(wa,kb,Pb,Hb,bd){return this.vWa(wa,kb,Pb,bd,
this.zPa,()=>{this.gSc();return!0})}wTm(){this.ga.ka(this.settings.ikd,ec.a.application,Object(f.a)(this,this.JIl,"isControlEnabledHandler"));this.ga.Aa(this.settings.mkd,ec.a.application,Object(f.a)(this,this.gKm,"queryUsersHandler"),96);this.ga.Aa(this.settings.kkd,ec.a.application,Object(f.a)(this,this.V9j,"commandMenuOpenHandler"),96);this.ga.Aa(this.settings.jkd,ec.a.application,Object(f.a)(this,this.U9j,"commandMenuCloseHandler"),96);this.ga.Aa(this.settings.lkd,ec.a.application,Object(f.a)(this,
this.dCm,"populateFlyoutContentsHandler"),96);this.ga.ka(this.settings.okd,ec.a.application,Object(f.a)(this,this.bTn,"userButtonClickHandler"));this.ga.Aa(this.settings.IGe,ec.a.application,Object(f.a)(this,this.kAm,"peoplesWellRefreshControlHandler"),96)}static rUj(wa){return wa?32:8}}Object(k.a)(Jb,"ABox4PeoplesWell",Eb,[]);var vb=b(3),xb=b(49),lc=b(10),Lc=b(30),uc=b(175);class od{static isSupported(wa){for(let kb=0;kb<od.oMi.length;kb++)if(wa===od.oMi[kb])return!0;return!1}}od.oMi=[1];Object(k.a)(od,
"RTTDataVersion",null,[]);var Cb=b(1449);const gc=wa=>{if("number"!==typeof wa.RK||"number"!==typeof wa.DK)return!1;let kb,Pb=!1,Hb=!1,bd=!1;switch(wa.RK){case 0:Hb=kb=!0;break;case 1:bd=Pb=Hb=kb=!0;break;case 2:if(null!=wa.PE&&"number"!==typeof wa.PE)return!1;kb=!0;break;case 4:kb=!0;break;case 3:Hb=kb=!0;break;case 5:Pb=kb=!0;break;default:return!1}return kb&&("number"!==typeof wa.PS||"number"!==typeof wa.TS)||Hb&&("object"!==typeof wa.OS||!wa.OS||!Cb.validateVersionedCpData(wa.OS))||Pb&&("number"!==
typeof wa.PE||"number"!==typeof wa.TE)||bd&&("object"!==typeof wa.OE||!wa.OE||!Cb.validateVersionedCpData(wa.OE))?!1:!0},Dc=wa=>{let kb="";if("number"!==typeof wa.I)return{returnValue:!1,Oca:"Invalid PacketId Type"};if("number"!==typeof wa.O)return{returnValue:!1,Oca:"Invalid Operation Type"};if("string"!==typeof wa.A)return{returnValue:!1,Oca:"Invalid ClientId Type"};if("object"!==typeof wa.AN)return{returnValue:!1,Oca:"Invalid Anchor Object Type"};if(!wa.AN)return{returnValue:!1,Oca:"Null AnchorObject"};
if(!gc(wa.AN)){let Pb;try{Pb=J.c(wa.AN)}catch(Hb){Pb=String.format("Failed to JSON-serialize payload : {0}",Hb)}8E3<Pb.length&&(Pb=String.format("Payload exceeds maximum length: {0} > {1}, not logging",Pb.length,8E3));kb="Invalid AnchorObject: "+Pb+", Client: "+wa.C;return{returnValue:!1,Oca:kb}}return!wa.O&&wa.AN.RK?(kb="Invalid RangeKind:"+wa.AN.RK+" for Caret",{returnValue:!1,Oca:kb}):2===wa.O&&("number"!==typeof wa.TF||"undefined"!==typeof wa.TX&&"string"!==typeof wa.TX||1!==wa.AN.RK&&wa.AN.RK)?
{returnValue:!1,Oca:"Invalid TypingData"}:3!==wa.O||"object"===typeof wa.AP&&wa.AP&&"number"===typeof wa.AP.TFA&&"number"===typeof wa.AP.PN&&"number"===typeof wa.AP.TN&&2===wa.AN.RK?6!==wa.O||"object"===typeof wa.MP&&wa.MP&&"number"===typeof wa.MP.PM&&"number"===typeof wa.MP.TM&&5===wa.AN.RK?4!==wa.O||"object"===typeof wa.SP&&wa.SP&&"number"===typeof wa.SP.PA&&"number"===typeof wa.SP.TA&&"number"===typeof wa.SP.PB&&"number"===typeof wa.SP.TBS&&3===wa.AN.RK&&(wa.AN.PS===wa.SP.PA||wa.AN.PS===wa.SP.PB)?
7!==wa.O||"object"===typeof wa.SPS&&wa.SPS&&"string"===typeof wa.SPS.SF&&"boolean"===typeof wa.SPS.SL?null!=wa.ISS&&"number"!==typeof wa.ISS?{returnValue:!1,Oca:"invalid StrictlySequentialId"}:{returnValue:!0,Oca:kb}:{returnValue:!1,Oca:"Invalid SymbolData"}:{returnValue:!1,Oca:"Invalid SplitParaData"}:{returnValue:!1,Oca:"Invalid RemoveParaData"}:{returnValue:!1,Oca:"Invalid AddParaData"}};var Ub=b(1410);class Bb{constructor(wa,kb=null,Pb=null){this.OY=this.iCf=this.RXf=null;null!=wa&&(this.RXf=
wa);null!=kb&&(this.iCf=kb);null!=Pb&&(this.OY=Pb)}}Object(k.a)(Bb,"AddParaData",null,[]);class fb{constructor(wa=null,kb=null){this.Vbc=this.hCf=null;null!=wa&&(this.hCf=wa);null!=kb&&(this.Vbc=kb)}}Object(k.a)(fb,"MergeRemoveParaData",null,[]);class yb{constructor(wa,kb,Pb,Hb,bd,nc,Qe=null,ye=null,lf=null,rh=null,Eg=null,Qf=null,jg=0,Ng=null){this.GXc=this.text=this.WHb=this.hHb=this.$Mc=this.lTb=this.jfa=null;this.packetId=wa;this.client=Pb;this.px=Hb;this.clientId=kb.toLowerCase();this.NQ=bd;
this.version=jg;nc&&(this.jfa=nc);null!=Qe&&(this.WHb=Qe);void 0!==ye&&null!==ye&&(this.text=ye);lf&&(this.lTb=lf);rh&&(this.$Mc=rh);Eg&&(this.hHb=Eg);Qf&&(this.GXc=Qf);this.strictlySequentialId=Ng}}Object(k.a)(yb,"RTTData",null,[]);class Wb{constructor(wa=null,kb=null,Pb=null,Hb=null){this.QXf=this.gCf=this.NXf=this.fCf=null;null!=wa&&(this.fCf=wa);null!=kb&&(this.NXf=kb);null!=Pb&&(this.gCf=Pb);null!=Hb&&(this.QXf=Hb)}}Object(k.a)(Wb,"SplitParaData",null,[]);class Xb{constructor(wa=null,kb=null){this.vWf=
this.uWf=null;wa&&(this.uWf=wa);null!=kb&&(this.vWf=kb)}}Object(k.a)(Xb,"SymbolData",null,[]);class Cc{constructor(wa,kb=null,Pb=null){null!=wa&&(this.TFA=wa);null!=kb&&(this.PN=kb);null!=Pb&&(this.TN=Pb)}}Object(k.a)(Cc,"SerializableAddParaDataV1",null,[]);class Bc{constructor(wa=null,kb=null){null!=wa&&(this.PM=wa);null!=kb&&(this.TM=kb)}}Object(k.a)(Bc,"SerializableMergeRemoveParaDataV1",null,[]);class pd{}Object(k.a)(pd,"SerializableRTTDataV1",null,[]);class zd{constructor(wa=null,kb=null,Pb=
null,Hb=null){null!=wa&&(this.PA=wa);null!=kb&&(this.TA=kb);null!=Pb&&(this.PB=Pb);null!=Hb&&(this.TBS=Hb)}}Object(k.a)(zd,"SerializableSplitParaDataV1",null,[]);class Jd{constructor(wa=null,kb=null){wa&&(this.SF=wa);null!=kb&&(this.SL=kb)}}Object(k.a)(Jd,"SerializableSymbolDataV1",null,[]);const Ue=wa=>{var kb;if(!({Oca:kb}=Dc(wa)).returnValue)return u.ULS.sendTraceTag(9188759,302,15,"Failed to parse RTT packet, InvalidFieldInfo {0}",kb),null;let Pb=kb=null,Hb=null,bd=null,nc=null,Qe=null,ye=null,
lf=null;wa.WD&&(kb=wa.WD);null!=wa.TF&&(Pb=wa.TF);void 0!==wa.TX&&null!==wa.TX&&(Hb=wa.TX);wa.AP&&(bd=new Bb(wa.AP.TFA,wa.AP.PN,wa.AP.TN));wa.MP&&(nc=new fb(wa.MP.PM,wa.MP.TM));wa.SP&&(Qe=new Wb(wa.SP.PA,wa.SP.TA,wa.SP.PB,wa.SP.TBS));wa.SPS&&(ye=new Xb(wa.SPS.SF,wa.SPS.SL));null!=wa.ISS&&(lf=wa.ISS);return new yb(wa.I,wa.A,wa.C,wa.O,Ub.a(wa.AN),kb,Pb,Hb,bd,nc,Qe,ye,1,lf)},Sc=wa=>{let kb=wa;if("number"===typeof kb.V){if(1===kb.V)return Ue(wa);u.ULS.sendTraceTag(9188758,302,15,"Unsupported Version");
return null}let Pb=0,Hb=null;for(let bd=0;bd<wa.length;bd++)kb=wa[bd],od.isSupported(kb.V)&&kb.V>Pb&&(Pb=kb.V,Hb=wa[bd]);return 1===Pb?Ue(Hb):null},kc=wa=>{if(wa){const kb=new pd;kb.I=wa.packetId;kb.V=1;kb.A=wa.clientId;kb.C=wa.client;kb.O=wa.px;kb.AN=Ub.c(wa.NQ);wa.jfa&&(kb.WD=wa.jfa);null!=wa.WHb&&(kb.TF=wa.WHb);void 0!==wa.text&&null!==wa.text&&0<wa.text.length&&(kb.TX=wa.text);wa.lTb&&(kb.AP=new Cc(wa.lTb.RXf,wa.lTb.iCf,wa.lTb.OY));wa.$Mc&&(kb.MP=new Bc(wa.$Mc.hCf,wa.$Mc.Vbc));wa.hHb&&(kb.SP=
new zd(wa.hHb.fCf,wa.hHb.NXf,wa.hHb.gCf,wa.hHb.QXf));wa.GXc&&(kb.SPS=new Jd(wa.GXc.uWf,wa.GXc.vWf));kb.ISS=wa.strictlySequentialId;wa=kb}else wa=null;return wa};var Pc=b(51);class Rd{constructor(wa,kb,Pb,Hb,bd,nc,Qe,ye,lf){this.LocalCobaltSessionId=wa;this.SkypeChatThreadId=kb;this.ChatThreadDiscoveryUri=Pb;this.InChat=Hb;this.Capabilities=bd;this.Email=nc;this.UserName=Qe;this.IsAnonymous=ye;this.PresenceStatus=lf}}Object(k.a)(Rd,"SerializableWacData",null,[]);class le{constructor(){this.Jgd=this.Igd=
0}v8k(){this.Jgd===Number.MAX_VALUE&&(this.Jgd=0);this.Jgd++;return this.Jgd}u8k(){this.Igd===Number.MAX_VALUE&&(this.Igd=0);this.Igd++;return this.Igd}static get instance(){return le.Tvj}}le.Tvj=new le;Object(k.a)(le,"StrictlySequentialIdGenerator",null,[172]);var Fc=b(1336);class He{constructor(wa,kb,Pb,Hb,bd,nc,Qe,ye=0){this.Jna=null;this.dryDeletion=0;this.kG=wa;this.vFa=nc;this.oc=bd;this.xrb=Qe;this.Ib=kb;this.shapeId=ye;this.dBa=Pb;this.U4=Qe.create(this,Hb,bd,nc)}clone(){return new He(this.kG,
this.Ib,this.dBa,this.U4.sJb,this.oc,this.vFa,this.xrb,this.shapeId)}get paragraphId(){return this.Jna?this.Jna:this.kG.Uab(this.Ib)}Yzf(){this.Jna||(this.Jna=this.paragraphId,this.U4.Yzf())}Nc(){return 0<=this.U4.cp}getData(){const wa=this.U4.sJb;return wa?new Fc.a(0,this.Ib,this.dBa,wa,null,null,null,0,this.shapeId):null}static $tb(wa,kb,Pb,Hb,bd){return kb?new He(kb,parseInt(wa.NLa),wa.O0a,wa.bP,Pb,Hb,bd,wa.shapeId):null}}Object(k.a)(He,"WordPresenceIp",null,[155,62,156]);class $e{constructor(wa,
kb,Pb){this.nNa=this.b9=this.Vmc=!1;this.O5a=wa;this.gQa=Pb;this.user=kb}get ip(){return this.gQa}get l5b(){return this.Vmc}set l5b(wa){(this.Vmc=wa)&&this.ip.Yzf()}Q$e(){const wa=le.instance.u8k();return new yb(this.O5a,this.user.clientId,1,0,this.ip?this.ip.getData():null,new Rd(this.user.QO,this.user.dwc,this.user.chatThreadDiscoveryUri,this.user.inChat,this.user.capabilities.capabilities,this.user.email,this.user.userName,this.user.isAnonymous,this.user.presenceStatus),void 0,void 0,void 0,void 0,
void 0,void 0,void 0,wa)}Hvh(){return this.user.clientId+(this.ip?this.ip.paragraphId.toString():Pc.a.nil.toString())}Nc(){const wa=!!this.user&&this.user.Nc(),kb=!this.ip||this.ip.Nc();return wa&&kb}clone(){const wa=new $e;wa.O5a=this.O5a;wa.Vmc=this.Vmc;wa.user=this.user?this.user.clone():null;wa.gQa=this.ip?this.ip.clone():null;wa.b9=this.b9;wa.nNa=this.nNa;return wa}static get Ua(){return la.a.instance.ra("Box4.IFeatureHelper")}static QTe(wa,kb,Pb,Hb,bd){if(!wa||!$e.Ua.isFeatureEnabled(194)||
!kb)return null;if(wa.px)return u.ULS.sendTraceTag(7685324,302,15,"Presence packet is of unexpected operationType {0}",wa.px),null;let nc;nc=void 0!==wa.jfa&&null!==wa.jfa?ta.Z8g(wa.clientId,wa.jfa.UserName,wa.jfa.Capabilities,wa.jfa.LocalCobaltSessionId,wa.jfa.SkypeChatThreadId,wa.jfa.Email,wa.client,wa.jfa.ChatThreadDiscoveryUri,wa.jfa.InChat,!1,wa.jfa.IsAnonymous,wa.jfa.PresenceStatus):ta.Z8g(wa.clientId,null,0,void 0,void 0,void 0,wa.client);return new $e(wa.packetId,nc,He.$tb(wa.NQ,kb,Pb,Hb,
bd))}}Object(k.a)($e,"WordPresenceInfo",null,[167,62]);class Le extends Jb{constructor(wa,kb,Pb,Hb,bd,nc,Qe,ye,lf,rh,Eg,Qf,jg,Ng){super(wa,nc,Ng,kb);this.X9i=Pb;this.Atj=Hb;this.Xrj=bd;this.ya=Qe;Le.Fs=ye;this.kG=lf;this.oc=rh;this.vFa=Eg;this.jGe=Qf;this.JDa=jg}r1f(wa){this.JDa.FYh(wa.CommandValueId);return super.r1f(wa)}iWl(wa){let kb;({OEf:kb}=this.elf(wa)).returnValue&&(this.Atj(kb.ip.paragraphId,kb.ip.U4.cp),m.AFrameworkApplication.K.$("WordEditorMoveIpToUserLocationIsEnabled")&&(wa=Le.wfl(kb),
void 0!==wa&&null!==wa?(u.ULS.sendTraceTag(20764574,325,50,"Attempting to move IP to the editing location of the selected user"),this.ya.setSelection(wa),xa.FocusManager.rH()&&xa.FocusManager.instance().Kf(Sa.AFrame.Mp)):u.ULS.sendTraceTag(20764575,325,50,"IP will not be moved since the selection is either null or undefined")),wa=new Ea.a(2,1,0,()=>{this.ga.hb(vb.a.p2d,2,kb)}),pb.a.instance.ub(wa))}HAh(wa){return wa?(wa=$e.QTe(Sc(wa),this.kG,this.oc,this.vFa,this.jGe.instance))&&wa.Nc()&&wa.ip?wa:
null:null}l1j(wa){return this.nQl(wa)?this.A1j(wa)?!0:(u.ULS.sendTraceTag(41236613,325,50,"Cannot jump to user location because paragraph has not been loaded yet"),!1):(u.ULS.sendTraceTag(41236612,325,50,"Cannot jump to user location because presence is not valid"),!1)}nQl(wa){return!!this.HAh(wa)}elf(wa){wa=this.HAh(wa);return{returnValue:!!wa,OEf:wa}}A1j(wa){let kb;return({OEf:kb}=this.elf(wa)).returnValue?this.X9i(kb.ip.paragraphId,kb.ip.U4.cp):!1}zRk(){if(!this.KA)return[];const wa=[];for(let kb of this.KA.vVa())kb.userName?
wa.push(kb):u.ULS.sendTraceTag(592229832,304,15,"The looked up RTC User has no name");return wa}vek(wa){let kb;return({OEf:kb}=this.elf(wa)).returnValue&&kb.user&&kb.user.presenceStatus&&"0"!==kb.user.presenceStatus?String.format(WordEditorIntl.WordEditorStrings.l_PresenceStatusOnPage,kb.user.presenceStatus):CommonUIStrings.l_PeoplesWellUserStatusLocationUnknown}qQm(){this.Xrj(this.settings.id)}static createInstance(wa,kb,Pb,Hb,bd,nc,Qe){const ye=Ka.App.oa.Da,lf=m.AFrameworkApplication.pa,rh=xb.a.instance,
Eg=la.a.instance.resolve("Box4.ICoauthCashTelemetry");return new Le(wa,kb,Qf=>ye.Jb.Rh?ye.Jb.vOe(Qf,!0):!1,(Qf,jg)=>{ye.Jb.Rh&&ye.Jb.U9b(Qf,jg,!0,!0)},()=>{Ka.App.wu.wG.JZc()},lf,rh,ye,Pb,Hb,bd,nc,Eg,Qe)}static wfl(wa){const kb=Le.Fs.Zb.Lc.Ra(wa.ip.paragraphId);if(void 0===kb||null===kb)return u.ULS.sendTraceTag(20764576,325,15,"The node could not be obtained"),null;if(!lc.ParagraphReader.tb(kb))return u.ULS.sendTraceTag(20764577,325,15,"The obtained node is not a paragraph node"),null;wa=Lc.a.Sb(kb,
wa.ip.U4.cp);return new uc.Selection([wa],!0)}}Le.Fs=null;Object(k.a)(Le,"WordEditorPeoplesWell",Jb,[]);class df{get name(){return"WordEditor.PeoplesWellControl"}yb(wa){df.W=wa}init(){m.AFrameworkApplication.K.Io(Object(f.a)(this,this.Mv,"onFullAppSettingsReady"))}Mv(){m.AFrameworkApplication.ihi?df.NMa.NG().continueWith(Object(f.a)(this,this.SOc,"onRtcProxyReady")):u.ULS.sendTraceTag(23196872,325,50,"PeoplesWell control is explicitly disabled. Skipping initialization attempt")}SOc(){df.$h=df.NMa.NG().result;
if(df.$h){var wa=()=>{const kb=Ka.App.oa.Da;return kb?kb.Zb?kb.Zb.Lc:(u.ULS.sendTraceTag(23196876,325,15,"ActivePage is null"),null):(u.ULS.sendTraceTag(23196875,325,15,"Workspace is null"),null)};Ka.App.Zia().continueWith(()=>{const kb=Ka.App.Zia().result.hi,Pb=Za.CuiHelper.Kal(m.AFrameworkApplication.qp,m.AFrameworkApplication.qp,m.AFrameworkApplication.qp,m.AFrameworkApplication.qp),Hb=Ya.createInstance(Pb,kb,Object(f.a)(df.$h.BZd,df.$h.BZd.hFc,"getUserPresence"),Object(f.a)(df.$h.BZd,df.$h.BZd.jbb,
"getUserStatusInfo"),m.AFrameworkApplication.K.$("WordEditorPresenceDedupeMultipleCoauthorInstances"));la.a.instance.ha("RealtimePresenceUI.WordEditorPeoplesWell",()=>Le.createInstance(Hb,ia.a.Vp(df.W.za("Common.IPeopleInfoProvider")),df.W.ra("WordEditor.ParagraphWordIdMapping"),df.W.ra("WordEditor.WordTextOffsetTranslator.IWordTextOffsetTranslator"),wa,df.W.za("WordEditor.Presence.IWordPresenceCpFactory"),df.W.resolve("Common.App.People.IPeopleManager"))).as("Common.IPeoplesWell").singleInstance();
df._instance=la.a.instance.resolve("Common.IPeoplesWell");df._instance.vTm();u.ULS.sendTraceTag(23196877,325,50,"PeoplesWellControl is fully initialized")})}else u.ULS.sendTraceTag(23196873,325,15,"Can't initialize the PeoplesWell control because can't get a handle to RtcProxy")}dispose(){df._instance&&(df._instance.dispose(),df._instance=null)}static get NMa(){return df.F6a||(df.F6a=la.a.instance.resolve("Box4.Presence.IRtcProxyProvider"))}}df._instance=null;df.W=null;df.$h=null;df.F6a=null;Object(k.a)(df,
"WordEditorPeoplesWellControlPackage",null,[1,2]);var Af=b(72),Ve=b(188);class Kc{constructor(wa,kb,Pb,Hb,bd,nc,Qe,ye,lf=!1){this.g2a=null;this.Vie=!0;this.Fwe=this.Gp=this.Hbe=null;this.ma=new Ga.a;this.pFa=wa;this.Qaa=kb;this.LAg=Pb;this.npc=Hb;this.I$f=nc;Kc.Ta=bd;this.$qj=Qe;this.FW=ye;this.dsj=lf;L.Task.WAA(kb,Pb).continueWith(Object(f.a)(this,this.kzl,"initOnTaskReady"))}UJj(wa){this.ma.addHandler("u",wa)}Bmi(){this.ma.raiseEvent("u",null,this)}kzl(){this.Qaa.result&&this.LAg.result&&(this.Gp=
this.Qaa.result,this.Fwe=this.LAg.result,this.Gp.SSa(Object(f.a)(this,this.$0,"onPresenceUpdated")),this.Hbe=new Ea.a(2,2,this.I$f,Object(f.a)(this,this.XLn,"updateAwayClientsTask"),88),Kc.Ta.ub(this.Hbe))}$0(wa,kb){(this.Vie||this.BNm(kb.XCa))&&Kc.Ta.d5(this.Hbe,0)}BNm(wa){for(let Pb in wa){var kb=this.npc.yBd({key:Pb,value:wa[Pb]});if(kb&&kb.clientId&&(kb=kb.clientId.toLowerCase(),(kb=this.g2a[kb]||this.g2a[kb.toUpperCase()])&&2===kb.status))return!0}return!1}XLn(wa){var kb=this.Gp.DCc();if(kb){var Pb=
new Date,Hb=!1;if(this.Vie){this.g2a=kb;this.Vie=!1;var bd=this.g2a;for(var nc in bd){kb=nc;var Qe=bd[nc];Qe.v4b<Pb&&(Pb=Qe.v4b);2===Qe.status&&(Hb=!0,this.Fwe.SSc(kb))}Hb&&this.Bmi();Kc.Ta.d5(wa,this.Fyh(Pb))}else{Qe=new M.a;nc=!1;var ye=this.g2a;for(bd in ye){ye=bd;if(!(ye in this.g2a)||this.pFa.clientId===ye)continue;var lf=this.g2a[ye];const rh=kb[ye];if(lf&&rh){lf=lf.status;const Eg=rh.status;2===lf&&1===Eg?(Qe.add(ye),u.ULS.sendTraceTag(38052609,392,50,ye+" returned from away")):1===lf&&2===
Eg&&(nc=Hb=!0,this.Fwe.SSc(ye),u.ULS.sendTraceTag(38052610,392,50,ye+" went away"));1===Eg&&rh.v4b<Pb&&(Pb=rh.v4b)}}this.g2a=kb;Kc.Ta.d5(wa,this.Fyh(Pb));(0<Qe.count||Hb)&&this.Bmi();0<Qe.count&&!this.dsj?(wa=this.fVk(Qe),this.aEn(wa)):wa=new M.a;(nc||0<wa.count)&&this.$qj(qc.a.Qpd,2)}}}aEn(wa){if(wa.count)for(let kb of wa)wa=this.FW.jxa(String.format(CommonUIStrings.l_EditorsToastArriving,kb),!1),wa.image=5,wa.jja="CoAuth_AuthorStatus_16x16x32",this.FW.Jz(wa)}fVk(wa){const kb=this.Gp.vwb(),Pb=new M.a;
for(let Hb in kb){const bd={key:Hb,value:kb[Hb]};if(wa.contains(bd.key)){const nc=this.npc.yBd(bd);nc&&(Pb.add(nc.userName),wa.remove(bd.key))}}Pb.count||u.ULS.sendTraceTag(38052611,392,10,"There were no coauthor names found");return Pb}Fyh(wa){const kb=new Date;return Math.max(wa.getTime()+this.I$f-kb.getTime(),0)}}Kc.Ta=null;Object(k.a)(Kc,"AwayManager",null,[]);var hd=b(717);class id{constructor(wa=0){this.updates=wa}get odf(){return 0!==this.updates}Vya(wa){return!!(this.updates&wa)}L_a(wa){this.updates|=
wa}toString(){if(this.Vya(0))return"none";const wa=new M.a;this.Vya(1)&&wa.add("user(s) joined");this.Vya(2)&&wa.add("user(s) disconnected");this.Vya(4)&&wa.add("user(s) updated");return wa.toArray().join(", ")}}Object(k.a)(id,"UserUpdateEvent",null,[]);var oh=b(27);class vf{constructor(wa,kb,Pb,Hb,bd=null){this.ma=new Ga.a;this.FH=this.$h=null;this.Svg=this.mwg=this.uk=!1;this.Fo=new cb.a;wa.continueWith(()=>{this.$h=wa.result;this.$h.SSa(Object(f.a)(this,this.Pci,"onRtcPresenceUpdate"));this.$h.qwa(Object(f.a)(this,
this.Oci,"onRtcConnectionChange"));this.Q0f(null,null)});kb.continueWith(()=>{this.FH=kb.result;this.FH.PSa(Object(f.a)(this,this.xOc,"onEditorsTableUpdated"))});bd&&bd.continueWith(()=>{bd.result.UJj(Object(f.a)(this,this.Q0f,"updateUserStatus"));this.Q0f(null,null)});this.Z5a=Pb;this.npc=Hb}get users(){return this.Fo}ATb(wa){this.ma.addHandler("UU",wa)}oYd(wa){this.ma.removeHandler("UU",wa)}Q0f(){if(this.$h){var wa=!1,kb=this.$h.DCc();for(let Hb in kb){var Pb=kb[Hb];const bd=Hb;this.users.Ja(bd)&&
(Pb=this.VPi(Pb),wa=this.users.J(bd).utb!==Pb||wa,this.users.J(bd).utb=Pb)}wa&&(wa=new id(4),this.y_d(wa))}}VPi(wa){return 1===wa.status?0:1}vVa(){this.users.count||(this.mwg||(oh.b(42316242,302,50,"No users available at PeopleInfoProvider.GetAllUsers call"),this.mwg=!0),this.xCm());const wa=[];for(let kb of this.users)Array.add(wa,kb.value);return wa}xCm(){if(this.$h){var wa=this.$h.vwb();this.bsf(wa)}if(this.FH){wa=this.FH.xCc();for(const kb of wa)kb.Id&&(wa=this.W$g(kb.Id),this.P0f(new id,wa))}}q2h(wa){({value:wa}=
this.users.Ab(wa));return wa}dispose(){this.uk||(this.$h&&(this.$h.UEb(Object(f.a)(this,this.Pci,"onRtcPresenceUpdate")),this.$h.WSc(Object(f.a)(this,this.Oci,"onRtcConnectionChange"))),this.FH&&this.FH.zri(Object(f.a)(this,this.xOc,"onEditorsTableUpdated")),this.uk=!0)}Oci(wa,kb){2===kb.newState&&(wa=this.bsf(this.$h.vwb()),wa.odf&&this.y_d(wa))}xOc(wa,kb){wa=new id;var Pb=this.FH.xCc();u.ULS.sendTraceTag(561894485,302,50,"editorstablemanager coauthors count is {0}, editorstableupdate old count of coauthors is {1}, editorstableupdate new count of coauthors is {2}",
Pb.length,kb.Jjm,kb.v7h);const Hb=new cb.a;for(var bd of Pb){Pb=bd.Id;const nc=this.W$g(Pb);this.P0f(wa,nc);Hb.Z(Pb,nc)}if((kb=kb.leaving)&&0<kb.length)for(bd=0;bd<kb.length;bd++)u.ULS.sendTraceTag(562415168,302,50,"{0} users in coauth gallery. User leaving the editor table: {1}",this.users.count,kb.J(bd).Id),({value:Pb}=this.users.Ab(kb.J(bd).Id)).returnValue?Pb?(this.users.remove(kb.J(bd).Id),wa.L_a(2),Hb.Z(kb.J(bd).Id,Pb)):u.ULS.sendTraceTag(561287839,302,50,"Empty entry in PIP users: {0}",kb.J(bd).Id):
u.ULS.sendTraceTag(570426140,302,15,"Disconnected user not found: {0}",kb.J(bd).Id);kb=this.$h.vwb();for(let nc in kb)bd=this.npc.yBd({key:nc,value:kb[nc]}),Hb.Z(bd.clientId,bd);for(let nc of this.users)Hb.Ja(nc.value.clientId)||(u.ULS.sendTraceTag(561287840,302,15,"Coauth Gallery contains user not in Editors Table or RTC presence: {0}",nc.key),this.users.remove(nc.key),wa.L_a(2));wa.odf&&this.y_d(wa)}Pci(wa,kb){wa=this.bsf(kb.XCa);for(const Pb of kb.Ktd)this.users.Ja(Pb)&&(wa.L_a(2),this.users.J(Pb).utb=
2);wa.odf&&this.y_d(wa)}bsf(wa){const kb=new id;if(!wa)return kb;for(let Hb in wa){var Pb=this.npc.yBd({key:Hb,value:wa[Hb]});Pb&&(Pb=Pb.clone(),this.P0f(kb,Pb))}return kb}P0f(wa,kb){if(kb){var Pb=kb.clientId;var Hb=this.a3m(kb);({value:kb}=this.users.Ab(Pb)).returnValue?kb.equals(Hb)||(wa.L_a(4),this.users.Z(Pb,Hb)):(u.ULS.sendTraceTag(562415169,302,50,"{0} users in coauth gallery. User joining: {1}",this.users.count,Pb),wa.L_a(1),this.users.Z(Pb,Hb))}}W$g(wa){return this.users.Ja(wa)?this.users.J(wa):
va.dik(wa)}a3m(wa){if(!wa||!wa.clientId||!this.FH)return wa;const kb=wa.clone();kb.utb=this.eVk(wa);if(wa=this.FH.uZb(kb.clientId))kb.isReadOnly=kb.isReadOnly||wa.IsReadOnly?!0:!1,kb.userName=this.$2m(kb,wa),kb.capabilities=this.ndm(kb.capabilities,wa.Capabilities),kb.email=kb.email||wa.SIPAddress||wa.EmailAddress,wa.JoinCoauthTime&&(kb.GKa=wa.JoinCoauthTime);kb.color=this.Z5a.gFc(new hd.a(kb.email,void 0,kb.userName,void 0,kb.isAnonymous,kb.clientId),3);return kb}eVk(wa){if(!this.$h)return 2;if(wa&&
wa.clientId){const kb=this.$h.DCc();if(wa.clientId in kb)return this.VPi(kb[wa.clientId])}return 2}iak(wa,kb){kb.Name&&wa.userName&&kb.Name!==wa.userName&&!this.Svg&&(this.Svg=!0,oh.b(42316243,302,15,"User names in EditorsTable and RTC don't match"))}ndm(wa,kb){wa=wa||new qa;kb&&(kb.SupportsRealtimeChannel&&wa.L_a(1),kb.SupportsRename&&wa.L_a(2),kb.SupportsChat&&wa.L_a(4));return wa}$2m(wa,kb){this.iak(wa,kb);return kb.Name||wa.userName||(wa.isAnonymous||kb.IsAnonymous?CommonUIStrings.l_GuestUserName:
null)}y_d(wa){u.ULS.sendTraceTag(42316245,302,100,"PeopleInfoProvider update detected: {0}",wa.toString());this.ma.raiseEvent("UU")}}Object(k.a)(vf,"PeopleInfoProvider",null,[930,14]);var Yc;(function(wa){wa[wa.multipleBrowsersImageClassName=0]="multipleBrowsersImageClassName";wa[wa.peopleImageClassName=1]="peopleImageClassName";wa[wa.peopleImageClusterPath=4]="peopleImageClusterPath";wa[wa.multipleBrowserImageClusterPath=5]="multipleBrowserImageClusterPath";wa[wa.imageDimension=6]="imageDimension";
wa[wa.rtl=8]="rtl";wa[wa.pointerInputManager=9]="pointerInputManager";wa[wa.clickInputManager=10]="clickInputManager";wa[wa.vertical=11]="vertical";wa[wa.zIndex=12]="zIndex";wa[wa.contextMenuInputManager=13]="contextMenuInputManager";wa[wa.imageDomElement=14]="imageDomElement";wa[wa.useIdleTooltip=15]="useIdleTooltip";wa[wa.viewportBoundsCallback=16]="viewportBoundsCallback";wa[wa.flipHorizontalDirection=17]="flipHorizontalDirection";wa[wa.fixRemoveFadeOutElementCrash=18]="fixRemoveFadeOutElementCrash";
wa[wa.ignoreEventOnExpandedTooltip=19]="ignoreEventOnExpandedTooltip";wa[wa.ipWidthAdjustForFlyout=20]="ipWidthAdjustForFlyout"})(Yc||(Yc={}));Object(k.b)("PresenceTooltipSettingKeys",Yc);class sb{constructor(){this.vq={}}get(wa,kb=null){wa=Yc[wa];return"number"===typeof kb?(kb=this.vq[wa])?Number.parseInvariant(kb.toString()):0:this.vq[wa]}add(wa,kb){this.vq[Yc[wa]]=kb}PGa(wa,kb){Yc[wa]in this.vq||(this.vq[Yc[wa]]=kb)}remove(wa){delete this.vq[Yc[wa]]}}Object(k.a)(sb,"PresenceTooltipSettings",null,
[]);class Qb extends Ga.a{constructor(wa){super();this._element=null;this.element=wa}get element(){return this._element}set element(wa){this._element=wa}get visible(){return"visible"===this.element.style.visibility}set visible(wa){this.element.style.visibility=wa?"visible":"hidden"}get rtl(){return"rtl"===this.element.dir.toLowerCase()}set rtl(wa){this.element.dir=wa?"rtl":"ltr"}get zIndex(){return this.element.style.zIndex}set zIndex(wa){this.element.style.zIndex=String(wa)}dispose(){this.element&&
this.element.parentNode&&this.element.parentNode.removeChild(this.element);this.element=null;super.dispose()}createElement(wa){return this.element.ownerDocument.createElement(wa)}Hea(){return!0}static m$g(wa){return"prControl"+(wa?"Rtl":"")}}Object(k.a)(Qb,"BasePresenceControl",Ga.a,[14,936]);class Oc extends Sys.EventArgs{constructor(wa,kb){super();this.type=wa;this.zl=kb}}Oc.GR="InteractivityChanged";Object(k.a)(Oc,"InteractivityChangedEventArgs",Sys.EventArgs,[]);class wc{static lYk(wa){return wc.mYk(wa)}static mYk(wa){const kb=
document.createElementNS(wc.i3f,"svg");kb.setAttribute("viewBox",String.format(wc.Mok,wc.lYi,wc.kYi));kb.appendChild(wc.yhl(wa));return kb}static yhl(wa){const kb=wc.lYi/wa,Pb=2*kb,Hb=wc.kYi/2;wa=(wa-12-8)*kb/2;const bd=document.createElementNS(wc.i3f,"g");Sys.UI.DomElement.addCssClass(bd,wc.Lok);for(let nc=1;3>=nc;nc++)bd.appendChild(wc.TUk(nc,Pb,wa+(6*nc-2)*kb,Hb));return bd}static TUk(wa,kb,Pb,Hb){const bd=document.createElementNS(wc.i3f,"circle");Sys.UI.DomElement.addCssClass(bd,String.format("{0}-{1}",
wc.A5j,wa));bd.setAttribute("cx",String.format("{0}",Pb));bd.setAttribute("cy",String.format("{0}",Hb));bd.setAttribute("r",String.format("{0}",kb));return bd}}wc.i3f="http://www.w3.org/2000/svg";wc.Lok="prDancingDots";wc.A5j="prAnimateCircle";wc.Mok="0 0 {0} {1}";wc.kYi=40;wc.lYi=120;Object(k.a)(wc,"ModernPresenceTooltipDancingDots",null,[]);var yc=b(83),ef=b(96),Je=b(7),fh=b(60),re=b(134),Se=b(52);class Ye extends Qb{constructor(wa,kb){super(wa);this.BKg=this.$3a=this.vde=this._img=this.kJ=this.xq=
this.Se=null;this.$Fa=kb.get(8,!1);this.H3a=kb.get(6,0);this.fzj=kb.get(15,!1);this.Kc=kb;this.Nhg=0;this.element=wa;this.element.className=Ye.Q2e;this._span=document.createElement("span");this.element.appendChild(this._span);this.Ncj=wc.lYk(kb.get(6,0));this.IF(kb);this._state=5}asb(wa){this.addHandler(Oc.GR,wa)}SEb(wa){this.removeHandler(Oc.GR,wa)}get user(){return this.BKg}get state(){return this._state}dispose(){this.element&&(this.Se.xb(Je.a.click,this.element,Object(f.a)(this,this.onClick,"onClick")),
this.Se.xb(Je.a.YA,this.element,Object(f.a)(this,this.Hea,"stopPropagationAndPreventDefaultBehavior")),this.xq.xb(Je.a.pointerDown,this.element,Object(f.a)(this,this.uC,"onPointerDown")),this.xq.xb(Je.a.pointerOut,this.element,Object(f.a)(this,this.HM,"onPointerOut")),this.xq.xb(Je.a.pointerOver,this.element,Object(f.a)(this,this.sV,"onPointerOver")),this.kJ.xb(this.element,Object(f.a)(this,this.Hea,"stopPropagationAndPreventDefaultBehavior")));super.dispose()}IF(wa){this.Se=wa.get(10);this.Se.Ea(Je.a.click,
this.element,Object(f.a)(this,this.onClick,"onClick"));this.Se.Ea(Je.a.YA,this.element,Object(f.a)(this,this.Hea,"stopPropagationAndPreventDefaultBehavior"));this.xq=wa.get(9);this.xq.Ea(Je.a.pointerOver,this.element,Object(f.a)(this,this.sV,"onPointerOver"));this.xq.Ea(Je.a.pointerOut,this.element,Object(f.a)(this,this.HM,"onPointerOut"));this.xq.Ea(Je.a.pointerDown,this.element,Object(f.a)(this,this.uC,"onPointerDown"));this.kJ=wa.get(13);this.kJ.Ea(this.element,Object(f.a)(this,this.Hea,"stopPropagationAndPreventDefaultBehavior"))}hide(wa=
null,kb=0,Pb=0){this.fzj&&wa?this.wrn(wa,kb,Pb):(3===this.state&&this.kqi(),this.visible=!1,this._state=5)}wrn(wa,kb,Pb=0){this.show(wa,kb,15,4,void 0,Pb)}mHi(wa,kb,Pb=!1,Hb=!1,bd=!1,nc=0){this.show(wa,kb,20,Pb?2:Hb?1:0,bd,nc)}Wqn(wa,kb,Pb,Hb=!1,bd=0){this.show(wa,kb,Pb+20,3,Hb,bd)}show(wa,kb,Pb,Hb=3,bd=!1,nc=0){!wa||Hb===this.state&&this.wtl(kb,Pb)||(this.nCj(Hb,bd,nc),this.kba(wa,Hb,nc),this._state=Hb,4===nc||0===nc&&!this.$Fa?this.element.style.left=kb+"px":this.element.style.right=kb+"px",this.element.style.top=
Pb+"px",this.visible=!0)}kba(wa,kb,Pb){this.BKg=wa;Se.a.Ux(this._span);re.a.f7j(this._span);this._span.id="fly_"+wa.clientId;this._span.style.backgroundColor=wa.color;4!==kb?(this._span.style.height=this.H3a+"px",this._span.style.lineHeight=this.H3a+"px",re.a.S$b(this._span,"border-radius",this.H3a+"px")):4===Pb||0===Pb&&!this.$Fa?this._span.style.left="0px":this._span.style.right="0px";2!==kb&&(4===kb?Se.a.Ew(this._span,""):1===kb?this._span.appendChild(this.Ncj):(this._span.setAttribute("dir","auto"),
Pb=Ha.a.Z3k(wa.userName),(!wa.isAnonymous||m.AFrameworkApplication.K.getBooleanFeatureGate("Microsoft.Office.SharedOnline.IsCustomAnonymousNameEnabled",!1))&&Pb||0!==kb?(wa=wa.userName,0===kb&&(wa=Pb,re.a.S$b(this._span,"text-align","center")),Se.a.Ew(this._span,wa)):(this._img||(this._img=this.Yfk()),this._span.appendChild(this._img),re.a.S$b(this._span,"text-align","start"))))}onClick(wa){if(0===this.state)return this.raiseEvent(Oc.GR,new Oc(1,wa)),!0;3===this.state&&u.ULS.sendTraceTag(50436114,
302,50,"User clicked on presence pill.");return!1}HM(wa){3===this.state&&this.raiseEvent(Oc.GR,new Oc(3,wa));return!1}sV(wa){3!==wa.He&&this.raiseEvent(Oc.GR,new Oc(2,wa));return!1}uC(wa){if(3!==wa.He)return!0;this.raiseEvent(Oc.GR,new Oc(4,wa));return!1}Yfk(){const wa=document.createElement("img");wa.src=yc.a.K7("doughperson_white_glyph.svg");wa.setAttribute("Unselectable","on");fh.a.wo(wa,fh.a.tg,fh.a.Sx);return ef.createClusteredImageFromClusterWithImageClass(this.H3a,this.H3a,null,null,Ye.OLk,
"",!1,"",this.element.ownerDocument,wa)}nCj(wa,kb=!1,Pb=0){if(!this.zIc(this.state)||!this.zIc(wa))switch(Sys.UI.DomElement.removeCssClass(this.element,this.vde),this.state){case 4:3===wa?this.LSa(Ye.R2e,Ye.inh):this.zIc(wa)&&this.LSa(Ye.P2e,Ye.inh);break;case 3:4===wa?this.LSa(Ye.U2e,Ye.hnh):this.zIc(wa)&&(kb&&this.kqi(),this.LSa(Ye.P2e,Ye.hnh,kb?Ye.NLk:""));break;case 0:case 1:case 2:4===wa?this.LSa(Ye.U2e,Ye.S2e):3===wa&&(kb&&this.rDj(),this.LSa(Ye.R2e,Ye.S2e,kb?Ye.jnh:"",3===Pb?Ye.RLk:Ye.PLk));
break;default:4===wa?this.LSa(Ye.U2e):3===wa?this.LSa(Ye.R2e):this.zIc(wa)&&this.LSa(Ye.P2e)}}LSa(...wa){this.vde=wa.join(" ");Sys.UI.DomElement.addCssClass(this.element,this.vde)}rDj(){this.Nhg=window.setTimeout(()=>{this.element&&(this.$3a=this.element.cloneNode(!0),this.element.parentNode.appendChild(this.$3a),this.element.style.zIndex="2",this.$3a.style.zIndex="1")},300)}kqi(){window.clearTimeout(this.Nhg);this.$3a&&(Sys.UI.DomElement.removeCssClass(this.$3a,Ye.S2e+" "+Ye.jnh),Sys.UI.DomElement.addCssClass(this.$3a,
Ye.MLk),L.Task.delay(300).continueWith(()=>{this.element&&this.element.parentNode===this.$3a.parentNode&&this.element.parentNode.removeChild(this.$3a)}),re.a.V8b(this.element,"z-index"))}zIc(wa){return 0===wa||1===wa||2===wa}wtl(wa,kb){const Pb=re.a.AV(this.element.style.top);return re.a.AV(this.element.style.left)===wa&&Pb===kb}QLf(wa){3===wa&&re.a.G7(this.element,"left")?(wa=re.a.AV(this.element.style.left),re.a.V8b(this.element,"left"),this.element.style.right=-1*wa+"px"):4===wa&&re.a.G7(this.element,
"right")&&(wa=re.a.AV(this.element.style.right),re.a.V8b(this.element,"right"),this.element.style.left=-1*wa+"px")}}Ye.Q2e="prModernFlyout UIFont";Ye.U2e="flyoutIdle";Ye.R2e="flyoutExpanded";Ye.P2e="flyoutCollapsed";Ye.inh="flyoutFromIdle";Ye.hnh="flyoutFromExpanded";Ye.S2e="flyoutFromCollapsed";Ye.jnh="flyoutStacked";Ye.NLk="flyoutFromStacked";Ye.MLk="flyoutFadeOut";Ye.OLk="cui-img-cont-float cui-img-20by20";Ye.PLk="flyoutLtrDir";Ye.RLk="flyoutRtlDir";Object(k.a)(Ye,"ModernPresenceTooltipFlyoutControl",
Qb,[]);class Ji{constructor(wa,kb,Pb=2,Hb=4){this.offsetTop=wa;this.offsetLeft=kb;this.hYi=Pb;this.wKh=Hb}}Object(k.a)(Ji,"FlyoutsPositioningInfo",null,[]);var ah=b(36);class ag{constructor(wa=!1,kb=!1){this.Ck=wa;this.eje=kb}f5k(wa,kb,Pb,Hb,bd){const nc=bd.y,Qe=bd.height;var ye=this.yTk(Hb);const lf=ye+kb,rh=wa*Pb+2*(wa-1);Pb=null;1===wa||this.b1j(ye,rh,nc,Qe)?wa=new Ji(0,0,2):(wa=this.B2e(lf,rh,nc,Qe),wa.offsetTop-=ye);this.eje?Pb=new Ji(0,0,void 0,this.Ck?4:3):(Hb=this.xTk(Hb,bd),ye=Math.max(0,
bd.x),bd=bd.width,kb=Hb+kb,this.c1j(Hb,ye,bd)?Pb=new Ji(0,0,void 0,this.Ck?3:4):this.d1j(kb,ye)&&(Pb=new Ji(0,0,void 0,this.Ck?4:3)),Pb||(Pb=this.AKk(Hb,kb,ye,bd)));return new Ji(wa.offsetTop,Pb.offsetLeft,wa.hYi,Pb.wKh)}yTk(wa){return ah.a.IIa(wa)}xTk(wa,kb){return this.Ck?kb.width-ah.a.Uqh(wa):ah.a.z5e(wa)}b1j(wa,kb,Pb,Hb){return wa+kb<=Pb+Hb}B2e(wa,kb,Pb,Hb){let bd=1,nc=Math.max(Pb,wa-kb);kb>wa-Pb&&(bd=2,nc=kb<Hb?Hb-kb:Pb);return new Ji(nc,0,bd)}c1j(wa,kb,Pb){return wa+150<=kb+Pb}d1j(wa,kb){return 150<=
wa-kb}AKk(wa,kb,Pb,Hb){Hb-kb>=wa-Pb?wa=4:(kb=wa,wa=3);return new Ji(0,kb,void 0,wa)}}Object(k.a)(ag,"ModernPresenceTooltipPositioner",null,[]);class rg{constructor(wa,kb,Pb,Hb,bd,nc,Qe){this.n6=wa;this._parent=kb;this.pcg=Pb;this.M$i=Hb;this.uhj=bd;this.ORb=nc;this.$Fa=Qe;this._element=document.createElement("div");this.element.className="prTouchTarget"}get element(){return this._element}update(wa,kb){if(3!==wa)if(5!==wa&&this.n6&&this.n6.length){if(4===wa){var Pb=this.uhj;var Hb=(this.ORb-Pb)/2;
this.element.style.height=this.ORb+"px";this.element.style.width=this.ORb+"px";wa=re.a.AV(this.n6[0].element.style.top);kb=re.a.AV(this.$Fa?this.n6[0].element.style.right:this.n6[0].element.style.left)}else Pb=this.pcg,Hb=(this.ORb-Pb)/2,this.element.style.height=this.ORb+"px",this.element.style.width=this.hVk()+2*Hb+"px",wa=re.a.AV(this.n6[this.n6.length-1].element.style.top),kb=this.f0j(this.n6[this.n6.length-1].element,Pb,kb);re.a.S$b(this.element,"border-radius",this.ORb+"px");this.element.style.top=
wa-Hb-Pb+"px";this.$Fa?this.element.style.right=kb-Hb+"px":this.element.style.left=kb-Hb+"px";this.element.parentNode||this._parent.insertBefore(this.element,this._parent.firstChild)}else this.element.parentNode&&this.element.parentNode.removeChild(this.element)}f0j(wa,kb,Pb){return this.$Fa&&!Pb?re.a.AV(wa.style.right):this.$Fa||Pb?this.$Fa&&Pb?-re.a.AV(wa.style.left)-kb:-re.a.AV(wa.style.right)-kb:re.a.AV(wa.style.left)}hVk(){return this.n6&&this.n6.length?this.pcg+Math.min(this.n6.length-1,2)*
this.M$i:0}}Object(k.a)(rg,"ModernPresenceTooltipTarget",null,[]);var pi=b(171),Rj=b(183);class Ki extends Qb{constructor(wa,kb,Pb){super(wa);this.sQb=this.REa=this.Pmg=this.imb=!1;this.Fo=[];this.T7c={};this.Kc=Pb;this.Ck=Pb.get(8,!1);this.Mlg=Pb.get(15,!1);this.Hbj=Pb.get(12,0);this.B8a=Pb.get(6,0);this.Y6a=kb;this.VKg=Pb.get(16);this.eje=Pb.get(17,!1);this.xhj=Pb.get(19,!1);this.Rqj=Pb.get(20,!1);this.J$c=0;this.Kqj=new ag(this.Ck,this.eje);this.Iec=this.vth();this.epb=!1;this.VJb=[];this.tkc=
[];this.element.id=Ki.cab();this.element.className=Qb.m$g(this.Ck);this.wUa&&(this.zIndex=this.wUa);this.rtl=this.Ck;this.yPf(kb);this.w2=this.createElement("div");this.w2.className="prFlyoutContainer";this.element.appendChild(this.w2);this.n6=[];this.A4a=new rg(this.f0,this.element,this.B8a,4,6,32,this.Ck);this.xq=Pb.get(9);this.xq.Ea(Je.a.pointerDown,this.A4a.element,Object(f.a)(this,this.u6b,"onHitTarget"));this.xq.Ea(Je.a.pointerOver,this.A4a.element,Object(f.a)(this,this.u6b,"onHitTarget"));
this.xq.Ea(Je.a.pointerOut,this.A4a.element,Object(f.a)(this,this.u6b,"onHitTarget"))}get UUd(){return Rj.a.clone(this.Fo)}get f0(){return this.n6}get wUa(){return this.Hbj}get jVa(){return this.f0?this.f0.length:0}get iIb(){return 0<this.jVa?this.f0[0].state:5}get Rif(){return 3===this.iIb&&!this.imb}asb(wa){this.addHandler(Oc.GR,wa)}SEb(wa){this.removeHandler(Oc.GR,wa)}dispose(){if(this.Rif)this.epb=!0;else{if(this.f0)for(const wa of this.f0)wa.SEb(Object(f.a)(this,this.yLa,"onInteractivityChanged")),
Af.a.pz(wa);this.n6=null;this.xq.xb(Je.a.pointerDown,this.A4a.element,Object(f.a)(this,this.u6b,"onHitTarget"));this.xq.xb(Je.a.pointerOver,this.A4a.element,Object(f.a)(this,this.u6b,"onHitTarget"));this.xq.xb(Je.a.pointerOut,this.A4a.element,Object(f.a)(this,this.u6b,"onHitTarget"));super.dispose()}}Bac(){this.FVb();this.visible=!0}uWc(){this.visible=!0;this.Ijh();this.imb=!0}WSf(){this.uWc()}hide(){this.Pqi();this.KWa();this.A4a.update(this.iIb,this.sQb)}kba(wa){const kb=this.iIb,Pb=this.imb;wa.clientId||
(wa.clientId=(Ki.Mkc++).toString());if(wa.clientId in this.T7c){var Hb=this.cwb(wa.clientId);if(0<=Hb){Hb=this.Fo[Hb];if(Hb.color===wa.color&&Hb.userName===wa.userName)return;this.d_a(wa.clientId)}}this.hide();Hb=new Ye(this.createElement("div"),this.Kc);Hb.asb(Object(f.a)(this,this.yLa,"onInteractivityChanged"));this.w2.insertBefore(Hb.element,this.w2.firstChild);this.T7c[wa.clientId]=Hb;Array.add(this.Fo,wa);Array.add(this.f0,Hb);this.uWi(kb,Pb);this.visible=!0}d_a(wa){if(this.Rif)Array.add(this.tkc,
wa);else{var kb=this.iIb,Pb=this.imb;this.hide();this.RSc(wa);this.uWi(kb,Pb)}}E6h(wa){const kb=this.cwb(wa);if(!(0>=kb)){var Pb=this.Fo[kb];wa=this.T7c[wa];Array.removeAt(this.Fo,kb);Array.insert(this.Fo,0,Pb);Array.removeAt(this.f0,kb);Array.insert(this.f0,0,wa);this.w2.removeChild(wa.element);this.w2.appendChild(wa.element);this.FVb()}}uWi(wa,kb){0>=this.Fo.length?this.hide():3===wa&&kb?this.uWc():this.Bac()}z0e(wa){if(this.Rif&&this.xhj)return!1;wa=Ki.v$e(wa);if(this.w2!==wa&&Se.a.YJa(this.w2,
wa))return!0;for(const kb of this.f0)if(Se.a.YJa(kb.element,wa))return!0;return!1}position(wa,kb){this.element.style.top=kb+"px";this.element.style.left=wa+"px"}FVb(wa=!1){if(!wa||this.REa){this.Pmg&&this.iDi(!0);var kb=Math.min(3,this.jVa)-1;wa=0;var Pb=1,Hb=0;this.sQb&&(wa=this.Iec,Pb=-1,Hb=-this.B8a);for(let bd=this.jVa-1;bd>kb;bd--)this.f0[bd].mHi(this.Fo[bd],-4*kb*Pb+Hb,!0,!1,!0,wa);for(;0<=kb;kb--)this.f0[kb].mHi(this.Fo[kb],-4*kb*Pb+Hb,0<kb,Array.contains(this.VJb,this.Fo[kb].clientId),kb!==
this.J$c,wa);this.J$c=0;this.A4a.update(0,this.sQb);this.zIndex=this.wUa;this.imb=!1;this.Pqi(0);this.epb&&this.dispose()}}Ijh(){this.Pmg&&this.iDi(!1);this.zIndex=this.wUa+1;let wa,kb,Pb;({offsetX:kb,offsetY:wa,vKh:Pb}=this.Kfn());for(let Hb=0;Hb<this.jVa;Hb++)this.f0[Hb].Wqn(this.Fo[Hb],kb,wa+(this.B8a+2)*Hb,Hb!==this.J$c,Pb)}KWa(){let wa=0,kb=0;this.sQb&&(wa=this.Iec,kb=-6);for(let Pb=0;Pb<this.jVa;Pb++)this.f0[Pb].hide(this.Fo[Pb],kb,wa);this.zIndex=this.wUa;this.visible=this.imb=!1;this.epb&&
this.dispose()}FQe(wa=0){wa?(this.REa=!0,L.Task.delay(wa).continueWith(()=>{this.Mlg?this.Vul():this.FVb(!0);this.REa=!1})):this.Mlg?this.hide():this.FVb()}Vul(){this.REa&&this.hide()}OTj(){if(m.AFrameworkApplication.na&&m.AFrameworkApplication.na.Ya.Hja&&pi.c()){const wa=appChrome.selectors.getShyState();return wa.isActive&&0!==wa.state}return!1}yLa(wa,kb){wa=this.iIb;this.OTj()||2!==kb.type&&(4!==kb.type||3===wa)?4===kb.type&&3===wa?(this.REa&&(this.REa=!1),this.FQe()):3!==kb.type||3!==wa||this.imb||
(1<this.jVa?(this.REa=!0,L.Task.delay(250).continueWith(()=>{this.FVb(!0);this.REa=!1})):this.FQe()):(this.REa&&(this.REa=!1),3!==wa&&(this.Ijh(),3===kb.zl.He&&this.FQe(2E3)));this.raiseEvent(Oc.GR,kb)}u6b(wa){3===wa.He?this.yLa(this,new Oc(4,wa)):wa.eventName===Je.a.pointerOver?this.yLa(this,new Oc(2,wa)):wa.eventName===Je.a.pointerOut&&this.yLa(this,new Oc(3,wa));return!1}yPf(wa){this.element.style.width=wa+"px";this.element.style.height=this.B8a+"px"}RSc(wa){this.dVm(wa);wa=this.cwb(wa);if(!(0>
wa)){var kb=this.Fo[wa];Array.removeAt(this.Fo,wa);delete this.T7c[kb.clientId];kb=this.f0[wa];this.w2.removeChild(kb.element);this.Kc.get(18,!1)&&kb.SEb(Object(f.a)(this,this.yLa,"onInteractivityChanged"));Array.removeAt(this.f0,wa);kb.dispose()}}Pqi(wa=5){if(this.tkc.length){this.visible&&this.KWa();for(let kb=0;kb<this.tkc.length;kb++)this.RSc(this.tkc[kb]);Array.clear(this.tkc);0>=this.Fo.length||5===wa?this.hide():0===wa&&this.Bac()}}cwb(wa){for(let kb=0;kb<this.Fo.length;kb++)if(this.Fo[kb].clientId===
wa)return kb;return-1}dVm(wa){-1===this.cwb(wa)?u.ULS.sendTraceTag(41706452,302,50,"Cannot remove active editor because client id is invalid"):Array.contains(this.VJb,wa)&&(Array.remove(this.VJb,wa),this.Fo[0].clientId===wa&&0<this.VJb.length&&this.E6h(this.VJb[this.VJb.length-1]),this.Fo[0].clientId===wa&&1===this.iIb&&this.FVb())}iDi(wa){wa?Sys.UI.DomElement.addCssClass(this.w2,"prBackgroundSelection"):Sys.UI.DomElement.removeCssClass(this.w2,"prBackgroundSelection")}Kfn(){let wa,kb;kb=wa=0;var Pb=
this.Iec;if(this.VKg){const Hb=this.VKg(this);if(!Hb)return{offsetX:wa,offsetY:kb,vKh:Pb};const bd=4===this.iIb;Pb=this.Kqj.f5k(this.jVa,bd?6:this.B8a,this.B8a,this.element,Hb);kb=Pb.offsetTop;this.J$c=this.Q3k(Pb.hYi,Pb.offsetTop);Pb=Pb.wKh;Pb!==this.Iec&&(this.QLf(Pb),this.element.dir=3===Pb?"rtl":"ltr",this.Iec=Pb);Pb!==this.vth()?(wa=this.Rqj?-2:bd?-6:-this.B8a,this.sQb=!0):this.sQb=!1}return{offsetX:wa,offsetY:kb,vKh:Pb}}Q3k(wa,kb){if(1===wa)return this.jVa-1;wa=Math.abs(kb);return 0<wa?wa/(this.B8a+
2):0}QLf(wa){for(let kb=0;kb<this.jVa;kb++)this.f0[kb].QLf(wa)}vth(){return this.Ck?3:4}static cab(){return String.format("{0}-{1}","presencetooltip",Ki.Mkc++)}static v$e(wa){return wa.Sa.rawEvent.relatedTarget}}Ki.Mkc=0;Object(k.a)(Ki,"ModernPresenceTooltipControl",Qb,[996,14]);var Fd=b(240),Ld=b(243);class we{constructor(wa){this.Kc=wa;this.Kc.PGa(10,Fd.a.instance);this.Kc.PGa(9,Ve.a.instance);this.Kc.PGa(6,20);this.Kc.PGa(13,Ld.a.instance);this.Kc.PGa(17,!1)}xTe(wa,kb=!1){this.Kc.PGa(15,kb);return new Ki(wa,
20,this.Kc)}}Object(k.a)(we,"ModernPresenceTooltipFactory",null,[995]);class Te extends Qb{constructor(wa,kb){super(wa);this.Fo=null;this.$Fa=kb.get(8,!1);this.H3a=kb.get(6,0);this.element=wa;this.element.className=Te.Q2e;this._ul=this.createElement("ul");this.element.appendChild(this._ul);this.Se=kb.get(10);this.Se.Ea(Je.a.click,this.element,Object(f.a)(this,this.onClick,"onClick"));this.xq=kb.get(9);this.xq.Ea(Je.a.pointerOut,this.element,Object(f.a)(this,this.HM,"onPointerOut"));this.xq.Ea(Je.a.pointerDown,
this.element,Object(f.a)(this,this.Hea,"stopPropagationAndPreventDefaultBehavior"));this.kJ=kb.get(13);this.kJ.Ea(this.element,Object(f.a)(this,this.Hea,"stopPropagationAndPreventDefaultBehavior"))}asb(wa){this.addHandler(Oc.GR,wa)}SEb(wa){this.removeHandler(Oc.GR,wa)}get users(){return this.Fo}dispose(){this.element&&(this.Se.xb(Je.a.click,this.element,Object(f.a)(this,this.onClick,"onClick")),this.xq.xb(Je.a.pointerDown,this.element,Object(f.a)(this,this.Hea,"stopPropagationAndPreventDefaultBehavior")),
this.xq.xb(Je.a.pointerOut,this.element,Object(f.a)(this,this.HM,"onPointerOut")),this.kJ.xb(this.element,Object(f.a)(this,this.Hea,"stopPropagationAndPreventDefaultBehavior")));super.dispose()}hide(){this.visible=!1}show(wa,kb,Pb){this.hide();!wa||0>=wa.length||(this.$Fa?this.element.style.right=kb+"px":this.element.style.left=kb+"px",this.element.style.top=Pb+"px",this.IGj(wa),this.visible=!0)}IGj(wa){this.Fo=wa;Se.a.Ux(this._ul);for(let kb=wa.length-1;0<=kb;kb--)this.kba(wa[kb])}kba(wa){const kb=
document.createElement("li");kb.style.backgroundColor=wa.color;kb.style.height=this.H3a+"px";kb.id="fly_"+wa.clientId;kb.style.lineHeight=this.H3a+"px";Se.a.Ew(kb,wa.userName);kb.setAttribute("dir","auto");this._ul.appendChild(kb)}onClick(){this.hide();return!1}HM(wa){this.raiseEvent(Oc.GR,new Oc(3,wa));return!1}}Te.Q2e="prFlyout UIFont";Object(k.a)(Te,"PresenceTooltipFlyoutControl",Qb,[]);class Dj extends Qb{constructor(wa,kb,Pb){super(wa);this._img=null;this.Fo=[];this.element.className="prGlyph";
this.Kc=kb;this.WPb=this.Kc.get(9);this.Uo=this.Kc.get(10);this.kJ=this.Kc.get(13);this.tvl();this.kba(Pb);this.Bne=!1}get aZa(){return this.Fo.length}get users(){return this.Fo}asb(wa){this.addHandler(Oc.GR,wa)}SEb(wa){this.removeHandler(Oc.GR,wa)}dispose(){this.TJn();super.dispose()}kba(wa){Array.add(this.Fo,wa);2===this.aZa?this.bfa(!0):1===this.aZa?this.bfa(!1):this.bfa(this.Bne)}d_a(wa){this.LHk(wa)&&(1<this.aZa&&this.bfa(!0),1===this.aZa?this.bfa(!1):1>this.aZa&&this.hide())}show(){this.bfa(2<=
this.aZa);this.visible=!0}hide(){this.visible=!1}A3k(wa){return wa?this.ash(0,5):this.ash(1,4)}LHk(wa){for(let kb=0;kb<this.aZa;kb++)if(this.Fo[kb].clientId===wa)return wa=this.Fo[kb],Array.removeAt(this.Fo,kb),wa;return null}bfa(wa){this.Bne!==wa&&(this._img&&this.element.removeChild(this._img),this._img=this.A3k(wa),this.element.appendChild(this._img),this.Bne=wa);this._img.childNodes[0].style.backgroundColor=this.Fo[this.Fo.length-1].color}ash(wa,kb){const Pb=this.Kc.get(6,0),Hb=this.Kc.get(14);
return ef.createClusteredImageFromClusterWithImageClass(Pb,Pb,this.Kc.get(wa),this.Kc.get(kb),"cui-img-cont-float cui-img-16by16","",!1,"",this.element.ownerDocument,Hb?Hb.cloneNode(!0):null)}sV(wa){3!==wa.He&&this.raiseEvent(Oc.GR,new Oc(2,wa));return!1}onClick(wa){this.raiseEvent(Oc.GR,new Oc(1,wa));return!0}HM(wa){3!==wa.He&&this.raiseEvent(Oc.GR,new Oc(3,wa));return!1}TJn(){this.element&&(this.WPb.xb(Je.a.pointerDown,this.element,Object(f.a)(this,this.Hea,"stopPropagationAndPreventDefaultBehavior")),
this.WPb.xb(Je.a.pointerOver,this.element,Object(f.a)(this,this.sV,"onPointerOver")),this.WPb.xb(Je.a.pointerOut,this.element,Object(f.a)(this,this.HM,"onPointerOut")),this.Uo.xb(Je.a.YA,this.element,Object(f.a)(this,this.Hea,"stopPropagationAndPreventDefaultBehavior")),this.Uo.xb(Je.a.click,this.element,Object(f.a)(this,this.onClick,"onClick")),this.kJ.xb(this.element,Object(f.a)(this,this.Hea,"stopPropagationAndPreventDefaultBehavior")))}tvl(){this.element&&(this.WPb.Ea(Je.a.pointerDown,this.element,
Object(f.a)(this,this.Hea,"stopPropagationAndPreventDefaultBehavior")),this.WPb.Ea(Je.a.pointerOver,this.element,Object(f.a)(this,this.sV,"onPointerOver")),this.WPb.Ea(Je.a.pointerOut,this.element,Object(f.a)(this,this.HM,"onPointerOut")),this.Uo.Ea(Je.a.YA,this.element,Object(f.a)(this,this.Hea,"stopPropagationAndPreventDefaultBehavior")),this.Uo.Ea(Je.a.click,this.element,Object(f.a)(this,this.onClick,"onClick")),this.kJ.Ea(this.element,Object(f.a)(this,this.Hea,"stopPropagationAndPreventDefaultBehavior")))}}
Object(k.a)(Dj,"PresenceTooltipGlyph",Qb,[]);class oi extends Qb{constructor(wa,kb,Pb){super(wa);this.Fo=[];this.RH=[];this.sFa=0;this.rrc=this.VMb=!1;this.X8f=null;this.U7c={};this.Kc=Pb;this.Ck=Pb.get(8,!1);this.ega=Pb.get(11,!1);wa=Pb.get(12,0);this.imageDimension=Pb.get(6,0);this.Y6a=kb;this.element.id=oi.cab();this.element.className=Qb.m$g(this.Ck);wa&&(this.zIndex=wa);this.rtl=this.Ck;this.yPf(kb);this.Iua=this.createElement("div");this.Iua.className=this.ega?"prContainerV":"prContainerHr";
this.element.appendChild(this.Iua);this.cjg=Array(this.sFa);for(kb=0;kb<this.sFa;kb++)this.g8[kb]=new Te(this.createElement("div"),this.Kc),this.g8[kb].asb(Object(f.a)(this,this.yLa,"onInteractivityChanged")),this.element.appendChild(this.g8[kb].element)}get UUd(){return Rj.a.clone(this.Fo)}get g8(){return this.cjg}get EMg(){return this.X8f}get Q2d(){return this.imageDimension+2}get width(){return this.ega?this.Q2d:this.Y6a}get height(){return this.ega?this.Y6a:this.Q2d}asb(wa){this.addHandler(Oc.GR,
wa)}SEb(wa){this.removeHandler(Oc.GR,wa)}dispose(){if(this.g8)for(const wa of this.g8)wa.SEb(Object(f.a)(this,this.yLa,"onInteractivityChanged")),Af.a.pz(wa);Af.a.xNf(this.RH);this.RH=this.cjg=null;super.dispose()}Bac(){this.KWa();this.lTf();this.visible=!0;this.VMb=!1}uWc(){!this.RH||1>this.RH.length||(this.KWa(),this.visible=!0,this.lTf(),this.JUd(this.RH[this.RH.length-1]),this.VMb=!0)}WSf(){if(this.RH&&!(1>this.RH.length)){this.visible=!0;this.lTf();var wa=0;for(const kb of this.RH)this.JUd(kb,
wa++);this.VMb=!1;this.rrc=!0}}hide(){this.visible=!1;this.KWa();for(let wa=0;wa<this.RH.length;wa++)this.RH[wa].hide();this.VMb=!1}i1g(){if(!this.rrc)return!1;let wa=0;for(const kb of this.g8)kb.visible&&wa++;return this.rrc=0<wa&&(this.Fo.length<=this.sFa?wa===this.Fo.length:wa===this.sFa)}kba(wa){if(!(0>=this.sFa)){wa.clientId||(wa.clientId=(oi.Mkc++).toString());if(wa.clientId in this.U7c){var kb=this.cwb(wa.clientId);if(0<=kb){kb=this.Fo[kb];if(kb.color===wa.color&&kb.userName===wa.userName)return;
this.d_a(wa.clientId)}}kb=this.i1g();var Pb=0;if(this.Fo.length<this.sFa){var Hb=new Dj(this.createElement("div"),this.Kc,wa);Hb.asb(Object(f.a)(this,this.yLa,"onInteractivityChanged"));this.Ck&&!this.ega&&0<this.Fo.length?this.Iua.insertBefore(Hb.element,this.Iua.firstChild):(this.Iua.appendChild(Hb.element),Pb=this.RH.length);Array.add(this.RH,Hb)}else this.Ck&&!this.ega?Hb=this.RH[0]:(Pb=this.RH.length-1,Hb=this.RH[Pb]),Hb.kba(wa);Hb.show();this.U7c[wa.clientId]=Hb;Array.add(this.Fo,wa);this.rUi(Hb,
Pb);kb&&this.WSf()}}d_a(wa){const kb=this.i1g();kb&&this.KWa();this.RSc(wa);this.Fo.length>=this.sFa&&this.RH.length<this.sFa&&this.GNm();0>=this.Fo.length?this.hide():kb&&this.WSf()}E6h(){}RSc(wa){var kb=this.cwb(wa);0>kb||(wa=this.Fo[kb],Array.removeAt(this.Fo,kb),kb=this.U7c[wa.clientId],delete this.U7c[wa.clientId],kb.d_a(wa.clientId),this.rUi(kb),0>=kb.aZa&&(this.Iua.removeChild(kb.element),Array.remove(this.RH,kb),kb.dispose()))}GNm(){var wa=this.V9k();!wa||1>=wa.users.length||(wa=Array.clone(this.Fo),
wa.forEach(kb=>{this.RSc(kb.clientId)}),wa.forEach(kb=>{this.kba(kb)}))}cwb(wa){for(let kb=0;kb<this.Fo.length;kb++)if(this.Fo[kb].clientId===wa)return kb;return-1}V9k(){return this.Ck&&!this.ega?this.RH[0]:this.RH[this.RH.length-1]}position(wa,kb){this.element.style.top=kb+"px";this.element.style.left=wa+"px"}lTf(){for(let wa=0;wa<this.RH.length;wa++)this.RH[wa].show()}KWa(){for(let wa=0;wa<this.sFa;wa++)this.g8[wa].hide();this.rrc=!1}JUd(wa,kb=0){if(wa)if(this.X8f=wa,this.ega){const Pb=this.imageDimension;
if(1<wa.users.length)this.g8[kb].show(wa.users,Pb,this.height-this.imageDimension);else{const Hb=this.Iua.children.length;for(let bd=0;bd<this.Iua.children.length;bd++)wa.element===this.Iua.children[bd]&&this.g8[kb].show(wa.users,Pb,this.height-(Hb-bd)*this.Q2d+2)}}else this.g8[kb].show(wa.users,this.width,0)}yLa(wa,kb){var Pb=Object(r.a)(Dj,wa);Pb=Pb?this.Blh(Pb):-1;if(2===kb.type||1===kb.type&&-1!==Pb&&!this.g8[Pb].visible)this.JUd(wa);else if(1===kb.type)this.KWa(),this.VMb=!1;else if(3===kb.type){if(this.z0e(kb.zl))return;
this.VMb||this.KWa()}this.raiseEvent(Oc.GR,kb)}z0e(wa){wa=oi.v$e(wa);let kb=!1;for(const Pb of this.g8)if(Se.a.YJa(Pb.element,wa)){kb=!0;break}return this.Iua!==wa&&Se.a.YJa(this.Iua,wa)||kb}rUi(wa,kb=0){const Pb=this.iGl(wa);Pb&&0>=wa.aZa?this.g8[kb].hide():Pb?this.JUd(wa):this.g8[kb].hide()}Blh(wa){let kb=0;for(const Pb of this.RH){if(wa===Pb)return kb;kb++}return-1}iGl(wa){const kb=this.Blh(wa);return!!this.EMg&&wa===this.EMg&&-1!==kb&&this.g8[kb].visible}yPf(wa){this.sFa=wa===this.imageDimension?
1:Math.floor(wa/this.Q2d);this.ega?(this.element.style.height=wa+"px",this.element.style.width=this.imageDimension+"px"):(this.element.style.width=wa+"px",this.element.style.height=this.imageDimension+"px")}static cab(){return String.format("{0}-{1}","presencetooltip",oi.Mkc++)}static v$e(wa){wa=wa.Sa.rawEvent;return wa.relatedTarget||wa.toElement}}oi.Mkc=0;Object(k.a)(oi,"PresenceTooltipControl",Qb,[996,14]);class ik{constructor(wa){this.Kc=wa;this.Kc.PGa(10,Fd.a.instance);this.Kc.PGa(9,Ve.a.instance);
this.Kc.PGa(6,16);this.Kc.PGa(13,Ld.a.instance)}xTe(wa){return new oi(wa,16,this.Kc)}}Object(k.a)(ik,"PresenceTooltipFactory",null,[995]);var Nf=b(253),vj=b(101),Qj=b(58),Jg=b(6),Mi=b(5),rf=b(21),ld=b(88),lg=b(38),Cj=b(528),Bm=b(291),bi=b(246);class ml extends Sys.EventArgs{constructor(wa,kb){super();this.paragraphId=wa;this.yYl=kb}}Object(k.a)(ml,"PresenceControlRenderedEventArgs",Sys.EventArgs,[]);class fg extends Qb{constructor(wa,kb,Pb,Hb,bd,nc=null,Qe=null){super(null);this.J7c=this.xl=null;
this.GLc=!1;this.Nla=0;this.Ln=wa;this.qsc=kb;this.xq=Pb;this.hg=Hb;this.JDa=bd;fg.Amb=0;this.PRg=new cb.a;this.Mui=new cb.a;this.YT=nc;this.qa=Qe;this.zej=this.qa.vb("PresenceIpRenderedFloodgateTimeLapseSec",30);this.pyj=this.qa.vb("PresenceIpRenderedFloodgateTriggerThreshold",3);this.j3a=0}get PYa(){return m.AFrameworkApplication.K.$("PeoplesWellExtraButtonInfoIsEnabled")}nHj(wa){this.addHandler("CR",wa)}xri(wa){this.removeHandler("CR",wa)}aXd(){this.raiseEvent("CR",new ml(this.Ln.ip.paragraphId,
this.GLc))}Qsf(){if(Object(bi.a)(Ki,this.xl)){const wa=Object(r.a)(Ki,this.xl);fg.Amb=0<fg.Amb?fg.Amb+1:wa.wUa+1;wa.zIndex=fg.Amb;this.element.style.zIndex=String(fg.Amb)}}j2m(){if(Object(bi.a)(Ki,this.xl)){const wa=Object(r.a)(Ki,this.xl);fg.Amb=wa.wUa;wa.zIndex=wa.wUa;this.element.style.zIndex=String(wa.wUa)}}A1h(){this.YT&&!this.AGn()&&this.YT.continueWith(()=>{this.YT.result.logActivity("PresenceIpRendered","PresenceIpRenderedFloodgateEnabled",this.zej)&&this.j3a++})}AGn(){return this.j3a>=this.pyj}static P0h(){fg.Pig||
(fg.Pig=!0,u.ULS.sendTraceTag(4006594,302,50,"First presence ip rendered on the page"))}static cab(wa){return fg.Fwl+wa.Hvh()}}fg.cji="data-presence-control";fg.hfi="OverlayControlElementOwner";fg.Fwl="ipId_";fg.dji="WacPresence";fg.Rwm="PresenceIpPaddingDiv";fg.Pig=!1;fg.Amb=0;Object(k.a)(fg,"APresenceControl",Qb,[1170,14]);class Ej{constructor(){this.rotation=this.height=this.width=this.top=this.left=0;this.$_a=!1}}Object(k.a)(Ej,"PresenceImageControlStyle",null,[1169]);class ui extends fg{constructor(wa,
kb,Pb,Hb,bd,nc=null,Qe=null){super(wa,kb,Pb,Hb,bd,nc,Qe)}d_a(wa){this.xl&&this.xl.d_a(wa)}R7d(){return this.xl?this.xl.UUd.length:0}updatePosition(wa){if(this.element&&this.element.parentNode){var kb=this.hwh(wa);if(kb){var Pb=Sys.UI.DomElement.getBounds(this.element.parentNode),Hb,bd;({left:Pb,top:Hb,height:bd,width:kb}=this.sbl(kb,Pb,this.element.parentNode,this.hg.instance));this.element.style.top=Hb+"px";this.element.style.left=Pb+"px";this.element.style.height=bd+"px";this.element.style.width=
kb+"px";Pb=this.nwh(wa);re.a.d$(this.element,Pb);wa=this.j8e(wa,this.Ln.ip.shapeId);this.MDi(Pb,kb,this.isSelected(wa),m.AFrameworkApplication.isRtl);this.$Gb()}}}DC(){this.element&&(Se.a.Zs(this.element),this.xl.d_a(this.Ln.user.clientId),this.aXd())}h5g(wa,kb,Pb,Hb){kb=new Ej;if(!Hb||!Pb)return kb;Pb=this.hwh(wa);if(!Pb)return kb;kb.top=Pb.y;kb.left=Pb.x;kb.height=Pb.height;kb.width=Pb.width;kb.rotation=this.Sdl(wa);kb.$_a=!0;return kb}psi(wa,kb,Pb,Hb){fg.P0h();this.J7c=wa;if(Hb){const bd=this.j8e(wa,
this.Ln.ip.shapeId);if(!bd)return;const nc=!this.element;nc&&this.ATe(kb.ownerDocument,wa);nc||!this.element.parentNode?bd.appendChild(this.element):this.element.parentNode!==bd&&(this.element.parentNode.removeChild(this.element),bd.appendChild(this.element));this.xl.kba(this.Ln.user);this.element.style.borderColor=this.Ln.user.color;this.element.id=fg.cab(this.Ln);Pb.$_a&&(this.element.style.height=Pb.height+"px",this.element.style.top=Pb.top+"px",this.element.style.left=Pb.left+"px",this.element.style.width=
Pb.width+"px",re.a.d$(this.element,Pb.rotation),re.a.d$(this.xl.element,-1*Pb.rotation),this.MDi(Pb.rotation,Pb.width,this.isSelected(bd),m.AFrameworkApplication.isRtl),this.$Gb())}this.GLc=!Hb;this.aXd()}Sdl(wa){return this.element&&this.element.parentNode&&this.XBh(re.a.getTransform(this.element.parentNode))?this.XBh(re.a.getTransform(this.element)):this.nwh(wa)}XBh(wa){return wa&&-1<wa.indexOf("deg")&&(wa=parseInt(wa.substring(wa.indexOf("(")+1,wa.indexOf("deg"))),!isNaN(wa))?wa:0}TTi(wa){this.element.style.borderColor=
this.Ln.user.color;this.element.id=fg.cab(this.Ln);this.updatePosition(wa)}ATe(wa,kb){this.element=wa.createElement("div");this.element.setAttribute(fg.cji,!0);vj.a.Gl(this.element,fg.hfi,this);this.element.className=ui.iEm;m.AFrameworkApplication.K&&m.AFrameworkApplication.K.getBooleanFeatureGate("Microsoft.Office.WordOnline.LoopsCoAuthSelectionIssueFixIsEnable",!1)&&(wa=kb.Ia)&&wa.WN&&(this.element.style.pointerEvents="none");this.element.dir=m.AFrameworkApplication.isRtl?"rtl":"ltr";this.xl=this.qsc.xTe(this.createElement("div"),
!0);this.xl.kba(this.Ln.user);this.xl.hide();this.xq.Ea(Je.a.pointerOut,this.xl.element,Object(f.a)(this,this.HM,"onPointerOut"));this.xq.Ea(Je.a.pointerDown,this.xl.element,Object(f.a)(this,this.rSd,"onTooltipTouch"));this.xl.element.classList.add(fg.dji);this.element.appendChild(this.xl.element)}sbl(wa,kb,Pb,Hb){let bd=wa.y,nc=wa.x,Qe=wa.height;wa=wa.width;(1<Math.abs(kb.width-Pb.offsetWidth)||1<Math.abs(kb.height-Pb.offsetHeight))&&Hb&&(bd=Math.round(bd/Hb.ei),nc=Math.round(nc/Hb.ei),Qe=Math.round(Qe/
Hb.ei),wa=Math.round(wa/Hb.ei));return{left:nc,top:bd,height:Qe,width:wa}}isSelected(wa){return Object(lg.a)(wa,Bm.a.cXb)}MDi(wa,kb,Pb,Hb){this.xl.element.style.left="auto";this.xl.element.style.top="auto";this.xl.element.style.right="auto";this.xl.element.style.bottom="auto";Pb=Pb?Math.round(.5*ui.Lla)+ui.KEn:0;0<=wa&&90>wa||360===wa?(this.xl.element.style.top=-.5*ui.Lla-Pb+"px",Hb?this.xl.element.style.right=kb-.5*ui.Lla+"px":this.xl.element.style.left=kb-.5*ui.Lla+"px"):90<=wa&&180>wa?(this.xl.element.style.left=
-.5*ui.Lla-Pb+"px",Hb?this.xl.element.style.bottom=-.5*ui.Lla+"px":this.xl.element.style.top=-.5*ui.Lla+"px"):180<=wa&&270>wa?(this.xl.element.style.bottom=-.5*ui.Lla-Pb+"px",Hb?this.xl.element.style.left=kb-.5*ui.Lla+"px":this.xl.element.style.right=kb-.5*ui.Lla+"px"):(this.xl.element.style.right=-.5*ui.Lla-Pb+"px",Hb?this.xl.element.style.top=-.5*ui.Lla+"px":this.xl.element.style.bottom=-.5*ui.Lla+"px")}Fg(wa,kb){const Pb=this.Xzd(wa,kb);return Pb?Pb.properties:(wa=this.mwh(wa,kb))?wa.properties:
null}j8e(wa,kb){var Pb=this.Xzd(wa,kb);return Pb&&(Pb=Pb.dWa(wa.Fe))?Pb.element:(kb=this.mwh(wa,kb))?Object(r.a)(Cj.a,kb).Sd(wa.gb).htmlElement:null}Xzd(wa,kb){wa=ld.i(wa.Ia,5);for(const Pb of wa)if(Pb.properties.getValue(Jg.a.rvb)===kb)return Pb;return null}mwh(wa,kb){wa=Mi.GraphIterator.va(wa.Ia);let Pb=wa.Za(6);for(;Pb;){const Hb=Pb.properties.getValue(Jg.a.rvb);if(rf.ImageReader.ix(Pb)&&Hb===kb)return Pb;Pb=wa.ue(6)}return null}p3k(wa){const kb=Qj.a.Re(rf.ImageReader.oC(wa),0);wa=Qj.a.Re(rf.ImageReader.PD(wa),
1);return{kfa:kb,qul:wa}}nwh(wa){wa=this.Fg(wa,this.Ln.ip.shapeId);return rf.ImageReader.a4(wa)}hwh(wa){var kb=this.Ln.ip;if(!kb||!kb.shapeId)return null;var Pb=this.Fg(wa,kb.shapeId);const Hb=this.j8e(wa,kb.shapeId);if(!Pb||!Hb)return null;({kfa:wa,qul:kb}=this.p3k(Pb));let bd=1,nc=1;Pb.hasProperty(Jg.a.oY)?(Pb=Pb.getValue(Jg.a.oY),bd+=Qj.a.Re(Pb[0],0),nc+=Qj.a.Re(Pb[2],1)):(bd+=0<Hb.offsetWidth?(Hb.offsetWidth-wa)/2:2,nc+=0<Hb.offsetHeight?(Hb.offsetHeight-kb)/2:2);return new Sys.UI.Bounds(Math.round(bd),
Math.round(nc),Math.round(wa),Math.round(kb))}HM(){this.L5h();return!1}rSd(wa){this.xl&&3===wa.He&&(2!==this.Nla?(this.Qsf(),this.$Gb()):this.L5h());return!1}L5h(){this.xl&&(this.xl.Bac(),this.Nla=1)}$Gb(){for(const wa of this.xl.UUd)if(wa.clientId===this.Ln.user.clientId&&!wa.equals(this.Ln.user)){this.xl.kba(this.Ln.user);break}if(this.Ln.nNa||2===this.Nla)this.xl.uWc(),this.Ln.nNa=!1,this.Ln.b9=!0,this.Nla=2;this.Ln.b9&&1!==this.Nla||(this.xl.Bac(),this.Ln.b9=!0,this.Nla=1)}}ui.iEm="WACImgPresenceHighlight";
ui.Lla=20;ui.KEn=6;Object(k.a)(ui,"PresenceImageControl",fg,[]);var Xl=b(277);class qf{constructor(){this.height=this.top=this.left=this.kPh=0;this.$_a=!1;this.kz=this.gg=null}}Object(k.a)(qf,"PresenceIpControlStyle",null,[1169]);var yk=b(75);class Qh extends fg{constructor(wa,kb,Pb,Hb,bd,nc=null,Qe=null,ye=null){super(wa,kb,Pb,Hb,bd,nc,Qe);this.zrc=this.hQa=this.mRb=null;this.KA=ye}ATe(wa){this.element=wa.createElement("div");this.element.setAttribute(fg.cji,!0);vj.a.Gl(this.element,fg.hfi,this);
this.element.className=fg.Rwm;this.element.dir=m.AFrameworkApplication.isRtl?"rtl":"ltr";this.xq.Ea(Je.a.pointerOver,this.element,Object(f.a)(this,this.sV,"onPointerOver"));this.PYa&&(this.xq.Ea(Je.a.pointerOut,this.element,Object(f.a)(this,this.HM,"onPointerOut")),this.xq.Ea(Je.a.pointerDown,this.element,Object(f.a)(this,this.rSd,"onTooltipTouch")));this.hQa=this.createElement("div");this.hQa.className=Qh.jEm;this.PYa||(this.zrc=this.createElement("div"),this.zrc.className=Qh.mEm,this.hQa.appendChild(this.zrc));
this.xl=this.qsc.xTe(this.createElement("div"),this.PYa);wa=this.qa.$("NoPresenceUserLookUpBeforeRender");this.KA&&!wa&&(this.Ln.user=this.KA.q2h(this.Ln.user.clientId)||this.Ln.user);this.xl.kba(this.Ln.user);this.xl.hide();this.xl.element.classList.add(this.PYa?fg.dji:Qh.dAm);this.hQa.appendChild(this.xl.element);this.element.appendChild(this.hQa)}sV(wa){!this.xl||this.PYa&&!this.xl.z0e(wa)||(this.Qsf(),this.YZd(wa));this.TTi(this.J7c);return!1}HM(){this.xl&&this.xO();return!1}rSd(wa){this.xl&&
3===wa.He&&(2!==this.Nla?(this.Qsf(),this.YZd(wa)):this.xO());return!1}nrk(){this.mRb&&(pb.a.instance.me(this.mRb),this.mRb=null)}$Gb(wa){for(var kb of this.xl.UUd)if(kb.clientId===this.Ln.user.clientId&&!kb.equals(this.Ln.user)){this.xl.kba(this.Ln.user);break}kb=!1;Qh.upk===this.Ln.user.color?({value:kb}=this.PRg.Ab(this.Ln.user.clientId,!1),kb||(this.PRg.Z(this.Ln.user.clientId,!0),u.ULS.sendTraceTag(17954772,302,50,'{ "ClientID" : "'+this.Ln.user.clientId+'" , "Event" : "RenderGrayPawn"}'))):
({value:kb}=this.Mui.Ab(this.Ln.user.clientId,!1),kb||(this.Mui.Z(this.Ln.user.clientId,!0),u.ULS.sendTraceTag(17954773,302,50,'{ "ClientID" : "'+this.Ln.user.clientId+'" , "Event" : "RenderColoredPawn"}')));return wa||this.Ln.nNa||2===this.Nla?(this.A1h(),this.xl.uWc(),this.Ln.nNa=!1,this.Ln.b9=!0,this.Nla=2,Qh.yDn):this.Ln.b9&&1!==this.Nla?0:(this.A1h(),this.xl.Bac(),this.Ln.b9=!0,this.Nla=1,Qh.xDn)}YZd(wa=null){this.nrk();const kb=this.$Gb(!!wa);this.PYa&&wa&&wa.eventName===Je.a.pointerOver||this.$7m(kb)}xO(){this.xl&&
this.Nla&&(this.j2m(),this.xl.hide(),this.Nla=0)}$7m(wa){this.mRb=new Ea.a(2,1,wa,()=>{this.mRb=null;this.xO()},56);pb.a.instance.ub(this.mRb)}updatePosition(wa){if(this.element&&this.element.parentNode){var kb=this.Swh(wa);if(kb){wa=Sys.UI.DomElement.getBounds(this.element.parentNode);kb=new Sys.UI.Bounds(kb.x-wa.x,kb.y-wa.y,Qh.nPh,kb.height);var Pb;({left:wa,top:kb,height:Pb}=this.vbl(kb,wa,this.element.parentNode,this.hg.instance));this.element.style.height=2*Qh.h7b+Pb+"px";this.element.style.top=
kb-Qh.h7b+"px";this.element.style.left=wa-Qh.h7b+"px";this.hQa.style.height=Math.max(Qh.B5h,Pb)+"px";this.YZd()}}}DC(){this.element&&(Se.a.Zs(this.element),this.aXd())}h5g(wa,kb,Pb,Hb,bd){const nc=new qf;if(!Hb||!Pb)return nc;Hb=this.Swh(wa);if(!Hb)return nc;var Qe=Pb;Pb=wa;if(wa.Fi){var ye=wa.kb;Qe=wa.Nf.LEc(this.Ln.ip.U4.cp);0>Qe&&0==Qe;wa.kb.Vqa?Se.a.YJa(ye.editingElement,wa.Nf.rh.J(Qe))||(Pb=wa.source.kj(yk.InteractiveViewManager.instance.rc.gb),kb=Pb.Nf.rh.J(Qe)):kb=Pb.Nf.rh.J(Qe);Qe=kb.getBoundingClientRect()}Qe=
new Sys.UI.Bounds(Hb.x-Qe.x,Hb.y-Qe.y,Qh.nPh,Hb.height);wa=Qe.y;Hb=Qe.x;Qe=Qe.height;ye=this.hg.instance;bd&&ye&&(bd=ye.ei,wa=Math.round(wa/bd),Hb=Math.round(Hb/bd),Qe=Math.round(Qe/bd));nc.top=wa-Qh.h7b;nc.left=Hb-Qh.h7b;nc.height=2*Qh.h7b+Qe;nc.kPh=Math.max(Qh.B5h,Qe);nc.$_a=!0;nc.gg=kb;nc.kz=Pb;return nc}psi(wa,kb,Pb,Hb){fg.P0h();this.J7c=wa;wa=Pb.gg;kb=Pb.kz;if(Hb){const bd=!this.element;bd&&this.ATe(wa.ownerDocument);bd||!this.element.parentNode?wa.appendChild(this.element):this.element.parentNode!==
wa&&(this.element.parentNode.removeChild(this.element),wa.appendChild(this.element));this.J7c=kb;wa=this.Ln.user.color;this.hQa.style.borderColor=wa;this.PYa||(this.zrc.style.borderColor=wa);this.element.id=fg.cab(this.Ln);Pb.$_a&&(this.element.style.height=Pb.height+"px",this.element.style.top=Pb.top+"px",this.element.style.left=Pb.left+"px",this.hQa.style.height=Pb.kPh+"px",this.YZd())}this.GLc=!Hb;this.aXd()}dispose(){this.element&&(this.DC(),this.xq.xb(Je.a.pointerOver,this.element,Object(f.a)(this,
this.sV,"onPointerOver")),this.PYa&&(this.xq.xb(Je.a.pointerOut,this.element,Object(f.a)(this,this.HM,"onPointerOut")),this.xq.xb(Je.a.pointerDown,this.element,Object(f.a)(this,this.rSd,"onTooltipTouch"))),Af.a.pz(this.xl),this.element=this.xl=null);super.dispose()}TTi(wa){const kb=this.Ln.user.color;this.hQa.style.borderColor=kb;this.PYa||(this.zrc.style.borderColor=kb);this.element.id=fg.cab(this.Ln);this.updatePosition(wa)}vbl(wa,kb,Pb,Hb){let bd=wa.y,nc=wa.x;wa=wa.height;(1<Math.abs(kb.width-
Pb.offsetWidth)||1<Math.abs(kb.height-Pb.offsetHeight))&&Hb&&(bd=Math.round(bd/Hb.ei),nc=Math.round(nc/Hb.ei),wa=Math.round(wa/Hb.ei));return{left:nc,top:bd,height:wa}}Swh(wa){const kb=this.Ln.ip;if(!kb)return null;let Pb;try{const Hb=kb.U4.cp;Pb=Xl.a.XW(Hb,wa,0<Hb,!1,!1,!1)}catch(Hb){u.ULS.sendTraceTag(4301318,302,50,"Could not determine the bounds of IP: isYielding={0} message={1} stack={2}",pb.a.instance.Kv,Hb.message,Hb.stack),Pb=null}return Pb}}Qh.dAm="WacPawn";Qh.nPh=2;Qh.xDn=7E3;Qh.yDn=2E3;
Qh.h7b=5;Qh.jEm="presenceIp";Qh.mEm="PresenceSmallBox";Qh.B5h=10;Qh.upk="0xcccccc";Object(k.a)(Qh,"PresenceIpControl",fg,[]);class rk{constructor(wa,kb,Pb,Hb,bd=null,nc=null,Qe=null){this.ehc={};this.chc={};this.Xbg={};this.qsc=wa;this.xq=kb;this.Lj=Pb;this.JDa=Hb;this.YT=bd;this.qa=nc;this.KA=Qe}get cok(){return this.ehc}get uah(){return this.chc}rbl(wa){const kb=!!this.qa&&this.qa.$("PeoplesWellExtraButtonInfoIsEnabled");return wa.ip.shapeId&&kb?this.wbl(wa):this.xbl(wa)}wbl(wa){const kb=wa.ip.shapeId.toString();
this.Xbg[wa.user.clientId]=kb;const Pb=this.chc[kb];return Pb?(Pb.Ln=wa,{returnValue:Pb,P7d:!0}):{returnValue:this.chc[kb]=new ui(wa,this.qsc,this.xq,this.Lj,this.JDa,this.YT,this.qa),P7d:!1}}xbl(wa){const kb=wa.user.clientId,Pb=this.ehc[kb];return Pb&&Pb.Ln.user.equals(wa.user)?(Pb.Ln=wa,{returnValue:Pb,P7d:!0}):{returnValue:this.ehc[kb]=new Qh(wa,this.qsc,this.xq,this.Lj,this.JDa,this.YT,this.qa,this.KA),P7d:!1}}Twh(wa){return this.ehc[wa]}k3k(wa){return(wa=this.chc[this.Xbg[wa]])&&!wa.R7d()?wa:
null}fwk(){var wa=this.ehc;for(const kb in wa)wa[kb].dispose();wa=this.chc;for(const kb in wa)wa[kb].dispose()}}Object(k.a)(rk,"PresenceControlProvider",null,[]);var yf=b(161);class Cl{constructor(){this.O5a=0}Jyh(){this.O5a++;this.O5a===Number.MAX_VALUE&&(this.O5a=1);return this.O5a}static get instance(){return Cl.Aoc}}Cl.Aoc=new Cl;Object(k.a)(Cl,"PacketIdGenerator",null,[162]);var bn=b(966);class Yl{constructor(wa,kb,Pb){this.n8m=wa;this.Yxl=kb;this.nZh=Pb}}Object(k.a)(Yl,"SuccessfulInboundReplicationCallbackData",
null,[]);class rj{constructor(wa,kb,Pb,Hb,bd,nc,Qe){this.M5m=wa;this.bke=kb;this.Mi=Pb;this.Jxj=bd;this.Scj=nc;this.lOb=Hb;this.xo=Qe;this.M5m.j3(Object(f.a)(this,this.U5m,"rtcOnUpdateNotificationReceived"))}U5m(wa,kb){kb.type||(wa=this.Mi.sgh>=this.Scj,this.Jxj&&wa?(wa=this.bke())?wa.fih():u.ULS.sendTraceTag(19682513,500,15,"ActivePage ContentReplicator was null, we are abandoning the inbound attempt."):this.mC())}mC(){const wa=this.bke();if(!wa)u.ULS.sendTraceTag(19682514,500,15,"ActivePage ContentReplicator was null, we are abandoning the inbound attempt.");
else if(!this.lOb()&&wa.OKa){let kb=-1;Object(bi.a)(bn.a,wa)&&(kb=wa.Hi.CBa());const Pb=this.xo.Pe("Task","ShoulderTapInboundReplicationTimer");wa.mC(Object(f.a)(this,this.ptm,"onSuccessfulReplication"),null,new Yl(kb,Pb,wa.Ss))}}ptm(wa){if(wa=Object(r.a)(Yl,wa)){var kb=wa.Yxl.Yg.toString(),Pb=this.bke(),Hb=Pb.Ss,bd="";Hb!==wa.nZh&&(u.ULS.sendTraceTag(19964236,500,50,"Time saved due to force inbound on update notification message = {0} ms",wa.n8m.toString()),bd=this.g8k(Pb,Hb,wa.nZh));u.ULS.sendTraceTag(19964237,
500,50,"Revisions: {0}, InboundDuration: {1}",bd,kb)}else u.ULS.sendTraceTag(19964235,500,10,"The callback data was null")}g8k(wa,kb,Pb){const Hb=new Sys.StringBuilder;wa=wa.node.Lc.store.getRevision(kb);if(!wa)return u.ULS.sendTraceTag(19964238,500,10,"The revision we got from the last replicator revisionId was null - {0}",{["lastRevisionId"]:kb}),"";for(Hb.append(wa.id.guid);kb!==Pb;){Hb.append(", ");Hb.append(kb.guid);wa=wa.Zl;if(!wa)break;kb=wa.id}return Hb.toString()}}Object(k.a)(rj,"ContentNotificationManager",
null,[]);class Ci extends rj{constructor(wa,kb,Pb,Hb,bd,nc,Qe){super(wa,kb,Pb,Hb,bd,nc,Qe)}static get NMa(){return Ci.F6a||(Ci.F6a=la.a.instance.resolve("Box4.Presence.IRtcProxyProvider"))}static init(){if(Ka.App.oa){var wa=Ka.App.oa.Da;wa&&(wa.lba(Ci.jOc),wa=wa.Zb)&&(Ci.su=wa.contentReplicator,Ci.su&&Ka.App.Zia().continueWith(Ci.Yxf))}}static Yxf(){Ci.P2c=Ka.App.Zia().result;Ci.P2c&&Ci.P2c.$n&&Ci.NMa.NG().continueWith(Ci.SOc)}static SOc(){Ci.$h=Ci.NMa.NG().result;if(Ci.$h){var wa=m.AFrameworkApplication.K,
kb=wa.$("Box4ThrottleInboundRequests");wa=wa.vb("Box4ThrottleInboundsAtUserCount",20);Ci.su.WBd=()=>Ci.$h.Xdb;Ci.M2c=Ci.M2c||new Ci(Ci.$h,()=>Ci.su,Ci.P2c,()=>m.AFrameworkApplication.Qj,kb,wa,Ka.App.oa.Qo);Ci.M2c.mC()}}static jOc(wa){Ci.M2c||(wa.ogb(Ci.jOc),Ci.init())}}Ci.M2c=null;Ci.F6a=null;Ci.$h=null;Ci.su=null;Ci.P2c=null;Object(k.a)(Ci,"WordContentNotificationManager",rj,[]);class wj{constructor(wa,kb,Pb,Hb,bd,nc){this.I3c=null;this.JAg=wa;this.oc=Pb;this.vFa=Hb;this.iu=bd;this.Rf=nc;this.sJb=
kb}clone(){return new wj(this.JAg,this.sJb.clone(),this.oc,this.vFa,this.iu,this.Rf)}get cp(){if(null!=this.I3c)return this.I3c;var wa=this.JAg.paragraphId;if(wa.equals(Pc.a.nil))return 0;var kb=this.vFa();if(!kb)return 0;wa=kb.Ra(wa);if(!wa)return u.ULS.sendTraceTag(7685326,302,15,"Paragraph Node is null so returning a CP with value 0"),0;kb=this.oc.Wtb(this.oc.PLa(wa.characterData,wa.la),this.sJb);if(this.iu&&this.Rf&&wa.vw){const Pb=Lc.a.Sb(wa,kb);Pb.Qa=this.Rf.j9e(wa,kb,this.sJb.bxa);kb=this.iu.Lba(Pb,
!0)}return kb}Yzf(){null==this.I3c&&(this.I3c=this.cp)}equals(wa){return wa?this.sJb.isEqual(wa.sJb,!1):!1}}Object(k.a)(wj,"WordPresenceCp",null,[179,62,180]);class Fj{constructor(wa,kb){this.iu=wa;this.Rf=kb}create(wa,kb,Pb,Hb){return new wj(wa,kb,Pb,Hb,this.iu,this.Rf)}}Object(k.a)(Fj,"Factory",null,[161]);var sk=b(484);class xn extends Sys.EventArgs{constructor(wa,kb,Pb){super();this.paragraphId=wa;this.presence=kb;this.ohf=Pb}}Object(k.a)(xn,"ParagraphChangedEventArg",Sys.EventArgs,[]);class yn{constructor(wa){this.cp=
wa}equals(wa){return wa?this.cp===wa.cp:!1}clone(){return new yn(this.cp)}}Object(k.a)(yn,"PresenceCp",null,[179,62]);class yh{constructor(wa,kb,Pb,Hb,bd){this.paragraphId=wa;this.cp=kb;this.length=Pb;this.shapeId=Hb;this.dryDeletion=bd}}Object(k.a)(yh,"SerializablePresenceIpData",null,[]);class Sm{constructor(wa,kb,Pb,Hb=0,bd=0){this.Jna=null;wa&&(this.Jna=Pc.a.Ee(wa));this.IAg=new yn(kb);this.dBa=Pb;this.rFg=Hb;this.ugg=bd}get paragraphId(){return this.Jna}get U4(){return this.IAg}get shapeId(){return this.rFg}get dryDeletion(){return this.ugg}Nc(){return 0<=
this.U4.cp&&!!this.paragraphId&&!this.paragraphId.equals(Pc.a.nil)}getData(){return new yh(this.paragraphId.toString(),this.U4.cp,this.dBa,this.shapeId,this.dryDeletion)}clone(){const wa=new Sm;wa.Jna=this.paragraphId;wa.IAg=this.U4?this.U4.clone():null;wa.dBa=this.dBa;wa.rFg=this.shapeId;wa.ugg=this.dryDeletion;return wa}static $tb(wa){return wa.paragraphId&&void 0!==wa.cp&&null!==wa.cp&&void 0!==wa.length&&null!==wa.length?new Sm(wa.paragraphId,wa.cp,wa.length,void 0,wa.dryDeletion):null}}Object(k.a)(Sm,
"PresenceIp",null,[155,62]);class vi{constructor(wa,kb){this.ip=wa;this.user=kb}}Object(k.a)(vi,"SerializablePresenceData",null,[]);class aj{constructor(wa,kb){this.nNa=this.b9=this.l5b=!1;this.gQa=kb;this.user=wa}get ip(){return this.gQa}Q$e(){return new vi(this.ip?this.ip.getData():null,this.user.getData())}Hvh(){return this.user.clientId+(this.gQa?this.gQa.paragraphId.toString():Pc.a.nil.toString())}Nc(){const wa=!!this.user&&this.user.Nc(),kb=!this.ip||this.ip.Nc();return wa&&kb}clone(){const wa=
new aj;wa.user=this.user?this.user.clone():null;wa.gQa=this.gQa?this.gQa.clone():null;wa.b9=this.b9;wa.l5b=this.l5b;wa.nNa=this.nNa;return wa}static $tb(wa){return wa?new aj(ta.$tb(wa.user),wa.ip?Sm.$tb(wa.ip):null):null}}Object(k.a)(aj,"PresenceInfo",null,[167,62]);class bg extends Ga.a{constructor(){super();this.Loc={};this.KOa={};this.Jig=!1}get Qxm(){return this.Loc}get EUh(){return!!m.AFrameworkApplication.K&&m.AFrameworkApplication.K.$("PeoplesWellExtraButtonInfoIsEnabled")}sQg(wa){this.addHandler("PPC",
wa)}csi(wa){this.removeHandler("PPC",wa)}q_b(wa){return wa.ip.paragraphId.toString()}OHe(wa,kb=!1){this.Jig||(this.Jig=!0,u.ULS.sendTraceTag(4289312,302,50,"First presence added to data manager"));var Pb=({kEm:Hb}=this.uUl(wa)).returnValue;if(Hb&&!kb)(Pb=this.KOa[wa.user.clientId])&&0<=Pb.length&&(Pb[Pb.length-1].ip.dBa=wa.ip.dBa);else{Pb||this.Tqi(wa.user.clientId);this.EUh&&Pb&&this.BOn(wa);kb=this.q_b(wa);var Hb=wa.user.clientId;var bd=this.Loc[kb]||[],nc=this.KOa[Hb]||[];nc.length>=bg.u4h&&(nc=
nc.splice(-bg.Wim,bg.u4h));Pb||bd.push(Hb);nc.push(wa);this.Loc[kb]=bd;this.KOa[Hb]=nc;wa.ip.paragraphId.equals(Pc.a.nil)||this.IHf(wa.ip.paragraphId,wa,!0)}}uUl(wa){var kb=this.KOa[wa.user.clientId];const Pb=!kb||0>=kb.length?null:kb[kb.length-1],Hb=!!Pb&&this.q_b(Pb)===this.q_b(wa);kb=Hb&&Pb.ip.U4.equals(wa.ip.U4)&&Pb.user.equals(wa.user);this.EUh&&kb&&Pb.ip.shapeId&&wa.ip.shapeId&&Pb.ip.shapeId!==wa.ip.shapeId&&(kb=!1);return{returnValue:Hb,kEm:kb}}BOn(wa){const kb=this.mok(wa);kb&&kb.ip.shapeId&&
(wa.ip.shapeId&&wa.ip.shapeId===kb.ip.shapeId||this.IHf(kb.ip.paragraphId,kb,!1))}mok(wa){wa=this.KOa[wa.user.clientId];return!wa||0>=wa.length?null:wa[wa.length-1]}Tqi(wa){const kb=this.KOa[wa];if(kb&&0<kb.length){const Pb=kb[0].ip.paragraphId,Hb=this.q_b(kb[0]);delete this.KOa[wa];this.GWm(Hb,wa);Pb.equals(Pc.a.nil)||this.IHf(Pb,kb[0],!1)}}O5e(wa){return this.Loc[wa]}BCc(wa,kb,Pb,Hb=!1){const bd=[],nc=this.O5e(wa);if(!nc)return bd;for(let Qe=0;Qe<nc.length;Qe++){const ye=nc[Qe],lf=this.KOa[ye];
let rh=!1;for(let Eg=lf.length-1;0<=Eg;Eg--){const Qf=lf[Eg];if(Hb){if(Qf.b9&&Qf.ip.paragraphId.equals(Pc.a.Ee(wa))){rh=!0;bd.push(Qf);break}}else if(Object(bi.a)(aj,Qf)?Qf.ip.dBa===kb:Qf.ip.dBa===Pb){rh=!0;Qf.l5b=!0;bd.push(Qf);this.KOa[ye]=lf.splice(Eg,lf.length);break}}!rh&&0<lf.length&&lf[0].l5b&&lf[0].ip.paragraphId.equals(Pc.a.Ee(wa))&&bd.push(lf[0])}return bd}pRk(wa){if(!wa||!wa.sa||!wa.sa.node)return null;wa=this.BCc(wa.sa.node.id.toString(),0,0,!0);wa=this.$kl(wa);wa.sort((kb,Pb)=>{if(!(kb&&
kb.userName&&Pb&&Pb.userName))return u.ULS.sendTraceTag(542165082,302,15,"Missing presence user info for user in PresenceInfos"),0});return wa}$kl(wa){if(!wa||!wa.length)return[];const kb=[],Pb=new sk.a(Ma.a.yi());for(let Hb=0;Hb<wa.length;Hb++){const bd=wa[Hb].user;bd.isAnonymous&&Pb.contains(bd.clientId)||!bd.isAnonymous&&bd.email&&Pb.contains(bd.email)||(kb.push(bd),Pb.add(bd.isAnonymous?bd.clientId:bd.email))}return kb}IHf(wa,kb,Pb){this.raiseEvent("PPC",new xn(wa,kb,Pb))}GWm(wa,kb){Array.remove(this.Loc[wa],
kb)}}bg.u4h=10;bg.Wim=2;Object(k.a)(bg,"PresenceDataManager",Ga.a,[1119]);class zh extends bg{constructor(wa,kb){super();this.Dwe=this.exg=!1;this.Ly=wa;this.Na=kb}OHe(wa,kb=!1){this.Na.isFeatureEnabled(194)&&this.Na.isFeatureEnabled(162)&&Object(bi.a)(aj,wa)?this.exg||(this.exg=!0,u.ULS.sendTraceTag(7866380,302,15,"Presence packet received in old format")):(Object(bi.a)(aj,wa)&&(this.Dwe=!0),super.OHe(wa,kb))}q_b(wa){return this.Dwe?super.q_b(wa):wa.ip.Ib.toString()}O5e(wa){if(this.Dwe)return super.O5e(wa);
wa=this.Ly.Ra(Pc.a.Ee(wa));if(!wa)return null;wa=wa.ia(Jg.a.Ib,0);return this.Qxm[wa.toString()]}}Object(k.a)(zh,"WordPresenceDataManager",bg,[]);var Gi=b(1284),gh=b(1198),Zi=b(1686),sm=b(19);class cf{constructor(wa,kb,Pb,Hb,bd,nc,Qe,ye,lf,rh,Eg,Qf,jg,Ng,ci,bj,Xk,Bk,he,mj,Jk,um,wg,Jh){this.BGa=Array(5);this.$Ee=this._started=this.aAe=!1;this.Bwe=null;this.gBg=new sk.a(Ma.a.yi());this.Kcd={};this.Joe=!1;this.qu=wa;this.ya=Hb;this.KA=bd;this.kpb=nc;this.Gj=lf;this.Pcj=rh;this.c6a=Eg;this.yA=Pb;this.Gkg=
Qf;this.Tje=jg;this.Uje=Ng;this.z6i=Qe;this.Tcj=ye;this.pFa=ci;this.Wm=bj;this.Fb=Xk;this.Ta=Bk;this.EIg=um;this.Rrj=Jh;this.Cwe=mj;this.qa=Jk;this.rcd=kb;cf.tdd=new cb.a;for(wa=0;wa<this.rcd.length;wa++)this.rcd[wa].mTm(this);this.kpb.sQg(Object(f.a)(this,this.eji,"presenceOnParagraphChanged"));this.qu.SSa(Object(f.a)(this,this.$0,"onPresenceUpdated"));wg&&this.Gj.aha(Object(f.a)(this,this.Axm,"pageViewScrolled"));this.qu.FXd(this)}get cQd(){return!!this.qa&&this.qa.$("PeoplesWellExtraButtonInfoIsEnabled")}Axm(){if(!this.$Ee&&
!this.Gj.lr){var wa=new Ea.a(0,1,20,()=>{const kb=new M.a;var Pb=this.c6a.cok;for(var Hb in Pb){const bd=Pb[Hb];bd.GLc&&kb.add(bd.Ln.ip.paragraphId)}if(this.cQd){Pb=this.c6a.uah;for(const bd in Pb)Hb=Pb[bd],Hb.GLc&&!kb.contains(Hb.Ln.ip.paragraphId)&&kb.add(Hb.Ln.ip.paragraphId)}this.cqh(kb);this.$Ee=!1},72);this.Ta.ub(wa);this.$Ee=!0}}Fai(){this.aAe&&(this.yOf(),this.aAe=!1)}rYd(wa=!1){this.EIg&&!wa||this.ksi()}ksi(){const wa=new M.a,kb=this.Kcd;for(const Pb in kb)wa.add(Pc.a.Ee(Pb));this.cqh(wa);
this.Kcd={}}yOf(){this.ya.Ca&&this.vzi(this.ya.Ca.Fa,!0)}b1(wa,kb){this.vzi(kb.rk.Fa)}vzi(wa,kb=!1){this.Rrj||(this.yA.sm.qra||kb?wa?(kb=this.Skk(wa))?this.qu.EOf(kb):(this.qu.EOf(null),u.ULS.sendTraceTag(4281418,302,50,"Not supported selection context {0}",wa.sa.contextId)):this.qu.EOf(null):this.aAe=!0)}Skk(wa){if(!this.cQd||!wa.pdb)if(wa=sm.SelectionEditor.Ri(wa,!0,!1),!sm.SelectionEditor.Cl(wa))return null;return this.CNe(wa)}CNe(wa){const kb=wa.sa.cpBegin,Pb=wa.sa.node.id;wa=this.Tje(wa.sa.node);
return new Sm(Pb.toString(),kb,wa)}$0(wa,kb){wa=kb.XCa;for(var Pb in wa){const Hb=wa[Pb];this.qa.$("CashTelemetryIsEnabled")&&this.IAc(Hb,new Date,null);Hb.ip?this.IHe(Hb):this.SSc(Hb.user.clientId)}kb=kb.Ktd;for(Pb=0;Pb<kb.length;++Pb)this.Zrk(kb[Pb]);this.rYd()}IAc(wa,kb,Pb){if(this.Cwe)if(wa&&wa.user&&wa.user.clientId){var Hb=wa.user.clientId;this.gBg.contains(Hb)||(this.Bwe?(this.Bwe.IAc(Hb,kb,null,cf.$dl(Pb||wa.user.client)),this.gBg.add(Hb)):this.Cwe.continueWith(()=>{this.Bwe=this.Cwe.result;
this.IAc(wa,kb,Pb)}))}else u.ULS.sendTraceTag(42262876,302,15,"invalid presence")}tbl(wa){const kb=new M.a;for(let Pb=0;Pb<wa.length;Pb++)kb.add(this.Rkl(wa[Pb]));return kb}IHe(wa){var kb=null;wa&&wa.user&&(kb=wa.user.client);wa=wa.clone();wa.user=this.KA.q2h(wa.user.clientId)||wa.user;this.qa.$("CashTelemetryIsEnabled")&&this.IAc(wa,new Date,kb);wa.Nc()&&!wa.user.HR()&&(kb=wa.user.clientId,cf.tdd.Ja(kb)||this.nHh(kb),this.iQn(kb),wa.user.userName=CommonUIStrings.l_AnonymousUserName);this.kpb.OHe(wa,
!1)}iQn(wa){const {value:kb}=cf.tdd.Ab(wa,!1);kb||(cf.tdd.Z(wa,!0),u.ULS.sendTraceTag(17954774,302,50,'{ "ClientID" : "'+wa+'" , "Event" : "CreateAnonymousGrayPawn"}'))}nHh(){}SSc(wa){this.kpb.Tqi(wa)}Zrk(wa){this.SSc(wa);const kb=this.c6a.Twh(wa);kb&&(kb.xri(Object(f.a)(this,this.Zzf,"onPresenceRendered")),kb.dispose());this.cQd&&(wa=this.c6a.k3k(wa))&&(wa.xri(Object(f.a)(this,this.Zzf,"onPresenceRendered")),wa.dispose())}m_b(wa){if(12!==wa.type)return new M.a;wa=this.kpb.BCc(wa.id.toString(),this.Tje(wa),
this.Uje(wa));return 0>=wa.length?new M.a:this.tbl(wa)}Zzf(wa,kb){kb.paragraphId?this.vQn(kb.paragraphId.toString(),kb.yYl,this.Kcd):u.ULS.shipAssertTag(8758481,302,!1,"null paraid")}vQn(wa,kb,Pb){!kb&&wa in Pb&&delete Pb[wa]}dispose(){this.stop();this.kpb.csi(Object(f.a)(this,this.eji,"presenceOnParagraphChanged"));this.qu.UEb(Object(f.a)(this,this.$0,"onPresenceUpdated"));this.qu.q_f(this);for(let wa=0;wa<this.rcd.length;wa++)this.rcd[wa].JKn(this);Af.a.xNf([this.z6i,this.Tcj,this.qu]);this.c6a.fwk()}Rkl(wa){let kb=
!1;wa=({P7d:kb}=this.c6a.rbl(wa)).returnValue;kb||wa.nHj(Object(f.a)(this,this.Zzf,"onPresenceRendered"));return wa}wFh(wa){wa=this.yA.Ra(wa);if(!wa)return this.BGa[0]||(u.ULS.sendTraceTag(4281420,302,50,"Could not find the node in object space"),this.BGa[0]=!0),null;if(!lc.ParagraphReader.tb(wa))return this.BGa[1]||(u.ULS.sendTraceTag(4281421,302,50,"Not a paragraph node"),this.BGa[1]=!0),null;if(!wa.Sd(this.Gj.gb))return this.BGa[2]||(u.ULS.sendTraceTag(4281422,302,50,"No ViewElement found for this node"),
this.BGa[2]=!0),null;if(!wa.anchor)return this.BGa[3]||(u.ULS.sendTraceTag(4281423,302,50,"node is not anchored"),this.BGa[3]=!0),null;this.BGa[4]||(u.ULS.sendTraceTag(4564931,302,50,"Valid paragraph node found for rendering ip"),this.BGa[4]=!0);return wa}yqi(wa){wa=this.kpb.BCc(wa.toString(),-1,-1,!0);if(!Rj.a.ve(wa))for(const kb of wa)(wa=this.c6a.Twh(kb.user.clientId))&&wa.element&&wa.DC()}cqh(wa){if(wa.count){var kb=new M.a;for(var Pb of wa)(wa=this.wFh(Pb))?kb.add(wa):this.yqi(Pb);if(kb.count){Pb=
this.Fb.Ob(2);try{Pb.set(this.Wm);for(const Hb of kb)this.Jeh(Hb)}finally{Pb&&Pb.dispose()}}}}Jeh(wa){wa.lK(this.Gj.gb,32,!0);wa.lK(this.Pcj,32,!0)}f8m(wa){this.Kcd[wa.toString()]=null;this.EIg&&!this.Joe&&(wa=new Ea.a(0,1,200,()=>{this.Joe=!1;this.ksi()},70),this.Ta.ub(wa),this.Joe=!0)}eji(wa,kb){kb.paragraphId&&(wa=this.yA.Ra(kb.paragraphId))&&((Object(bi.a)(aj,kb.presence)?this.Tje(wa):this.Uje(wa))===kb.presence.ip.dBa&&this.f8m(kb.paragraphId),this.cQd&&this.lEm(kb))}lEm(wa){if(wa.presence.ip.shapeId&&
!wa.ohf){var kb=this.c6a.uah[wa.presence.ip.shapeId.toString()];kb&&kb.d_a(wa.presence.user.clientId)}}stop(){this._started&&(this._started=!1,this.ya.fea(Object(f.a)(this,this.b1,"onSetSelectionFinished")),this.Gkg.Wri(Object(f.a)(this,this.Fai,"onGraphOutboundReplication")))}start(){if(!this._started){this._started=!0;this.ya.aC(Object(f.a)(this,this.b1,"onSetSelectionFinished"));this.Gkg.gQg(Object(f.a)(this,this.Fai,"onGraphOutboundReplication"));var wa=this.qu.vwb();delete wa[this.pFa.clientId];
this.$0(null,new Zi.a(wa,[]));this.yOf()}}p2d(wa){if(wa&&wa.Nc()&&wa.ip){var kb=this.kpb.BCc(wa.ip.paragraphId.toString(),-1,-1),Pb=!1,Hb=null;for(let bd=0;bd<kb.length;bd++)if(Hb=kb[bd],Hb.user.clientId===wa.user.clientId){Pb=Hb.nNa=!0;break}if(Pb)if(kb=Hb.ip.paragraphId,wa=this.wFh(kb)){kb=this.Fb.Ob(2);try{kb.Oa(wa),this.Jeh(wa)}finally{kb&&kb.dispose()}}else this.yqi(kb)}}static $dl(wa){return wa?wa?1===wa?1:2===wa?2:0:2:0}}cf.tdd=null;Object(k.a)(cf,"PresenceManager",null,[1115,14,128,1116,1117,
1118]);class Pk{constructor(wa,kb,Pb,Hb){this.yLb=null;this._started=this.ene=!1;this.mrb=null;this.$h=Hb;this.ya=kb;this.Lfe=wa;this.yj=Pb;this.$h.FXd(this)}start(){this._started||(this._started=!0,this.mrb={},this.Lfe.sQg(Object(f.a)(this,this.ici,"onPresenceOnParagraphChanged")),this.ya.aC(Object(f.a)(this,this.oka,"onProcessSetSelectionFinished")),this.MUi(this.ya.Ca))}stop(){this._started&&(this._started=!1,this.mrb=null,this.Lfe.csi(Object(f.a)(this,this.ici,"onPresenceOnParagraphChanged")),
this.ya.fea(Object(f.a)(this,this.oka,"onProcessSetSelectionFinished")))}oka(wa,kb){if(!m.AFrameworkApplication.Qj&&(wa=this.MUi(kb.rk),this.yLb&&wa)){wa=this.Lfe.BCc(this.yLb.toString(),-1,-1,!0);for(kb=0;kb<wa.length;kb++)this.mrb[wa[kb].user.clientId]=wa[kb];0>=wa.length||(wa=this.Fhk(wa),this.yj.sendNotification(wa,!0))}}Fhk(wa){if(1===wa.length)return String.format(Box4Intl.Box4Strings.l_OtherUsersEditingParagraphSingle,wa[0].user.userName);const kb=[],Pb=wa.length;for(let Hb=0;Hb<Pb;Hb++)kb.push(wa[Hb].user.userName);
return String.format(Box4Intl.Box4Strings.l_OtherUsersEditingParagraphMany,kb.join(Box4Intl.Box4Strings.l_DisplayNameSeparator))}ici(wa,kb){this.ya.Ca&&!m.AFrameworkApplication.Qj&&this.ene&&this.yLb&&this.yLb.equals(kb.paragraphId)&&(wa=null,!kb.ohf||kb.presence.user.clientId in this.mrb?kb.ohf||(wa=this.a$g(kb.presence.user.userName,!1),delete this.mrb[kb.presence.user.clientId]):(wa=this.a$g(kb.presence.user.userName,!0),this.mrb[kb.presence.user.clientId]=kb.presence),wa&&this.yj.sendNotification(wa,
!0))}a$g(wa,kb){return String.format(kb?Box4Intl.Box4Strings.l_UserJoiningParagraph:Box4Intl.Box4Strings.l_UserLeavingParagraph,wa)}dispose(){this.$h.q_f(this);this.stop()}MUi(wa){if(!wa)return!1;wa=wa.Fa;if(!wa)return!1;wa=wa.sa;if(!wa)return!1;this.ene=sm.SelectionEditor.ke(wa);wa=wa.node.id;if(wa.equals(this.yLb)||!this.ene)return!1;this.yLb=wa;this.mrb={};return!0}}Object(k.a)(Pk,"PresenceAccessibilityManager",null,[14,128]);class Id{constructor(wa,kb){this._started=!1;this.FH=null;this.U8c=!1;
this.$h=wa;kb&&(this.FH=kb,this.FH.PSa(Object(f.a)(this,this.xOc,"onEditorsTableUpdated")));this.$h.FXd(this)}start(){this._started||(this._started=!0,this.FH?this.hzi():this.$h.MM(1,this.P8g()))}xOc(){this._started&&this.hzi()}hzi(){const wa=this.U8c;(this.U8c=!!this.FH.lx)&&!wa&&this.$h.MM(1,this.P8g())}P8g(){const wa={};wa.Id="{"+m.AFrameworkApplication.userSessionId.toUpperCase()+"}";wa.HQ=!1;wa.NT=1;wa.WEB=!0;return wa}stop(){this._started&&(this._started=this.U8c=!1)}dispose(){this.$h.q_f(this);
this.FH&&this.FH.zri(Object(f.a)(this,this.xOc,"onEditorsTableUpdated"))}}Object(k.a)(Id,"EditorsTableNotifier",null,[14,128]);var rd=b(371),ge=b(20);class Me extends cf{constructor(wa,kb,Pb,Hb,bd,nc,Qe,ye,lf,rh,Eg,Qf,jg,Ng,ci,bj,Xk,Bk,he,mj,Jk,um,wg,Jh,Sf,Kh,Kd,dd,Gc,sd){super(wa,kb,Pb,Hb,bd,nc,Qe,ye,lf,rh,Eg,jg,Ng,ci,bj,he,mj,Jk,um,wg,Jh,Sf,Kh,Gc);this.Mi=null;Qf.Aa(ge.a.esn,ec.a.application,Me.WEj,64);Qf.Aa(ge.a.jKf,ec.a.application,Me.jKf,64);Qf.Aa(ge.a.gHf,ec.a.application,Me.gHf,96);Qf.Aa(vb.a.p2d,
ec.a.application,Me.dsn,64);this.kG=Xk;this.oc=Bk;this.xrb=Kd;this.pFa.T7b=dd;this.pFa.T7b.nJj(Me.jci);sd.continueWith(()=>{this.Mi=sd.result});u.ULS.sendTraceTag(4006600,302,50,"WordPresenceManager Initialized")}get Ua(){return la.a.instance.resolve("Box4.IFeatureHelper")}Gya(wa){if(!wa||!wa.anchor)return null;for(wa=wa.anchor.gr;wa;wa=wa.iA)if(wa.Pza)return wa.Iq.node;return null}CNe(wa){var kb=null;kb=m.AFrameworkApplication.K.$("PeoplesWellExtraButtonInfoIsEnabled");if(this.Ua.isFeatureEnabled(194)&&
this.Ua.isFeatureEnabled(162)){var Pb=wa.sa.cpBegin,Hb=wa.sa.node;kb&&rf.ImageReader.ix(Hb)&&(Hb=this.Gya(Hb));if(!Hb)return u.ULS.sendTraceTag(51242309,302,15,"selectedNode is null"),null;Hb=this.Uje(Hb);const nc=wa.sa.node.ia(Jg.a.Ib,0);if(!this.kG)return u.ULS.sendTraceTag(35997152,302,15,"paragraphWordIdMapping is null"),null;var bd=this.kG.value.Uab(nc);const Qe=Me.Ly.Ra(bd);if(!Qe)return u.ULS.sendTraceTag(16791249,302,15,"Can't find pid "+bd),null;Pb=this.oc.Qdc(this.oc.PLa(Qe.characterData,
Qe.la),Pb);Pb.bxa=-1===wa.sa.Qa?0:wa.sa.Qa;bd=0;kb&&wa.pdb&&(bd=this.Lfl(wa));kb=new He(this.kG.value,nc,Hb,Pb,this.oc,()=>Me.Ly,this.xrb,bd)}else kb=super.CNe(wa);return kb}Lfl(wa){const kb=rf.ImageReader.bJa(wa.sa);return kb?kb.properties.ia(Jg.a.rvb,0):wa.sa.node.properties.ia(Jg.a.rvb,0)}nHh(wa){this.Mi&&this.Mi.cia&&this.Mi.cia.mC(Object(f.a)(this,this.vzk,"editorsReplicatorSucceededCallback"),Object(f.a)(this,this.uzk,"editorsReplicatorFailedCallback"),wa)}vzk(wa){const kb=!!this.Mi.wz.uZb(wa);
u.ULS.sendTraceTag(579179741,302,50,"ClientId:{0} isPresentAfterPoll:{1}",wa,kb)}uzk(wa,kb){u.ULS.sendTraceTag(579179742,302,15,"EditorsReplicator failed with {0} when looking for ClientId {1}",kb,wa)}static get Xu(){return la.a.instance.resolve("Common.Utils.IAriaNotifier")}static NG(){return Me.Nkc.task}static get_instance(){return Me.sdd.task}static ybl(){return Me.KAg.task}static get NMa(){return Me.F6a||(Me.F6a=la.a.instance.resolve("Box4.Presence.IRtcProxyProvider"))}static init(){Me.sdd||(Me.sdd=
new w.a);Me.Wig&&(u.ULS.sendTraceTag(4256585,302,50,"WordPresenceManager Init"),Me.Wig=!1);if(Ka.App.oa){var wa=Ka.App.oa.Da;wa?(wa.lba(Me.jOc),Me.Tob=wa.Jb,Me.Tob&&Me.Tob.Rh?(Me.wL=wa.Zb.contentReplicator,Me.wL?(Me.Ly=wa.Zb.Lc,Me.Ly?Me.NMa.NG().continueWith(Me.ism):u.ULS.sendTraceTag(4006599,302,15,"Can't initialize the WordPresenceManager because we can't get a reference to content ObjectSpace of the app")):u.ULS.sendTraceTag(4252228,302,15,"Can't initialize the WordPresenceManager because we can't get a reference to the GraphSpaceReplicator object")):
u.ULS.sendTraceTag(4006598,302,50,"PageView doesn't seem to have been initialized yet. Will try again once we know it's initialized")):u.ULS.sendTraceTag(4006597,302,15,"Can't initialize the WordPresenceManager because workspace is not initialized")}else u.ULS.sendTraceTag(4006596,302,15,"Can't initialize the WordPresenceManager because active AppFrame is not initialized")}static ism(){Me.$h=Me.NMa.NG().result;if(Me.$h){var wa=[Me.Tob.iPc,Me.Tob.editingView.iPc],kb=xb.a.instance,Pb=la.a.instance.resolve("Box4.Presence.WordPresenceDataManager"),
Hb=new Pk(Pb,kb,Me.Xu,Me.$h),bd=m.AFrameworkApplication.K.$("DoNotAddToEditorsTableOnFrameIsEnabled")?Ka.App.lc.wz:null;bd=new Id(Me.$h,bd);var nc=la.a.instance.te("WordEditor.IParagraphWordIdMapping"),Qe=la.a.instance.resolve("WordEditor.WordTextOffsetTranslator.IWordTextOffsetTranslator"),ye=la.a.instance.resolve("Common.IPeopleInfoProvider");Me._instance=new Me(Me.$h,wa,Me.Ly,kb,ye,Pb,Hb,bd,Me.Tob,Me.Tob.editingView.gb,la.a.instance.resolve("Box4.Presence.PresenceControlProvider"),m.AFrameworkApplication.pa,
Me.wL,lc.ParagraphReader.textLength,lc.ParagraphReader.dia,la.a.instance.resolve("Box4.Presence.MyPresenceUser"),nc,Qe,Ka.App.aj.Pk,new rd.a,pb.a.instance,Gi.a.get_instance(),ia.a.Vp(la.a.instance.za("Common.App.CoauthTelemetry.IPresenceBootTelemetry")),m.AFrameworkApplication.K,m.AFrameworkApplication.K.$("Box4ThrottleAndBatchPresenceRendering"),m.AFrameworkApplication.K.$("Box4DoNotRenderPresenceOutOfView"),la.a.instance.resolve("WordEditor.Presence.IWordPresenceCpFactory"),la.a.instance.resolve("Common.IPresenceStatusProvider"),
!Ka.App.Wr&&!Ka.App.Bn,Ka.App.Zia());u.ULS.sendTraceTag(23196878,302,50,"WordPresenceManager instance created");Me.sdd.Jf(Me._instance);Me.Nkc.Jf(Me._instance);Me.KAg.Jf(Me._instance);wa=la.a.instance;wa.ha("WordEditor.Presence.WordPresenceManager",()=>Me._instance).as("Common.IPresenceRemover").as("Common.IPresenceSender").singleInstance();wa.resolve("WordEditor.Presence.WordPresenceManager")}else u.ULS.sendTraceTag(4203468,302,15,"Can't initialize the WordPresenceManager because can't get a handle to RtcProxy")}static jOc(wa){Me._instance||
(u.ULS.sendTraceTag(4006601,302,50,"WordPresenceManager.OnAppIsInteractive: Trying to initialize again"),(wa=Object(r.a)(15,wa))&&wa.ogb(Me.jOc),Me.init())}static jci(){Me._instance.yOf()}static WEj(wa,kb,Pb,Hb,bd){Pb=bd.split(",");if(!Pb||3!==Pb.length)return 8;wa=Pb[0].trim();kb=Pb[1].trim();Pb=Number.parseInvariant(Pb[2].trim());wa=new aj(new ta(wa),new Sm(kb,Pb,-1));if(!Me.Nkc.task.isCompleted)return 8;kb=Me.NG().result;kb.IHe(wa);kb.rYd();return 32}static jKf(wa,kb,Pb,Hb,bd){if(!Me.Nkc.task.isCompleted)return 8;
wa=Me.NG().result;wa.SSc(bd);wa.rYd();return 32}static dsn(wa,kb,Pb,Hb,bd){if(!Me.Nkc.task.isCompleted)return 8;wa=Me.NG().result;if(!wa)return 8;wa.p2d(bd);return 32}static gHf(wa,kb,Pb,Hb,bd){if(1===Pb)return 32;if(!Me.NMa.NG().isCompleted)return 8;wa=Me.NMa.NG().result;if(!wa)return u.ULS.sendTraceTag(4301136,302,10,"rtcProxy is null when trying to display RTC connection status"),8;bd[gh.a.Value]=2===wa.connectionState?WordEditorIntl.WordEditorStrings.L_RtcConnected:1===wa.connectionState?WordEditorIntl.WordEditorStrings.L_RtcConnecting:
"";return 32}}Me._instance=null;Me.Wig=!0;Me.sdd=new w.a;Me.Nkc=new w.a;Me.KAg=new w.a;Me.Ly=null;Me.Tob=null;Me.wL=null;Me.$h=null;Me.F6a=null;Object(k.a)(Me,"WordPresenceManager",cf,[]);class me{constructor(wa){this.ma=new Ga.a;this.mW=wa;this.mW.CWR(()=>this.mW.result.pHj(()=>{this.ma.raiseEvent("X")}))}nJj(wa){this.ma.addHandler("X",wa)}MYm(wa){this.ma.removeHandler("X",wa)}getStatus(){return this.mW.isCompleted&&this.mW.result?this.mW.result.Nyc.toString():"0"}}Object(k.a)(me,"WordPresenceStatusProvider",
null,[160]);class nl{constructor(wa,kb,Pb,Hb){this.$h=null;this.Oig=this.Mre=!1;this.Mi=wa;this.D6=kb;this.Qaa=Pb;Pb.continueWith(Object(f.a)(this,this.jsm,"onRtcReady"));this.Xmj=Hb;this.Xmj.mpf=this.D6}jsm(){this.Qaa.isCompleted&&this.Qaa.result?(this.$h=this.Qaa.result,this.$h.SSa(Object(f.a)(this,this.$0,"onPresenceUpdated")),u.ULS.sendTraceTag(5604372,302,50,"Presence Update Monitor is ready.")):u.ULS.sendTraceTag(5604373,302,15,"RtcTask did not complete successfully. No monitoring")}$0(wa,kb){wa=
kb.XCa;for(const Pb in wa)if(kb=wa[Pb],!this.Mre&&kb.user.QO&&kb.user.QO!==this.D6.QO){u.ULS.sendTraceTag(5604375,302,15,"Presence received from different local cobalt session Mine:{0} Theirs:{1}",this.D6.QO,kb.user.QO);this.Mre=!0;break}this.Mre&&this.$h.UEb(Object(f.a)(this,this.$0,"onPresenceUpdated"));this.Oig||(u.ULS.sendTraceTag(5604374,302,50,"First presence received"),this.Oig=!0)}}Object(k.a)(nl,"WordPresenceUpdateMonitor",null,[]);var zn=b(466),oe=b(1350),th=b(202),oj=b(1688),nf=b(1689);
class Ni{constructor(wa,kb,Pb,Hb,bd,nc,Qe){this.ma=new Ga.a;this.lpg=this.erg=this.Npe=this.Rtg=!1;this.dFe=this.fjd=0;this.vSb=null;this.pFa=nc;this.pFa.clientId=wa.clientId;this.Gp=wa;this.c6=kb;this.pN=Hb;this.Jej=bd;this.Ta=Pb;this.A3a=new th.a;this.fl=Qe;this.c6&&this.c6.continueWith(()=>{this.c6.Hn||this.c6.Gh||this.c6.result.lPg(Object(f.a)(this,this.Q9h,"onAmIAloneChanged"))})}get connectionState(){return this.Gp.connectionState}SSa(wa){this.ma.addHandler("PU",wa)}UEb(wa){this.ma.removeHandler("PU",
wa)}qwa(wa){this.ma.addHandler("CSC",wa)}WSc(wa){this.ma.removeHandler("CSC",wa)}wld(wa){this.ma.addHandler("PSU",wa)}mYd(wa){this.ma.removeHandler("PSU",wa)}vld(wa){this.ma.addHandler("PSC",wa)}lYd(wa){this.ma.removeHandler("PSC",wa)}rzi(){}get clientId(){return this.Gp.clientId}j3(wa){this.ma.addHandler("UN",wa)}Y8b(wa){this.ma.removeHandler("UN",wa)}Bzl(){this.vSb=Array(12);for(let wa=0;12>wa;wa++)this.vSb[wa]=0;this.erg=this.fl?this.fl.$("UpdateNotificationTaskExperimentIsEnabled"):!0;m.AFrameworkApplication.UK(()=>
{this.x8l()})}init(){this.Gp.qwa(Object(f.a)(this,this.Dda,"onConnectionStateChanged"));this.Gp.SSa(Object(f.a)(this,this.$0,"onPresenceUpdated"));this.Gp.wld(Object(f.a)(this,this.ZCb,"onPersistentStateUpdated"));this.Gp.vld(Object(f.a)(this,this.H6b,"onPersistentStateCleared"));this.Gp.j3(Object(f.a)(this,this.A9,"onUpdateNotificationReceived"));this.y5g();this.Bzl()}FXd(wa){this.A3a.contains(wa,(kb,Pb)=>kb===Pb)||(this.A3a.add(wa),2===this.connectionState&&wa.start())}q_f(wa){for(let kb=0;kb<this.A3a.length;kb++)if(this.A3a.J(kb)===
wa){this.A3a.HD(kb);break}}connect(){this.Npe||this.Gp.connect()}disconnect(){this.Gp.disconnect()}get BZd(){return this.Gp}Jch(wa){return aj.$tb(wa)}SOf(wa,kb){return(new aj(wa,kb)).Q$e()}EOf(wa){wa&&wa.Nc()&&!this.pN()?this.Gp.rzi(this.SOf(this.pFa.O7k(),wa)):L.Task.T3(null)}MUc(wa,kb){return this.Gp.MUc(wa,kb)}U4e(wa){return this.Gp.U4e(wa)}DCc(){return this.Gp.DCc()}MM(wa,kb,Pb=!1){return this.Gp.MM(wa,kb,Pb)}vwb(){return this.G8g(this.Gp.vwb())}GIb(){return L.Task.T3(null)}get Xdb(){return this.Gp.Xdb}Dda(wa,
kb){2===kb.newState&&this.A3a.forEach(Pb=>{Pb.start();return!0});kb.newState||this.fl.$("SendRTCMessagesWhileDisconnectedIsEnabled")&&!this.Npe||this.A3a.forEach(Pb=>{Pb.stop();return!0});this.ma.raiseEvent("CSC",kb)}D2e(wa){return wa.toLowerCase()}$0(wa,kb){if(!this.pN()){wa=this.G8g(kb.XCa);kb=this.J8g(kb.Ktd);var Pb=new Zi.a(wa,kb);kb=new Ea.a(0,1,0,()=>{this.ma.raiseEvent("PU",Pb)},57);this.Ta.ub(kb)}}G8g(wa){const kb={};for(const Hb in wa){var Pb=Hb;const bd=this.Jch(wa[Hb]);bd&&bd.Nc()?kb[this.D2e(Pb)]=
bd:u.ULS.sendTraceTag(562661590,302,50,"No Valid User {0}",Pb)}return kb}J8g(wa){const kb=Array(wa.length);for(let Pb=0;Pb<wa.length;Pb++)kb[Pb]=this.D2e(wa[Pb]);return kb}ZCb(wa,kb){if(!this.pN()){var Pb={};wa=kb.XCa;for(var Hb in wa)Pb[this.D2e(Hb)]=wa[Hb];Hb=new Ea.a(0,1,0,()=>{this.ma.raiseEvent("PSU",new oj.a(kb.type,Pb))},80);this.Ta.ub(Hb)}}H6b(wa,kb){if(!this.pN()){wa=this.J8g(kb.Apd);var Pb=new nf.a(wa);wa=new Ea.a(0,1,0,()=>{this.ma.raiseEvent("PSC",Pb)},81);this.Ta.ub(wa)}}A9(wa,kb){this.erg?
this.$di(kb):(wa=new Ea.a(0,1,0,()=>{this.$di(kb)},58),this.Ta.ub(wa))}$di(wa){var kb=Date.now();this.ma.raiseEvent("UN",wa);kb=Date.now()-kb;500<=kb&&(this.fjd++,u.ULS.sendTraceTag(42563487,302,15,"Update Notification Heuristics: UpdateNotification Type {0} took {1} ms",wa.type,kb),this.CJk(wa));this.dFe++}CJk(wa){0>wa.type||21<=wa.type?u.ULS.sendTraceTag(42541602,302,15,"Update Notification Heuristics: UpdateNotification Type out of range {0}",wa.type):this.vSb[wa.type]++}x8l(){if(!this.lpg){var wa=
{};wa.TC=this.dFe;wa.HRC=this.fjd;this.vSb&&0<this.fjd&&(wa.TBC=this.vSb);this.fjd=this.dFe=0;this.vSb=null;u.ULS.sendTraceTag(42541603,302,50,"UpdateNotificationHeuristics: {0}",wa);this.lpg=!0}}dispose(){this.A3a=new th.a;this.Gp.WSc(Object(f.a)(this,this.Dda,"onConnectionStateChanged"));this.Gp.UEb(Object(f.a)(this,this.$0,"onPresenceUpdated"));this.Gp.mYd(Object(f.a)(this,this.ZCb,"onPersistentStateUpdated"));this.Gp.lYd(Object(f.a)(this,this.H6b,"onPersistentStateCleared"));this.Gp.Y8b(Object(f.a)(this,
this.A9,"onUpdateNotificationReceived"));this.c6&&this.c6.continueWith(()=>{this.c6.Hn||this.c6.Gh||this.c6.result.MXm(Object(f.a)(this,this.Q9h,"onAmIAloneChanged"))});this.Gp.disconnect();u.ULS.sendTraceTag(4564935,302,50,"Disposing of rtcProxyCompleted")}Q9h(){this.y5g()}y5g(){let wa=!1;this.c6?this.c6.continueWith(()=>{this.c6.Hn||this.c6.Gh||(wa=!this.c6.result.amIAlone);this.Gp.connectionState||!wa&&!this.Jej()?2!==this.Gp.connectionState||wa||(this.disconnect(),u.ULS.sendTraceTag(4564937,302,
50,"Disconnecting because there are no other users in the doc")):(this.connect(),u.ULS.sendTraceTag(4564936,302,15,"Connecting because there are other authors in the doc"));!this.Rtg&&wa&&(u.ULS.sendTraceTag(4203466,302,50,"There are other real-time authors in this session"),this.Rtg=!0)}):(this.connect(),u.ULS.sendTraceTag(589321547,302,50,"Connecting to rtc because Rtc Always On is enabled"))}Jzc(){this.Npe=!0;this.disconnect();u.ULS.sendTraceTag(4564938,302,50,"DisconnectForever")}}Object(k.a)(Ni,
"RtcProxy",null,[1099,14,846,1100]);class tg extends Ni{constructor(wa,kb,Pb,Hb,bd,nc,Qe,ye,lf,rh,Eg,Qf,jg){super(wa,kb,Pb,Hb,bd,nc,jg);this.YE=null;this.kG=Qe;this.oc=ye;this.vFa=lf;this.Aoc=rh;this.QBe=Eg;this.xrb=Qf}get xB(){return this.YE||(this.YE=this.QBe())}Dda(wa,kb){2===kb.newState&&u.ULS.sendTraceTag(4315102,302,50,"RTC Connected");this.QQn();super.Dda(wa,kb)}QQn(){this.xB&&this.xB.JM("RtcConnectionStatusLabel")}Jch(wa){return $e.QTe(Sc(wa),this.kG,this.oc,this.vFa,this.xrb)}SOf(wa,kb){return Object(bi.a)(He,
kb)?(wa=new $e(this.Aoc.Jyh(),wa,kb),kc(wa.Q$e())):super.SOf(wa,kb)}}Object(k.a)(tg,"WordRtcProxy",Ni,[]);class Ih{constructor(wa,kb,Pb,Hb,bd,nc,Qe,ye,lf,rh,Eg,Qf,jg){this.Zp=new w.a;this.$Fg=!0;this.Zc=kb;this.Ta=Pb;this.pN=Hb;this.pFa=bd;this.kG=nc;this.uoa=Qe;this.vFa=ye;this.Aoc=lf;this.QBe=rh;this.$na=Eg;this.xrb=Qf;this.qa=jg}NG(){this.aHn();return this.Zp.task}QDc(){return zn.a.then(this.NG(),wa=>wa)}aHn(){if(this.$Fg)if(this.$Fg=!1,Ka.App.Wlf()&&Ka.App.Tjf()){var wa=m.AFrameworkApplication.fe;
if(wa){wa=oe.RealtimeChannel.createInstance("{"+m.AFrameworkApplication.userSessionId+"}",m.AFrameworkApplication.userSessionId,m.AFrameworkApplication.owi,wa,this.$na,1,this.Zc,this.qa.Ga("RtcEndpointUrl"),void 0,void 0,null,this.qa.$("FindSessionOnBootIsEnabled")?la.a.instance.resolve("Common.IFindSessionUtils"):null,this.qa.Ga("RtcBootToken"));var kb=this.qa.$("RtcAlwaysOnEnabled"),Pb=new tg(wa,kb?null:Ka.App.Zia(),this.Ta,this.pN,Ih.XMk,this.pFa,this.kG,this.uoa,this.vFa,this.Aoc,this.QBe,this.xrb,
m.AFrameworkApplication.K);Ka.App.Ohn(Pb);this.eTm(Pb);Pb.init();yf.App.x_a=Pb;this.$na.execute(Hb=>{Hb.R7a(()=>{Pb.Jzc()})});this.Zp.Jf(Pb)}else u.ULS.sendTraceTag(8206365,302,15,"Can't initialize the RtcProxy because ClientRequestManager is null")}else u.ULS.sendTraceTag(8206362,302,10,"Can't initialize the RtcProxy because dependent scripts are not loaded")}eTm(wa){const kb=la.a.instance;kb.ha("WordEditor.Presence.WordRtcProxy",()=>wa).as("Box4.Presence.IRtcProxy").as("Common.IRealtimeChannelBasic").singleInstance();
kb.resolve("Common.IRealtimeChannelBasic")}static XMk(){return!1}}Object(k.a)(Ih,"WordRtcProxyProvider",null,[152,153]);class Ri{constructor(){this.W=null;this.uk=!1}get name(){return"WordEditor.Presence"}init(){u.ULS.sendTraceTag(50995799,302,50,"PresencePackage Init");Ka.App.EZi&&(this.W.resolve("WordEditor.Presence.WordRtcProxyProvider").NG(),Me.init(),this.W.resolve("WordEditor.Presence.WordPresenceUpdateMonitor"));Ka.App.Gxc&&Ci.init();this.W.resolve("Common.App.Presence.AwayManager");this.W.resolve("Common.IPeopleInfoProvider");
if(Ri.Yog){const wa=this.W.resolve("WordEditor.IMainViewModeManager");wa.xTb(this.dBf);Ri.moe=1===wa.XA}}dispose(){if(!this.uk){this.uk=!0;Me.NG().continueWith(()=>{Af.a.pz(Me.NG().result)});var wa=this.W.resolve("Box4.Presence.MyPresenceUser");wa&&wa.T7b&&wa.T7b.MYm(Me.jci)}}yb(wa){this.W=wa;this.W.ha("Box4.Presence.MyPresenceUser",()=>new Wa).as("Box4.Presence.IMyPresenceUser").as("Common.IPresenceUser").as("Common.IPresenceConverter").singleInstance();wa.ha("WordEditor.Presence.IWordPresenceCpFactory",
()=>new Fj(wa.resolve("Box4.CpConversionManagerImpl"),wa.resolve("Box4.IContentControlReader"))).singleInstance();wa.ha("WordEditor.Presence.WordPresenceUpdateMonitor",()=>new nl(new R.a(()=>Ka.App.lc),Nf.a.instance,wa.resolve("WordEditor.Presence.WordRtcProxyProvider").QDc(),wa.resolve("Box4.Presence.IMyPresenceUser"))).singleInstance();wa.ha("WordEditor.Presence.WordRtcProxyProvider",()=>new Ih(m.AFrameworkApplication.buildVersion,Ka.App.oa.Qo,pb.a.instance,()=>m.AFrameworkApplication.Qj,la.a.instance.resolve("Box4.Presence.IMyPresenceUser"),
la.a.instance.ra("WordEditor.ParagraphWordIdMapping"),la.a.instance.resolve("WordEditor.WordTextOffsetTranslator.IWordTextOffsetTranslator"),()=>m.AFrameworkApplication.na&&Ka.App.oa.Da&&Ka.App.oa.Da.Zb?Ka.App.oa.Da.Zb.Lc:null,Cl.instance,()=>la.a.instance.ra("WordEditor.IStatusBarUser"),la.a.instance.za("Common.ISessionExpirationManager"),la.a.instance.resolve("WordEditor.Presence.IWordPresenceCpFactory"),m.AFrameworkApplication.K)).singleInstance().as("Box4.Presence.IRtcProxyProvider").as("Common.Interface.IRtcBasicProvider");
wa.ha("Box4.Presence.PresenceControlProvider",()=>new rk(Ri.Qmk(),Ve.a.instance,la.a.instance.za("Common.IZoomManager"),la.a.instance.resolve("Box4.ICoauthCashTelemetry"),ia.a.Vp(la.a.instance.za("Common.ISystemInitiatedFeedbackWithTimeLapse")),m.AFrameworkApplication.K,wa.resolve("Common.IPeopleInfoProvider"))).singleInstance();wa.ha("Common.App.Presence.AwayManager",()=>new Kc(la.a.instance.resolve("Common.IPresenceUser"),la.a.instance.resolve("WordEditor.Presence.WordRtcProxyProvider").QDc(),Me.ybl(),
la.a.instance.resolve("Common.IPresenceConverter"),pb.a.instance,m.AFrameworkApplication.K.$("AwayStatusOneMinuteTimeoutIsEnabled")?6E4:m.AFrameworkApplication.K.vb("AwayCoauthorThresholdMs",9E5),Object(f.a)(m.AFrameworkApplication.pa,m.AFrameworkApplication.pa.processAction,"processAction"),Ka.App.oa.notificationBar,m.AFrameworkApplication.K.$("PeoplesWellExtraButtonInfoIsEnabled"))).singleInstance();wa.ha("WordEditor.Presence.WordPresenceStatusProvider",()=>new me(ia.a.Vp(la.a.instance.za("Common.ICurrentPageCalculator")))).as("Common.IPresenceStatusProvider").singleInstance();
wa.ha("Common.App.Presence.PeopleInfoProvider",()=>new vf(wa.resolve("WordEditor.Presence.WordRtcProxyProvider").QDc(),Ka.App.Zia().CWR(()=>Ka.App.Zia().result.wz),wa.resolve("Common.App.People.IPeopleColorUtils"),wa.resolve("Common.IPresenceConverter"),ia.a.Vp(wa.za("Common.App.Presence.AwayManager")))).as("Common.IPeopleInfoProvider").singleInstance();wa.ha("Box4.Presence.WordPresenceDataManager",()=>new zh(Ka.App.oa.Da.Zb.Lc,la.a.instance.resolve("Box4.IFeatureHelper"))).as("Box4.IPresenceDataManager").singleInstance()}dBf(wa,
kb){Ka.App.oa&&Ka.App.oa.vA&&(Ri.ncd=null,Ri.moe=1===kb.Q5b)}static get Wei(){if(!Ri.ncd&&Ka.App.oa&&Ka.App.oa.vA){const wa=yf.App.Hk.vA;Ri.ncd=Ri.moe&&Ri.Yog?wa.getElementsByClassName("PaginatedContentContainerDisplayWrapper")[0]:wa.getElementsByClassName("OutlineContainerDisplayWrapper")[0]}return Ri.ncd}static Qmk(){const wa=m.AFrameworkApplication.K.$("PeoplesWellExtraButtonInfoIsEnabled"),kb=m.AFrameworkApplication.K.getBooleanFeatureGate("Microsoft.Office.WordOnline.PresenceIgnoreEventOnExpandedTooltip",
!1),Pb=m.AFrameworkApplication.K.getBooleanFeatureGate("Microsoft.Office.WordOnline.PresenceIpWidthAdjustForFlyout",!1),Hb=new sb;Hb.add(Yc.multipleBrowsersImageClassName,ef.getImageClassWithCluster(m.AFrameworkApplication.zO,"MoreUsersGlyph16"));Hb.add(Yc.multipleBrowserImageClusterPath,m.AFrameworkApplication.qp);Hb.add(Yc.peopleImageClassName,ef.getImageClassWithCluster(m.AFrameworkApplication.zO,wa?"DoughboyWhiteGlyph_20x20x32":"SingleCollabUserGlyph16"));Hb.add(Yc.peopleImageClusterPath,m.AFrameworkApplication.qp);
Hb.add(Yc.zIndex,1);Hb.add(Yc.rtl,m.AFrameworkApplication.isRtl);Hb.add(Yc.viewportBoundsCallback,Ri.zll);Hb.add(Yc.ignoreEventOnExpandedTooltip,kb);Hb.add(Yc.ipWidthAdjustForFlyout,Pb);return wa?new we(Hb):new ik(Hb)}static zll(){return Ri.Wei?ah.a.getElementBounds(Ri.Wei):null}}Ri.moe=!0;Ri.Yog=m.AFrameworkApplication.K.getBooleanFeatureGate("Microsoft.Office.WordOnline.FlippedFlyoutForPaginationViewIsEnabled",!1);Ri.ncd=null;Object(k.a)(Ri,"WordPresencePackage",null,[1,2]);var wi=b(914),Ne=b(1217),
ke=b(919),tm=b(146);class yg{constructor(wa,kb){this.JHe=wa;this.paragraphId=kb}get opType(){return 2}get operation(){return this.JHe}}Object(k.a)(yg,"RttAppliedAddParagraphOp",null,[154]);class Pe{constructor(wa,kb){this.X_m=wa;this.paragraphId=kb}get opType(){return 6}get operation(){return this.X_m}}Object(k.a)(Pe,"RttAppliedReplaceSymbolRangeOp",null,[154]);class wd{constructor(wa,kb){this.a0m=wa;this.paragraphId=kb}get opType(){return 1}get operation(){return this.a0m}}Object(k.a)(wd,"RttAppliedReplaceTextRangeOp",
null,[154]);class Wk{constructor(wa,kb,Pb){this.nKi=wa;this.P2d=kb;this.Eyc=Pb}get opType(){return 4}get operation(){return this.nKi}get AAj(){return this.nKi.wWb()?this.Eyc:this.P2d}}Object(k.a)(Wk,"RttAppliedSplitParagraphOp",null,[154]);class zk{constructor(){this.w2a=new cb.a}tnf(wa){return wa.toString()}Itc(wa,kb){wa=this.tnf(wa);this.w2a.Ja(wa)||this.w2a.Z(wa,new M.a);this.w2a.J(wa).add(kb)}Hzf(wa){switch(wa.opType){case 1:var kb=Object(r.a)(wd,wa);this.Itc(kb.paragraphId,wa);break;case 6:kb=
Object(r.a)(Pe,wa);this.Itc(kb.paragraphId,wa);break;case 4:kb=Object(r.a)(Wk,wa);this.Itc(kb.P2d,wa);this.Itc(kb.Eyc,wa);break;case 2:kb=Object(r.a)(yg,wa),this.Itc(kb.paragraphId,wa)}}oom(wa){return this.Reb(wa)}Reb(wa){wa=this.tnf(wa);if(!this.w2a.Ja(wa))return new M.a;const kb=this.w2a.J(wa);this.w2a.remove(wa);for(let Pb of kb)Pb.operation&&(Pb.operation.l3=null);return kb}t9k(wa){let kb;return({value:kb}=this.w2a.Ab(this.tnf(wa),kb)).returnValue?kb:new M.a}CQk(wa){for(let kb of this.w2a.values){if(!kb.count)continue;
if(2!==kb.J(0).opType)continue;const Pb=kb.J(0);if(Pb.JHe.Nvf===wa)return Pb}return null}}Object(k.a)(zk,"RttAppliedOpTracker",null,[136]);var Zl=b(216),Vh;(function(wa){wa[wa.CEk=0]="expired";wa[wa.i6n=1]="dried"})(Vh||(Vh={}));Object(k.b)("RemoveChangeReason",Vh);class wl{constructor(){this.Ita=new Zl.a}iCj(wa){if(!wa)return u.ULS.sendTraceTag(7685333,355,15,"Cannot add a null change to RTTStore"),!1;const kb=wa.Ib,Pb=wa.Wh;this.Ita.Ja(kb)||this.Ita.add(kb,new Zl.a);this.Ita.J(kb).Z(Pb,wa);return this.Kok(kb,
Pb)?(u.ULS.sendTraceTag(7619921,355,15,"Detected an infinite loop in paragraph {0}, dropping the last packet!",kb),this.Ita.J(kb).remove(Pb),!1):!0}l9e(wa,kb){if(!this.Ita.Ja(wa))return null;wa=this.Ita.J(wa);return wa.Ja(kb)?wa.J(kb):null}WAd(wa){const kb=new M.a;for(let Pb of this.Ita.keys){const Hb=this.Ita.J(Pb);for(let bd of Hb.keys){const nc=Hb.J(bd);wa(nc)&&kb.add(nc)}}return kb}Mqi(wa,kb){let Pb=null;({value:Pb}=this.Ita.Ab(wa.Ib,Pb)).returnValue?(wa.activity.Txf(Vh[kb]),Pb.remove(wa.Wh),
Pb.count||this.Ita.remove(wa.Ib)):u.ULS.sendTraceTag(50938848,355,15,"Cannot remove an op that not exist in _changes. WordId: {0}; Reason: {1}",wa.Ib,kb)}SJf(wa){this.Mqi(wa,1)}WJf(wa){this.Mqi(wa,0)}Kok(wa,kb){if(!this.Ita.Ja(wa))return!1;wa=this.Ita.J(wa);if(!wa.Ja(kb))return!1;for(var Pb=wa.J(kb);Pb;){Pb=Pb.OY;if(Pb===kb)return!0;if(!wa.Ja(Pb))break;Pb=wa.J(Pb)}return!1}}Object(k.a)(wl,"RttDataStore",null,[134,135]);var Dg=b(281),fc=b(66),xj=b(275),ng=b(17);class Cf{constructor(wa,kb){this.lo=
wa;if(this.Ep=kb)wa=this.Ep.Yd(12),wa.Yo(Object(f.a)(this,this.ZQd,"onGraphNodeConnected")),wa.Mt(Object(f.a)(this,this.Reb,"onGraphNodeDisconnected")),wa.Yl(Object(f.a)(this,this.Gai,"onGraphPropertyChanged"))}dispose(){if(this.Ep){const wa=this.Ep.Yd(12);wa.oE(Object(f.a)(this,this.ZQd,"onGraphNodeConnected"));wa.R9(Object(f.a)(this,this.Reb,"onGraphNodeDisconnected"));wa.WI(Object(f.a)(this,this.Gai,"onGraphPropertyChanged"))}}ZQd(wa,kb){4===this.lo.opType?u.ULS.shipAssertTag(9204866,355,12===
kb.node.type||11===kb.node.type,"Unexpected graph modification detected during RTT edit"):u.ULS.shipAssertTag(9204867,355,!1,"Unexpected graph modification detected during RTT edit")}Reb(){u.ULS.shipAssertTag(9204868,355,!1,"Unexpected graph modification detected during RTT edit")}Gai(){u.ULS.shipAssertTag(9204869,355,!1,"Unexpected graph modification detected during RTT edit")}}Object(k.a)(Cf,"GraphChangeValidator",null,[14]);class gg{constructor(wa,kb,Pb,Hb){this.id=wa;this.cpBegin=kb;this.cpEnd=
Pb;this.g3j=Hb}bUn(wa){var kb=this.id===wa.id;kb&&(kb=this.g3j.replace("\u00a0"," "),wa=wa.characterData.substr(this.cpBegin,this.cpEnd-this.cpBegin).replace("\u00a0"," "),kb=kb===wa);return kb}}Object(k.a)(gg,"RttOpValidator",null,[195]);class pf{constructor(wa,kb){this.l3=this.z1a=this.activity=null;this.opType=wa;this.metadata=kb}Iaf(){return""}serialize(){return null}}Object(k.a)(pf,"RttOp",null,[151]);class $k extends pf{constructor(wa,kb,Pb,Hb,bd,nc,Qe,ye,lf){super(lf,ye);this.Ib=wa;this.Wh=
kb;this.bP=Pb;this.W0=Hb;this.OY=bd;this.uib=nc;this.mF=Qe}u$g(){return this.bP.isEqual(this.W0,!0)?new Fc.a(0,this.Ib,this.Wh,this.bP,void 0,void 0,void 0,this.mF):new Fc.a(1,this.Ib,this.Wh,this.bP,this.Ib,this.Wh,this.W0,this.mF)}static QQi(wa,kb,Pb,Hb,bd){wa=wa.NQ;if(1===wa.hXd&&(wa.NLa!==wa.WAa||wa.O0a!==wa.Ubc))return u.ULS.sendTraceTag(8914769,355,15,"We received a ReplaceRange operation spanning multiple paragraphs"),kb=Pb=null,Hb=bd=-1,{returnValue:!1,bP:kb,W0:Pb,Ib:Hb,Wh:bd};if(wa.mF)return kb=
Pb=null,Hb=bd=-1,{returnValue:!1,bP:kb,W0:Pb,Ib:Hb,Wh:bd};Pb=kb=wa.bP;1===wa.hXd&&(Pb=wa.W0);Hb=wa.NLa;bd=wa.O0a;return{returnValue:!0,bP:kb,W0:Pb,Ib:Hb,Wh:bd}}}Object(k.a)($k,"RttReplaceRangeOp",pf,[]);var ol=b(1215),Tg=b(385),xd=b(548);class Si extends xd.a{constructor(){super();this.RttStatusRecords=this.FileId=null}ol(){return 110}static L7(wa,kb){const Pb=new Si;Pb.FileId=wa;Pb.RttStatusRecords=kb;return Pb}}Object(k.a)(Si,"RttStatusRequest",xd.a,[]);class Sj{}Object(k.a)(Sj,"RttStatusOp",null,
[]);class Re{constructor(){this.contentState=this.contentType=this.timeToRender=this.strictlySequentialId=this.packetVersion=this.clientType=this.clientId=this.packetId=null}}Object(k.a)(Re,"WireRttStatusOpRecord",null,[]);class Ae extends Tg.a{constructor(){super();const {App:wa}=b(161);this.LQb=new M.a;this.hze=new M.a;this.Hi=new ol.a(m.AFrameworkApplication.K.vb("WordEditorRttStatusReplicatorIntervalMs",6E4));this.enabled=1;wa.PY.register(this)}h4i(){const wa=Date.now();for(let kb of this.LQb)kb.hDb&&
1===kb.hDb&&(kb.hDb=2,kb.timeToRender=wa-kb.metadata.fYf)}$8d(wa){const kb=new Sj;kb.metadata=wa.operation.metadata;kb.opType=wa.opType;kb.hDb=1;this.LQb.add(kb)}get fka(){return"RttStatusReplicator"}x0(){return this.Tc&&2===this.Tc.status?!0:1===this.enabled&&this.Hi.SU()?this.eB():!1}eB(){for(let wa of this.LQb)if(wa.hDb&&2===wa.hDb)return!0;return!1}yMa(){if(1===this._state){this._state=3;const kb=this.LQb.toArray().filter(Pb=>2===Pb.hDb);var wa=this.hhk(kb);wa=Si.L7(m.AFrameworkApplication.rootQuerySignature,
wa);kb.forEach(Pb=>this.LQb.remove(Pb));kb.forEach(Pb=>this.hze.add(Pb));this.Tc.Kq=wa;this.Tc.GF="RttStatusRequest";this.Tc.status=1}else 3===this._state&&this.Tc&&2===this.Tc.status&&(this.Hi.bZ(),2!==this.Tc.statusCode&&this.LQb.ez(0,this.hze),this.hze.clear(),this._state=1)}hhk(wa){const kb=[];wa.forEach(Pb=>{const Hb=new Re;Hb.clientId=Pb.metadata.clientId;Hb.clientType=Pb.metadata.clientType;Hb.packetId=Pb.metadata.packetId;Hb.packetVersion=Pb.metadata.packetVersion;Hb.strictlySequentialId=
Pb.metadata.strictlySequentialId;Hb.contentType=Pb.opType;Hb.contentState=Pb.hDb;Hb.timeToRender=Pb.timeToRender;kb.push(Hb)});return kb}kac(){return!0}mC(){}forceOutbound(){}}Object(k.a)(Ae,"RttStatusReplicator",Tg.a,[]);class Ml{constructor(wa,kb,Pb,Hb,bd,nc){this.packetId=wa;this.clientId=kb;this.clientType=Pb;this.fYf=Hb;this.packetVersion=bd;this.strictlySequentialId=nc}static create(wa){let kb=null;null!=wa.strictlySequentialId&&(kb=wa.strictlySequentialId);return new Ml(wa.packetId,wa.clientId,
wa.client,Date.now(),wa.version,kb)}}Object(k.a)(Ml,"RttOpMetadata",null,[]);class mh extends pf{constructor(wa,kb,Pb,Hb,bd,nc,Qe,ye,lf){super(4,lf);this.OY=0;this.Ib=wa;this.Wh=kb;this.offset=Pb;this.mF=Hb;this.L2f=bd;this.OXf=nc;this.D8d=Qe;this.PXf=ye;this.L2f===this.Ib?this.OY=this.OXf:this.D8d===this.Ib?this.OY=this.PXf:(u.ULS.sendTraceTag(8397766,355,10,"Bad data passed to RttSplitParagraphOp"),this.OY=0)}wWb(){return this.Ib===this.D8d}get tCn(){return this.OY}get hXn(){return this.wWb()?this.L2f:
this.D8d}get SNi(){return this.wWb()?this.OXf:this.PXf}serialize(){const wa=new Fc.a(3,this.Ib,this.Wh,this.offset,null,null,null,this.mF),kb=new Wb(this.L2f,this.OXf,this.D8d,this.PXf);return new yb(this.metadata.packetId,this.metadata.clientId,1,4,wa,null,void 0,void 0,void 0,void 0,kb,void 0,void 0,this.metadata.strictlySequentialId)}static create(wa){const kb=wa.NQ,Pb=wa.hHb;return new mh(kb.NLa,kb.O0a,kb.bP,kb.mF,Pb.fCf,Pb.NXf,Pb.gCf,Pb.QXf,Ml.create(wa))}static jel(wa,kb,Pb){if(1!==wa.type)return null;
const Hb=Pb.PLa(wa.X0.characterData,wa.X0.la);return new mh(wa.X0.Ib,wa.X0.Wh,Pb.Qdc(Hb,wa.$Ji),wa.mF,wa.Crb.Ib,wa.Crb.Wh,wa.Xuc.Ib,wa.Xuc.Wh,kb)}}Object(k.a)(mh,"RttSplitParagraphOp",pf,[132,151]);class ya{constructor(wa,kb,Pb,Hb){this.Bfa=wa;this.Tnc=kb;this.Xfa=Pb;this.Oqb=Hb;null!=m.AFrameworkApplication.K&&m.AFrameworkApplication.K.getBooleanFeatureGate("Microsoft.Office.WordOnline.WordEditorRttStatusReplicatorIsEnabled",!1)&&(this.Wpb=new Ae,Dg.GraphTransactionManager.instance.kPg(Object(f.a)(this,
this.xkm,"onAllViewsUpdatedEvent")))}xkm(){this.Wpb.h4i()}bPj(wa,kb,Pb,Hb=null){if(kb.isDirty)return Hb&&Hb.properties.Z(ya.dgi,"1"),!1;const bd=new Cf(wa,kb.Oh);try{if(1===wa.opType||6===wa.opType){const ye=Object(r.a)($k,wa),lf=this.bdk(ye,kb);var nc=lf.node.characterData;const rh=10<=lf.cpBegin?lf.cpBegin-10:0;let Eg=lf.cpEnd+10<=nc.length?lf.cpEnd+10:nc.length;const Qf=nc.substr(rh,lf.cpBegin-rh),jg=nc.substr(lf.cpEnd,Eg-lf.cpEnd);Eg=Eg+ye.uib.length-(lf.cpEnd-lf.cpBegin);var Qe=new gg(lf.node.id,
rh,Eg,Qf+ye.uib+jg);const Ng=6===ye.opType;nc="";Ng&&(nc=ye.font);if(!this.H_m(lf,ye.uib,Ng,nc,Hb))return!1;let ci;ci=1===wa.opType?new wd(ye,kb.id):new Pe(ye,kb.id);kb.dia=wa.OY;ye.z1a=Qe;wa.l3=ci;Pb.Hzf(ci);null!=this.Wpb&&this.Wpb.$8d(ci)}else return 4===wa.opType?this.aPj(wa,kb,Pb):!1}finally{bd&&bd.dispose()}return!0}aPj(wa,kb,Pb){const Hb=Object(r.a)(mh,wa);var bd=this.Oqb.PLa(kb.characterData,kb.la);bd=this.Oqb.Wtb(bd,Hb.offset);if(!this.iWh(Lc.a.createTextRange(kb,0,lc.ParagraphReader.textLength(kb))))return!1;
var nc=Mi.GraphIterator.va(kb);nc.La(10);if(this.b3b(nc))return!1;let Qe;nc=this.Xfa.Ob(3);try{nc.Oa(kb);const ye=kb.NV();try{const lf=Mi.GraphIterator.va(kb);lf.La(10);lf.mc(11);let rh=lf.currentNode;Hb.wWb()&&(lf.Wif?rh=null:(lf.RD(),rh=lf.currentNode));lf.ob();const Eg=this.Tnc.gub();lf.TG(Eg,rh,89);lf.qh(Eg);Qe=kb.clone();const Qf=Qe.NV();try{Qe.setValue(Jg.a.Ib,Hb.hXn);Qe.setValue(Jg.a.Wh,Hb.SNi);Qe.isDirty=!1;lf.Je(Qe,2);lf.qh(Qe);this.Kek(kb,Qe);const jg=Hb.wWb()?Qe:kb,Ng=Hb.wWb()?kb:Qe;jg.aM=
!0;Ng.aM=!0;this.Bfa.pLf(this.r9a(jg,bd,lc.ParagraphReader.textLength(jg)),"",!1,"");this.Bfa.pLf(this.r9a(Ng,0,bd),"",!1,"");kb.dia=Hb.tCn;Qe.dia=Hb.SNi}finally{Qf&&Qf.dispose()}}finally{ye&&ye.dispose()}nc.Sgb()}finally{nc&&nc.dispose()}kb=new Wk(Hb,kb.id,Qe.id);wa.l3=kb;Pb.Hzf(kb);null!=this.Wpb&&this.Wpb.$8d(kb);return!0}b3b(wa){const kb=new Mi.GraphIterator;kb.Wb(wa);kb.mc(11);return fc.ListReader.Pg(kb)?(u.ULS.sendTraceTag(16868566,355,50,"Blocked RTT para operation: in a list"),!0):!1}HIk(wa,
kb,Pb){var Hb=kb.Uab(wa.Ib);if(Hb.equals(Pc.a.nil))return null;Hb=Pb.Ra(Hb);if(!Hb||!lc.ParagraphReader.tb(Hb)||!Hb.isConnected)return null;const bd=Mi.GraphIterator.va(Hb);if(!bd.La(23))return null;if(wa.K2f){wa=kb.Uab(wa.K2f);if(wa.equals(Pc.a.nil))return null;Pb=Pb.Ra(wa);if(!Pb||!lc.ParagraphReader.tb(Pb)||!Pb.isConnected)return null;Pb=Mi.GraphIterator.va(Pb);if(!Pb.La(23))return null;Pb.mc(11);Pb.RD();Pb.Xc();if(Pb.currentNode!==Hb)return null}return this.b3b(bd)?null:bd}XGn(wa,kb,Pb,Hb){const bd=
kb.currentNode,nc=this.Xfa.Ob(3);try{nc.Oa(bd);kb.mc(11);const Qe=kb.currentNode;kb.ob();const ye=this.Tnc.gub();kb.TG(ye,Qe,89);kb.qh(ye);const lf=xj.a.instance.createInstance(393230),rh=lf.NV();try{lf.setValue(ng.a.Pl,""),lf.Qza=!0,Hb.OEb(lf),Hb=[0],lf.setValue(Jg.a.yp,Hb),lf.setValue(Jg.a.Jr,Hb),lf.Qza=!1,lf.setValue(Jg.a.Ib,wa.Nvf),lf.setValue(Jg.a.Wh,wa.Mvf),lf.isDirty=!1,kb.Je(lf,2),lf.aM=!0,lf.dia=wa.Mvf}finally{rh&&rh.dispose()}nc.Sgb();wa.l3=new yg(wa,lf.id);Pb.Hzf(wa.l3);null!=this.Wpb&&
this.Wpb.$8d(wa.l3)}finally{nc&&nc.dispose()}return!0}r9a(wa,kb,Pb){return kb===Pb?Lc.a.Sb(wa,kb):Lc.a.createTextRange(wa,kb,Pb)}H_m(wa,kb,Pb,Hb,bd=null){const nc=wa.node;if(wa.cpBegin!==wa.cpEnd&&!this.iWh(wa))return bd&&bd.properties.Z(ya.NSi,"1"),!1;bd=this.Xfa.Ob(3);try{bd.Oa(nc);const Qe=nc.NV();try{nc.aM=!0,this.Bfa.pLf(wa,kb,Pb,Hb)}finally{Qe&&Qe.dispose()}bd.Sgb()}finally{bd&&bd.dispose()}return!0}Kek(wa,kb){kb.Qza=!0;kb.gla(wa.characterData);kb.dia=wa.dia;kb.la.clear();for(var Pb=0;Pb<wa.la.length;Pb++){const Hb=
wa.la.J(Pb).cpa(kb);kb.la.add(Hb)}kb.rl();if(kb.wordRunProperties.length)for(wa=0;wa<kb.la.length;wa++){if((Pb=kb.la.J(wa).formatting)&&-1!==Pb.zd)for(;kb.wordRunProperties.length<=Pb.zd;)kb.wordRunProperties.DX(kb.wordRunProperties.length-1,256)}else u.ULS.sendTraceTag(9204881,355,15,"Cannot update WordRunProperties after splitting paragraph");kb.Qza=!1}Tmf(wa){wa=Mi.GraphIterator.va(wa);wa.La(23);wa.ob();return{returnValue:89===wa.role,iterator:wa}}zKf(wa){const kb=new Mi.GraphIterator;kb.Wb(wa);
kb.ob();const Pb=this.Xfa.Ob(3);try{Pb.Oa(kb.currentNode),wa.xf()}finally{Pb&&Pb.dispose()}}nVm(wa){if(wa.anchor)if(({iterator:kb}=this.Tmf(wa)).returnValue)this.zKf(kb);else{var kb=wa.Mb.sm;var Pb=this.Xfa.Ob(3);try{Pb.Oa(wa),wa.load(kb.Ra(wa.id)),wa.anchor.ZU(4)}finally{Pb&&Pb.dispose()}}}PMf(wa,kb,Pb){for(let nc=kb.count-1;0<=nc;nc--){var Hb=kb.J(nc);switch(Hb.opType){case 4:Hb=Object(r.a)(Wk,Hb);if(!wa.id.equals(Hb.P2d)){u.ULS.shipAssertTag(9204885,355,wa.id.equals(Hb.Eyc));continue}Hb=Pb.Ra(Hb.Eyc);
if(!Hb)break;if(!Hb||!lc.ParagraphReader.tb(Hb)){u.ULS.shipAssertTag(9204886,355,!1);break}if(!Hb.isConnected)continue;var bd=({iterator:Hb}=this.Tmf(Hb)).returnValue;u.ULS.shipAssertTag(9204887,355,bd);bd&&this.zKf(Hb);break;case 2:(Hb=Object(r.a)(yg,Hb),wa.id.equals(Hb.paragraphId))?wa.isConnected&&(bd=({iterator:Hb}=this.Tmf(wa)).returnValue,u.ULS.shipAssertTag(16820002,355,bd),bd&&this.zKf(Hb)):u.ULS.shipAssertTag(16820001,355,!1)}}}bdk(wa,kb){const Pb=this.Oqb.PLa(kb.characterData,kb.la),Hb=
this.Oqb.Wtb(Pb,wa.bP);wa=this.Oqb.Wtb(Pb,wa.W0);return Hb===wa?Lc.a.Sb(kb,Hb):Lc.a.createTextRange(kb,Hb,wa)}iWh(wa){const kb=wa.node.la,Pb=wa.cpBegin;wa=wa.cpEnd;for(let Hb=0;Hb<kb.length;Hb++){const bd=kb.J(Hb);if(bd.cp>=wa)break;if(bd.cp>=Pb){if(bd.Ke)return u.ULS.sendTraceTag(8242647,355,15,"Rejected unsafe wet change: range contains comment"),!1;if(bd.blob)return u.ULS.sendTraceTag(8242648,355,15,"Rejected unsafe wet change: range contains blob"),!1;if(bd.je||bd.C3b||bd.mId)return u.ULS.sendTraceTag(8242649,
355,15,"Rejected unsafe wet change: range contains field"),!1}}return!0}}ya.dgi="ParagraphAlreadyDirty";ya.NSi="UnsafeWetChange";Object(k.a)(ya,"RttEditor",null,[131]);var Ab=b(1256),Vb=b(236);class oc{constructor(){this.k1c=new M.a}add(wa){this.k1c.add(wa);return!0}WAd(wa){const kb=new M.a;for(let Pb of this.k1c)wa(Pb)&&kb.add(Pb);return kb}SJf(wa){wa.activity.Txf("dried");this.k1c.remove(wa)}WJf(wa){wa.activity.Txf("expired");this.k1c.remove(wa)}}Object(k.a)(oc,"RttAddParagraphDataStore",null,[]);
class Wc extends pf{constructor(wa,kb,Pb,Hb,bd,nc,Qe,ye){super(2,ye);this.Ib=wa;this.Wh=kb;this.OY=Pb;this.K2f=Hb;this.Nvf=bd;this.Mvf=nc;this.mF=Qe}serialize(){const wa=new Fc.a(2,this.Ib,this.Wh,null,this.K2f,null,null,this.mF),kb=new Bb(this.OY,this.Nvf,this.Mvf);return new yb(this.metadata.packetId,this.metadata.clientId,1,3,wa,null,void 0,void 0,kb,void 0,void 0,void 0,void 0,this.metadata.strictlySequentialId)}static create(wa){const kb=wa.NQ,Pb=wa.lTb;let Hb=null;null!=wa.NQ.WAa&&(Hb=wa.NQ.WAa);
return new Wc(kb.NLa,kb.O0a,Pb.RXf,Hb,Pb.iCf,Pb.OY,kb.mF,Ml.create(wa))}static fel(wa,kb){return 3!==wa.type?null:new Wc(wa.jka.Ib,wa.jka.Wh,wa.ugm.Wh,wa.tLa?wa.tLa.Ib:null,wa.Lra.Ib,wa.Lra.Wh,wa.mF,kb)}}Object(k.a)(Wc,"RttAddParagraphOp",pf,[]);class cd{constructor(wa){this.NS=wa}Gni(){this.NS&&this.NS.properties.Z(cd.lkh,"1")}YNm(wa){this.NS&&(this.NS.properties.Ja(cd.btf)||this.NS.properties.Z(cd.btf,(wa-this.NS.startTime).toString()))}Txf(wa){this.NS&&(this.NS.properties.Z(cd.fsi,wa),this.NS.end())}fPm(wa){this.NS&&
this.NS.properties.Z(cd.nfi,wa.toString())}ePm(wa){this.NS&&this.NS.properties.Z(cd.Hei,wa)}static nff(wa){wa.p1(ge.a.vFb,cd.lkh,Ab.a.jMi);wa.p1(ge.a.vFb,cd.NFk,Ab.a.jMi);wa.p1(ge.a.vFb,cd.btf,Ab.a.mSj);wa.p1(ge.a.vFb,cd.fsi,Ab.a.ppa);wa.p1(ge.a.vFb,cd.nfi,Ab.a.ppa);wa.p1(ge.a.vFb,cd.Hei,Ab.a.ppa)}static create(wa){if(!wa)return null;wa=wa.Tm(ge.a.vFb,cd.dWn);return new cd(wa)}}cd.lkh="FailedToFindInitialParaID";cd.NFk="FailedToFindInitialTextID";cd.btf="MsecUntilApplied";cd.fsi="RemovedBecause";
cd.nfi="PacketVersions";cd.Hei="OperationType";cd.dWn=48E4;Object(k.a)(cd,"RttOpActivity",null,[]);var yd;(function(wa){wa[wa.unknown=0]="unknown";wa[wa.mbo=1]="replaceTextRangeOp";wa[wa.Q3n=2]="addParagraphOp";wa[wa.K5n=3]="deleteParagraphOp";wa[wa.kdo=4]="splitParagraphOp";wa[wa.U9n=5]="mergeParagraphOp";wa[wa.lbo=6]="replaceSymbolRangeOp"})(yd||(yd={}));Object(k.b)("RttOpType",yd);var sc=b(125);class Xd extends $k{constructor(wa,kb,Pb,Hb,bd,nc,Qe,ye,lf,rh,Eg){super(Hb,bd,nc,Qe,ye,lf,rh,Eg,6);this.font=
wa;this.legacy=kb}Iaf(){return"OffsetStart: "+this.bP+"OffsetEnd: "+this.W0}serialize(){const wa=this.u$g();return new yb(this.metadata.packetId,this.metadata.clientId,1,7,wa,null,this.OY,this.uib,void 0,void 0,void 0,void 0,void 0,this.metadata.strictlySequentialId)}static create(wa){let kb,Pb,Hb,bd;if(!({bP:kb,W0:Pb,Ib:Hb,Wh:bd}=$k.QQi(wa,kb,Pb,Hb,bd)).returnValue)return null;let nc,Qe;if(1===wa.text.length)nc=!1,Qe=sc.AParagraphNode.Vz;else if(2===wa.text.length)if(Ha.a.NSh(wa.text,0)&&Ha.a.jx(wa.text,
1))nc=!0,Qe=wa.text;else return u.ULS.sendTraceTag(8914772,355,15,"RTT symbol packet has text length 2 but is not a valid surrogate pair",wa.px),null;else return u.ULS.sendTraceTag(8914773,355,15,"RTT symbol packet text is of unsupported length (length must be 1 or 2)",wa.px),null;const ye=wa.GXc,lf=Ml.create(wa);return new Xd(ye.uWf,ye.vWf,nc,Hb,bd,kb,Pb,wa.WHb,Qe,wa.NQ.mF,lf)}}Object(k.a)(Xd,"RttReplaceSymbolRangeOp",$k,[132,151]);class Sd extends $k{constructor(wa,kb,Pb,Hb,bd,nc,Qe,ye){super(wa,
kb,Pb,Hb,bd,nc,Qe,ye,1)}Iaf(){return"OffsetStart: "+this.bP+"OffsetEnd: "+this.W0+"TextAddedLength: "+this.uib.length}serialize(){const wa=this.u$g();return new yb(this.metadata.packetId,this.metadata.clientId,1,2,wa,null,this.OY,this.uib,void 0,void 0,void 0,void 0,void 0,this.metadata.strictlySequentialId)}static create(wa){let kb,Pb,Hb,bd;if(!({bP:kb,W0:Pb,Ib:Hb,Wh:bd}=$k.QQi(wa,kb,Pb,Hb,bd)).returnValue)return null;let nc="";wa.text&&(nc=wa.text);const Qe=Ml.create(wa);return new Sd(Hb,bd,kb,
Pb,wa.WHb,nc,wa.NQ.mF,Qe)}static idl(wa,kb,Pb){if(wa.type)return null;const Hb=Pb.PLa(wa.X0.characterData,wa.X0.la);return new Sd(wa.X0.Ib,wa.X0.Wh,Pb.Qdc(Hb,wa.cpBegin),Pb.Qdc(Hb,wa.cpEnd),wa.Lra.Wh,wa.Mra,wa.mF,kb)}}Object(k.a)(Sd,"RttReplaceTextRangeOp",$k,[132,151]);class wf{constructor(wa,kb,Pb,Hb,bd,nc,Qe,ye,lf,rh,Eg,Qf,jg,Ng,ci,bj,Xk,Bk,he){this.Gp=null;this.Koe=this.qLg=!1;this.$4c=!0;this.QEg=this.bAe=this.SEg=this.PEg=this.REg=!1;this.Vpb=wa;this.ilb=kb;this.Cmc=Pb;this.ROb=Hb;this.Na=bd;
this.kG=nc;this.Qaa=Qe;this.zh=ye;this.Ta=lf;this.Hy=rh;this.Oqb=Eg;this.fc=Qf;this.Gwe=Ng;this.Fb=ci;this.FIg=bj;this.JQb=Xk;this.KQb=!!m.AFrameworkApplication.K&&m.AFrameworkApplication.K.getBooleanFeatureGate("Microsoft.Office.WordOnline.RttPerfMetricsIsEnabled",!1);this.nkb=Bk;this.jGe=he;this.Moc=new sk.a(Ma.a.yi());this.Oec=new oc;jg.execute(wf.nff)}Dzl(){const wa=new Ea.a(3,2,wf.uXm,Object(f.a)(this,this.BEk,"expireWetChangesAndRender"));this.Ta.ub(wa);this.qLg=!0}init(){return this.Qaa?this.Qaa.continueWith(Object(f.a)(this,
this.qAf,"onRtcConnected")):L.Task.T3(!1)}slf(){return this.Na.isFeatureEnabled(194)&&this.Na.isFeatureEnabled(151)}PVh(){return this.slf()&&this.Na.isFeatureEnabled(142)}qAf(){u.ULS.sendTraceTag(7685328,355,50,"All prerequisite ready for RttManager");this.Gp=this.Qaa.result;u.ULS.sendTraceTag(7685330,355,50,"Subscribing to presence updates");this.Gp.j3(Object(f.a)(this,this.A9,"onUpdateNotificationReceived"))}rsk(wa){wa=Sc(wa);if(!wa)return null;switch(wa.px){case 2:return Sd.create(wa);case 7:return Xd.create(wa);
case 4:return this.PVh()?mh.create(wa):null;case 3:return this.PVh()?Wc.create(wa):null;default:return u.ULS.sendTraceTag(8459668,355,50,"RTT packet is of unexpected operationType {0}",wa.px),null}}A9(wa,kb){if(3===kb.type&&this.slf())if(this.ROb.value&&!this.ROb.value.OEd)u.ULS.sendTraceTag(8454939,355,15,"RTT channel did not get disconnected on lock release");else if(kb.Q5){if(this.pPm(),(wa=this.rsk(kb.Q5))&&1!==wa.metadata.clientType)switch(this.oPm(),this.KQb&&this.$4c&&(this.JQb.Sni(),this.$4c=
!1),this.qLg||this.Dzl(),wa.opType){case 1:case 6:case 4:if(!({qf:wa}=this.jCj(wa)).returnValue)break;this.FIg?this.Jxi(wa):this.RRi(wa);break;case 2:this.Oec.add(wa),this.wMh(wa),this.FIg?this.Jxi(Pc.a.nil):this.QRi(wa)}}else u.ULS.sendTraceTag(7685331,355,15,"RTT packet was empty")}jCj(wa){let kb=Pc.a.nil;if(!this.ilb.iCj(wa))return{returnValue:!1,qf:kb};this.wMh(wa);if(!this.kG)return{returnValue:!1,qf:kb};const Pb=this.kG.Uab(wa.Ib);if(Pb.equals(Pc.a.nil)||!this.zh.value.Ra(Pb))return wa.activity.Gni(),
{returnValue:!1,qf:kb};this.Vni();return{returnValue:!0,qf:Pb}}Jxi(wa){wa.equals(Pc.a.nil)||this.Moc.add(wa.toString());this.Koe||(wa=new Ea.a(0,1,200,()=>{this.KIn();this.Koe=!1},71),this.Ta.ub(wa),this.Koe=!0)}W7m(wa){wa=new Ea.a(0,1,0,wa,71);this.Ta.ub(wa)}wMh(wa){wa.activity=cd.create(this.fc);wa.activity.fPm(wa.metadata.packetVersion);wa.activity.ePm(yd[wa.opType])}KIn(){var wa=this.Oec.WAd(Pb=>!Pb.l3);for(let Pb of wa)this.QRi(Pb);if(this.Moc.count){wa=null;for(var kb of this.Moc){kb=Pc.a.Ee(kb);
wa=this.zh.value.Ra(kb);break}kb=this.Fb.Ob(3);try{kb.Oa(wa);for(let Pb of this.Moc)this.RRi(Pc.a.Ee(Pb))}finally{kb&&kb.dispose()}this.Moc.clear()}}RRi(wa){wa=this.zh.value.Ra(wa);let kb;const Pb=this.Fb.Ob(3);try{Pb.Oa(wa);kb=this.fc.Tm(ge.a.wTg);const Hb=this.ATg(wa,kb);kb.end();Hb&&this.VEj(Hb)}finally{Pb&&Pb.dispose(),this.KQb&&(this.JQb.rIf(1),this.$4c=!0)}}QRi(wa){var kb=this.Vpb.HIk(wa,this.kG,this.zh.value);kb&&(this.Vni(),this.Vpb.XGn(wa,kb,this.nkb,la.a.instance.resolve("Box4.IParagraphEditor"))&&
(kb=this.zh.value.Ra(wa.l3.paragraphId),this.STg(kb,wa),this.KQb&&(this.JQb.rIf(1),this.$4c=!0)))}VEj(wa){this.Gwe.continueWith(()=>{if(1===wa.opType){var kb=this.ubl(wa);kb&&(this.Gwe.result.IHe(kb),this.Gwe.result.rYd(!0))}})}ubl(wa){const kb=wa.serialize();if(2!==kb.px||kb.NQ.WAa&&kb.NQ.NLa!==kb.NQ.WAa)return null;const Pb=wa.bP.clone();0<wa.uib.length&&(Pb.G2g(),Pb.cp+=wa.uib.length);kb.px=0;kb.text=null;kb.NQ.hXd=0;kb.NQ.bP=Pb;kb.NQ.O0a=kb.WHb;kb.NQ.WAa=null;kb.NQ.Ubc=null;kb.NQ.W0=null;kb.WHb=
null;return $e.QTe(kb,this.kG,this.Oqb,()=>this.zh.value,this.jGe.instance)}BEk(){const wa=this.zh.value;if(wa){var kb=this.Hy()-wf.zVm,Pb=this.ilb.WAd(bd=>bd.metadata.fYf<kb);0<Pb.count&&this.ZNm();var Hb=new Vb.a;for(let bd of Pb)if(this.ilb.WJf(bd),bd.l3)switch(bd.l3.opType){case 1:Hb.add(bd.l3.paragraphId.toString());break;case 6:Hb.add(bd.l3.paragraphId.toString());break;case 4:Hb.add(bd.l3.P2d.toString()),Hb.add(bd.l3.Eyc.toString())}Pb=this.Oec.WAd(bd=>bd.metadata.fYf<kb);for(let bd of Pb)this.Oec.WJf(bd),
bd.l3&&Hb.add(bd.l3.paragraphId.toString());for(let bd of Hb)(Hb=wa.Ra(Pc.a.Ee(bd)))?Hb.aM?(this.Vpb.nVm(Hb),Hb.aM||this.Cmc.value.tri(Hb)):u.ULS.sendTraceTag(8765829,355,15,"Expiring wet change from paragraph with no applied changes"):u.ULS.sendTraceTag(8765828,355,15,"Expiring wet change with invalid object ID")}else this.zh.hJh&&u.ULS.sendTraceTag(7685332,355,10,"Failed to find the IObjectSpace! Wet changes will never expire")}STg(wa,kb){return this.Cmc.value?this.Cmc.value.ZAj(wa,kb.metadata.clientId).returnValue?
!0:(u.ULS.sendTraceTag(7866379,355,15,"Unable to apply a wet change lock"),!1):(u.ULS.shipAssertTag(7866378,355,!!this.Cmc.value,"Unable to apply wet changes as LockManager unavailable"),!1)}zTg(wa,kb){this.ATg(wa,kb)}ATg(wa,kb){if(!wa)return null;if(!wa.anchor)return kb&&kb.properties.Z(wf.c8h,"1"),null;if(!wa.hasProperty(Jg.a.Ib))return u.ULS.sendTraceTag(7619922,355,15,"Paragraph is missing the WordId property"),null;if(!wa.hasProperty(Jg.a.Wh))return u.ULS.sendTraceTag(8197722,355,15,"Paragraph is missing the TextId property"),
null;if(wa.hasProperty(Jg.a.Wdh)&&wa.getValue(Jg.a.Wdh))return u.ULS.sendTraceTag(16815506,355,50,"RTT edit disabled in paragraph"),null;const Pb=wa.getValue(Jg.a.Ib);var Hb=wa.dia;kb&&(kb.properties.Z(wf.phm,Hb.toString()),kb.properties.Z(wf.rhm,Pb.toString()));Hb=this.ilb.l9e(Pb,Hb);if(!Hb)return kb&&kb.properties.Z(wf.Q7h,"1"),null;if(!this.STg(wa,Hb))return kb&&kb.properties.Z(wf.M7g,"1"),null;let bd=0,nc=null;for(;Hb;){if(!this.Vpb.bPj(Hb,wa,this.nkb,kb)){kb&&kb.properties.Z(wf.RYi,"1");break}bd++;
Hb.activity.YNm(this.Hy());nc=Hb;Hb=wa.dia;Hb=this.ilb.l9e(Pb,Hb)}0<bd&&this.nni();kb&&kb.properties.add(wf.SYi,bd.toString());return nc}XXd(wa){if(this.slf()&&wa.hasProperty(Jg.a.Ib)&&wa.hasProperty(Jg.a.Wh)){var kb=wa.getValue(Jg.a.Ib),Pb=wa.ia(Jg.a.Wh,0),Hb=this.fc.Tm(ge.a.Api),bd=this.nkb.oom(wa.id);0<bd.count&&(this.Vpb.PMf(wa,bd,this.zh.value),this.VVm(wa,bd,Pb));var nc=this.nkb.CQk(kb);if(nc&&!wa.id.equals(nc.paragraphId)){const Qe=this.zh.value;this.W7m(()=>{const ye=this.nkb.Reb(nc.paragraphId),
lf=Qe.Ra(nc.paragraphId);u.ULS.shipAssertTag(16820032,355,!!lf,"Could not find added graph node");lf&&(this.Vpb.PMf(lf,ye,Qe),this.Oec.SJf(nc.JHe))})}this.ilb.l9e(kb,Pb)||this.Cmc.value.tri(wa);this.zTg(wa,Hb);Hb.end()}}VVm(wa,kb,Pb){let Hb=!1;for(let nc=kb.count-1;0<=nc;nc--){var bd=kb.J(nc);switch(bd.opType){case 1:case 6:case 4:bd=Object(r.a)(132,bd.operation);break;default:continue}bd.OY===Pb&&(Hb=!0,bd.z1a&&!bd.z1a.bUn(wa)&&u.ULS.sendTraceTag(8765831,355,15,"Validating wet change location failed. Type {0} OffsetInfo {1} NodeId {2} ValidatorNodeId {3} ValidatorNodeCpBegin {4} ValidatorNodeCpEnd {5}",
bd.opType,bd.Iaf(),wa.id,bd.z1a.id,bd.z1a.cpBegin,bd.z1a.cpEnd));Hb&&this.ilb.SJf(bd)}Hb&&this.nni()}MOc(wa){const kb=this.nkb.Reb(wa.id);0<kb.count&&(2===kb.J(0).opType&&kb.removeAt(0),this.Vpb.PMf(wa,kb,this.zh.value))}v1d(wa){var kb=this.nkb.t9k(wa.id);for(let Pb of kb)if(4===Pb.opType&&(kb=Object(r.a)(Wk,Pb),wa.id.equals(kb.AAj)))return!0;return!1}pPm(){this.REg||(u.ULS.sendTraceTag(8704354,355,50,"Received a wet change"),this.REg=!0)}oPm(){this.PEg||(u.ULS.sendTraceTag(8185606,355,50,"Received a wet change that we could deserialize"),
this.PEg=!0)}Vni(){this.SEg||(u.ULS.sendTraceTag(17147533,355,50,"Received a usable wet change"),this.SEg=!0)}nni(){this.bAe||(u.ULS.sendTraceTag(8185607,355,50,"Successfully applied a wet change"),this.bAe=!0)}ZNm(){this.bAe||this.QEg||(u.ULS.sendTraceTag(8185608,355,15,"Failed to apply any wet changes so far"),this.QEg=!0)}static nff(wa){const kb=[ge.a.wTg,ge.a.Api];for(let Pb of kb)wa.p1(Pb,wf.SYi,Ab.a.ppa),wa.p1(Pb,wf.Q7h,Ab.a.ppa),wa.p1(Pb,wf.c8h,Ab.a.ppa),wa.p1(Pb,wf.M7g,Ab.a.ppa),wa.p1(Pb,
wf.RYi,Ab.a.ppa),wa.p1(Pb,ya.dgi,Ab.a.ppa),wa.p1(Pb,ya.NSi,Ab.a.ppa);cd.nff(wa)}}wf.uXm=6E4;wf.zVm=18E4;wf.SYi="WetChangeCount";wf.Q7h="NoChangesToApply";wf.c8h="NodeNotConnected";wf.M7g="CouldNotGetLock";wf.RYi="WetChangeBlocked";wf.rhm="NodeWordId";wf.phm="NodeTextId";Object(k.a)(wf,"RttManager",null,[133]);class Xi{constructor(wa,kb){this.qwi=0;this.hbb=wa;this.X5m=kb}Sni(){this.qwi=this.hbb()}rIf(wa){const kb=this.hbb()-this.qwi;0<=kb&&this.X5m.track(Math.round(kb),0===wa?"CTB":"RTP")}}Object(k.a)(Xi,
"RttPerfCounter",null,[130]);var Ak=b(1740);class ph{constructor(){this.tqc=new Ak.a}BFj(wa,kb){this.tqc.back()&&kb&&this.tqc.back().T8a(wa)||this.tqc.enqueue(wa)}i8k(){return this.tqc.isEmpty?null:this.tqc.dequeue()}}Object(k.a)(ph,"RttSendDataStore",null,[129]);class Ah extends pf{constructor(wa,kb,Pb,Hb){super(3,Hb);this.Ib=wa;this.Wh=kb;this.mF=Pb}get OY(){return 0}serialize(){const wa=new Fc.a(4,this.Ib,this.Wh,null,null,null,null,this.mF);return new yb(this.metadata.packetId,this.metadata.clientId,
1,5,wa,null,void 0,void 0,void 0,void 0,void 0,void 0,void 0,this.metadata.strictlySequentialId)}static create(wa){const kb=wa.NQ;return new Ah(kb.NLa,kb.O0a,kb.mF,Ml.create(wa))}static gel(wa,kb){return 4!==wa.type?null:new Ah(wa.hXb.Ib,wa.hXb.Wh,wa.mF,kb)}}Object(k.a)(Ah,"RttDeleteParagraphOp",pf,[132,151]);class Hg extends pf{constructor(wa,kb,Pb,Hb,bd,nc,Qe,ye){super(5,ye);this.J2f=wa;this.RNi=kb;this.gXn=Pb;this.uCn=Hb;this.mF=bd;this.GZi=nc;this.Vbc=Qe}get Ib(){return this.J2f}get Wh(){return this.RNi}get OY(){return this.J2f===
this.GZi?this.Vbc:0}serialize(){const wa=new Fc.a(5,this.J2f,this.RNi,null,this.gXn,this.uCn,null,this.mF),kb=new fb(this.GZi,this.Vbc);return new yb(this.metadata.packetId,this.metadata.clientId,1,6,wa,null,void 0,void 0,void 0,kb,void 0,void 0,void 0,this.metadata.strictlySequentialId)}static create(wa){const kb=wa.NQ,Pb=wa.$Mc;return new Hg(kb.NLa,kb.O0a,kb.WAa,kb.Ubc,kb.mF,Pb.hCf,Pb.Vbc,Ml.create(wa))}static hel(wa,kb){return 2!==wa.type?null:new Hg(wa.jka.Ib,wa.jka.Wh,wa.tLa.Ib,wa.tLa.Wh,wa.mF,
wa.yOd.Ib,wa.yOd.Wh,kb)}}Object(k.a)(Hg,"RttMergeParagraphOp",pf,[132,151]);class qh{constructor(wa,kb,Pb,Hb,bd,nc,Qe){this.Yqc=this.$h=null;this.cga=!1;this.bEe=this.eJg=0;this.ehd=this.pKg=!1;this.fze=0;this.Qaa=wa;this.PDg=kb;this.Aaa=Pb;this.Fs=Hb;this.uoa=bd;this.Na=nc;this.JQb=Qe;this.KQb=!!m.AFrameworkApplication.K&&m.AFrameworkApplication.K.getBooleanFeatureGate("Microsoft.Office.WordOnline.RttPerfMetricsIsEnabled",!1)}get qo(){return this.Aaa.value}init(){return this.Qaa?this.Qaa.continueWith(Object(f.a)(this,
this.qAf,"onRtcConnected")):L.Task.T3(!1)}qAf(){u.ULS.sendTraceTag(8245954,355,50,"All prerequisites ready for RttSendManager");this.$h=this.Qaa.result;this.$h.FXd(this)}start(){this.cga||(this.Olf()&&this.Fs.Zb.UD.hJj(Object(f.a)(this,this.Wbi,"onPersistenceTransactionCompleted")),this.cga=!0)}stop(){this.cga=!1;this.Olf()&&this.Fs.Zb.UD.IYm(Object(f.a)(this,this.Wbi,"onPersistenceTransactionCompleted"))}Olf(){return this.Na.isFeatureEnabled(194)&&this.Na.isFeatureEnabled(161)}eSl(){return this.Olf()?
this.Na.isFeatureEnabled(143):!1}Wbi(wa,kb){if(this.$h&&2===this.$h.connectionState&&(wa=kb.UD,wa.length))if(kb.D7)100>this.bEe&&(this.bEe++,u.ULS.sendTraceTag(8270467,355,50,"Blocking send. Reason: {0} OverallSends: {1} OverallBlocked: {2}",kb.RTj,this.eJg,this.bEe));else{for(kb=0;kb<wa.length;kb++)if(!this.KUl(wa[kb]))return;for(kb=0;kb<wa.length;kb++){let Pb=wa[kb];this.PDg.BFj(Pb,!Pb.type&&!kb)}this.Yqc||this.Gbi(this.Yqc,this.$h)}}KUl(wa){return wa&&-1!==wa.mF?!wa.type||this.eSl()&&(3===wa.type||
1===wa.type)?!0:!1:!1}y7l(){this.ehd||(this.pKg||(u.ULS.sendTraceTag(8270468,355,50,"Preparing to send RTT change"),this.pKg=!0),!this.ehd&&5>=this.fze&&this.fze++)}N7l(){!this.ehd&&5>=this.fze&&(u.ULS.sendTraceTag(8270469,355,50,"Sent Rtt Message"),this.ehd=!0)}Gbi(wa,kb){this.y7l();wa&&(wa.Gh||wa.Hn)&&u.ULS.sendTraceTag(8245956,355,15,"Task is faulted or cancelled with exception {0}",wa.exception);this.KQb&&this.JQb.Sni();(wa=this.iel(this.PDg.i8k()))?(this.eJg++,this.Yqc=kb.MM(3,kc(wa.serialize())),
this.N7l(),this.KQb&&this.JQb.rIf(0),this.Yqc.continueWith(Pb=>{this.Gbi(Pb,kb)})):this.Yqc=null}iel(wa){if(!wa)return null;if(!this.qo)return u.ULS.sendTraceTag(8245957,355,15,"GetParagraphAnchoredOpFromGraphTransactionOperation: CoAuth manager is null"),null;const kb=new Ml(Cl.instance.Jyh(),this.qo.hi,1,0,0,le.instance.v8k());let Pb=null;switch(wa.type){case 0:Pb=Sd.idl(wa,kb,this.uoa);break;case 4:Pb=Ah.gel(wa,kb);break;case 3:Pb=Wc.fel(wa,kb);break;case 2:Pb=Hg.hel(wa,kb);break;case 1:Pb=mh.jel(wa,
kb,this.uoa)}return Pb}}Object(k.a)(qh,"RttSendManager",null,[128]);class xi{constructor(){this.W=null}get name(){return"WordEditor.RealTimeTyping"}p6k(){return Ka.App.lc&&Ka.App.lc.zp?Ka.App.lc.zp:(u.ULS.sendTraceTag(7866377,304,15,"Unable to get the lock manager"),null)}yb(wa){const kb=ia.a.Vp(wa.za("Box4.IOutlineElementEditor")),Pb=ia.a.Vp(wa.za("Box4.IFeatureHelper")),Hb=ia.a.Vp(wa.za("Common.IActivityAggregationInfo")),bd=ia.a.Vp(wa.za("WordEditor.WordTextOffsetTranslator.IWordTextOffsetTranslator"));
this.W=wa;const nc=new rd.a;L.Task.WAA.call(null,kb,Pb,Hb,bd).continueWith(()=>{wa.ha("WordEditor.RealTimeTyping.IRttEditor",()=>new ya(wa.resolve("Box4.ICharacterPropertiesEditor"),wa.resolve("Box4.IOutlineElementEditor"),nc,wa.resolve("WordEditor.WordTextOffsetTranslator.IWordTextOffsetTranslator"))).singleInstance();wa.register(Xi,"WordEditor.RttPerfCounter").as("WordEditor.IRttPerfCounter").singleInstance().Pc(()=>new Xi(ah.a.ie,wi.a.MD(17,1,new Ne.a(new ke.a(.25)))));wa.ha("WordEditor.RealTimeTyping.RttManager",
()=>new wf(wa.resolve("WordEditor.RealTimeTyping.IRttEditor"),new wl(tm.a.instance),new R.a(Object(f.a)(this,this.p6k,"getLockManager")),new R.a(()=>Ka.App.QY),wa.resolve("Box4.IFeatureHelper"),wa.resolve("WordEditor.ParagraphWordIdMapping"),wa.resolve("Box4.Presence.IRtcProxyProvider").NG(),new R.a(()=>Ka.App.oa.Da.Zb.Lc),pb.a.instance,()=>Date.now(),wa.resolve("WordEditor.WordTextOffsetTranslator.IWordTextOffsetTranslator"),tm.a.instance,wa.za("Common.IActivityAggregationInfo"),Me.NG(),nc,m.AFrameworkApplication.K.$("WordEditorThrottleAndBatchRTTRendering"),
wa.resolve("WordEditor.IRttPerfCounter"),new zk,wa.za("WordEditor.Presence.IWordPresenceCpFactory"))).as("WordEditor.RealTimeTyping.IRttManager").singleInstance();wa.ha("WordEditor.RealTimeTyping.RttSendManager",()=>new qh(wa.resolve("Box4.Presence.IRtcProxyProvider").NG(),new ph,new R.a(()=>Ka.App.lc),Ka.App.oa.Da,wa.resolve("WordEditor.WordTextOffsetTranslator.IWordTextOffsetTranslator"),wa.resolve("Box4.IFeatureHelper"),wa.resolve("WordEditor.IRttPerfCounter"))).singleInstance();this.pff()})}pff(){this.W.resolve("WordEditor.RealTimeTyping.RttManager").init();
this.W.resolve("WordEditor.RealTimeTyping.RttSendManager").init()}init(){}dispose(){}static main(){ja.a.instance.Lb(new xi)}}Object(k.a)(xi,"WordEditorRealTimeTypingPackage",null,[1,2]);Type.registerNamespace("BPr");Type.registerNamespace("Box4.Presence");Type.registerNamespace("RealtimePresenceUI");Type.registerNamespace("WERTT");Type.registerNamespace("WordEditor.PeoplesWellControl");Type.registerNamespace("WordEditor.Presence");Type.registerNamespace("AppRealtimeChannel");Type.registerNamespace("Common.App.CoauthTelemetry");
oa.main();Type.registerNamespace("Common.App.CollabControls");ta.prototype.toString=va.prototype.toString;Wa.prototype.toString=va.prototype.toString;ja.a.instance.Lb(new Ri);xi.main();Type.registerNamespace("RealtimePresenceUI");ja.a.instance.Lb(new df);Type.registerNamespace("Common.App.RtcHostNotificationSubscription");sa.main()}}]);

//# sourceMappingURL=https://wordwebclientbuilds.blob.core.windows.net/ooui/a048ce1529a2befd784608ddea483865d3dd781d/WordEditorDSVersionHistoryNotRemoved.collab.js.map